<!DOCTYPE html>
<html style="height: 100%;"><head>
	<title>Lock-Free Single-Producer - Single Consumer Circular Queue - CodeProject</title> 
	<link type="text/css" rel="stylesheet" href="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/Main.css">

	
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="Description" content="How to make a wait-free, lock-free CircularFifo using C++11.; Author: KjellKod.cc; Updated: 31 Dec 2014; Section: Threads, Processes &amp; IPC; Chapter: General Programming; Updated: 31 Dec 2014">
<meta name="Keywords" content="VS2008, C++, Windows, Dev, Linux, Intermediate, Threading, C++11,Threads, Processes &amp; IPC,General Programming,Free source code, tutorials">
<meta name="Author" content="KjellKod.cc">
<meta name="Rating" content="General">
<meta name="Revisit-After" content="1 days">
<meta name="application-name" content="CodeProject">
<meta name="google-translate-customization" content="d908bb7ce7aff658-4c2f3a504525c916-g629383f736781a8a-13">

<link rel="dns-prefetch" href="http://ajax.googleapis.com/"> 

<meta name="syndication-source" content="http://kjellkod.wordpress.com/2012/11/28/c-debt-paid-in-full-wait-free-lock-free-queue/">

<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - All Topics" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=1">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - Android" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=22">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - iOS" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=25">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - C++" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=2">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - C#" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=3">
<link rel="alternate" type="application/rss+xml" title="CodeProject Latest articles - Web" href="http://www.codeproject.com/WebServices/ArticleRSS.aspx?cat=23">
<link rel="alternate" type="application/rss+xml" title="CodeProject Lounge Postings" href="http://www.codeproject.com/webservices/LoungeRSS.aspx">
<meta name="robots" content="index, follow">
<link rel="search" type="application/opensearchdescription+xml" title="CodeProject" href="http://www.codeproject.com/info/OpenSearch.xml">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<!-- base href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular" -->
	<link rel="icon" href="http://www.codeproject.com/favicon.ico" type="image/ico">
<link rel="shortcut icon" href="http://www.codeproject.com/favicon.ico" type="image/ico">
<link rel="apple-touch-icon" href="http://www.codeproject.com/images/FavIcon-Apple.png" type="image/png">
<script type="text/javascript" language="Javascript">//<![CDATA[
function defrm () { /* thanks twitter */ document.write = ''; window.top.location = window.self.location;  setTimeout(function() { document.body.innerHTML = ''; }, 0);  window.self.onload = function(evt) { document.body.innerHTML = ''; }; }if (window.top !== window.self) {  try {  if (window.top.location.host) { /* will throw */ } else { defrm(); /* chrome */ }  } catch (ex) { defrm(); /* everyone else */ } }if (typeof(DemoUrl)!='undefined')   document.write(unescape('%3Cme')+'ta http'+'-equiv="re'+'fresh"                  con'+'tent="1;url='+DemoUrl+unescape('"%3CE'));
(function() { 
	var _dma = document.createElement('script');
        _dma.type = 'text/javascript';
        _dma.async = true;
        _dma.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'cdn2.developermedia.com/a.min.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(_dma);
})();

//]]>
</script><script src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/a.js" async="" type="text/javascript"></script>

	




<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-1735123-1']);
	_gaq.push(['_trackPageview']);
	_gaq.push(['_setDomainName', 'www.codeproject.com']);
	_gaq.push(['_setSessionTimeout', '1200']); 

	(function () {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		(document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(ga);
	})(); 
</script><script src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/ga.js" async="" type="text/javascript"></script>


<link href="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/translateelement.css" charset="UTF-8" rel="stylesheet" type="text/css"><script src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/main_zh-CN.js" charset="UTF-8" type="text/javascript"></script><script src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/element_main.js" charset="UTF-8" type="text/javascript"></script><link type="text/css" href="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/all-packed.css" rel="stylesheet"></head>	

<body style="position: relative; min-height: 100%; top: 0px;" class="firefox firefox39">

<a class="access-link" href="#Main"><img alt="Click here to Skip to main content" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t_002.gif"></a>





<div class="page-background">

	
	

	

	
    <div id="ctl00_STM" class="site-top-menu fixed">
        <div class="main-content">
            

<div class="container memberbar clearfix">

	<div id="ctl00_MemberMenu_GenInfo" class="float-left">11,666,927 members (78,461 online)</div>

	<div class="float-left">
		
	</div>

	<div class="float-right">

		

		<span id="ctl00_MemberMenu_CurRat" class="tooltip">
				<a id="ctl00_MemberMenu_MyProfile" dir="ltr" href="http://www.codeproject.com/Members/kingbug">kingbug</a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-down-16.png" style="width:16px;height:16px;vertical-align:middle">
				<div class="tooltip-flyout" style="width:12em !important;">
					
					<div class="list-item"><a id="ctl00_MemberMenu_MySettingsDefault" href="https://www.codeproject.com/script/Membership/Modify.aspx">My Settings</a></div>
					
					<div class="list-item"><a id="ctl00_MemberMenu_MyBookmarks" href="http://www.codeproject.com/script/Bookmarks/List.aspx?obtid=2">My Bookmarks</a></div>
					<div class="list-item"><a id="ctl00_MemberMenu_MyArticles" href="http://www.codeproject.com/script/Articles/MemberArticles.aspx?amid=7856573">My Articles</a></div>
					<div class="list-item"><a id="ctl00_MemberMenu_MyMessages" href="http://www.codeproject.com/script/Forums/Messages.aspx?fmid=7856573">My Messages</a></div>
					<div class="list-item"><a id="ctl00_MemberMenu_MyQuestions" href="http://www.codeproject.com/script/Answers/MemberPosts.aspx?tab=questions&amp;mid=7856573&amp;showall=True">My Questions</a></div>
					<div class="list-item"><a id="ctl00_MemberMenu_MyAnswers" href="http://www.codeproject.com/script/Answers/MemberPosts.aspx?tab=answers&amp;mid=7856573&amp;showall=True">My Answers</a></div>
					<div class="list-item"><a id="ctl00_MemberMenu_MyComments" href="http://www.codeproject.com/script/comments/MemberComments.aspx?mid=7856573">My Comments</a></div>
					<div class="list-item"><a id="ctl00_MemberMenu_MyContacts" href="http://www.codeproject.com/script/Membership/ListContacts.aspx">My Contact info</a></div>
					
					
					
					
				</div>
			</span><span id="ctl00_MemberMenu_TotalPoints" title="Total reputation points"><a class="bold member-rep-box bronze" title="387" href="http://www.codeproject.com/script/Reputation/List.aspx?mid=7856573">387</a></span>
			&nbsp;
			<a id="ctl00_MemberMenu_Signout" href="http://www.codeproject.com/script/Membership/LogOff.aspx?rp=%2fArticles%2f43510%2fLock-Free-Single-Producer-Single-Consumer-Circular">Sign out</a>
			<img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/circle-cross.gif" style="vertical-align:middle;margin-top:-3px;" height="16px" width="16px">
		

		
	</div>
</div>
        </div>
    </div>

	
    <div id="ctl00_SH" class="site-header fixed">
        <div class="main-content">
            <div class="logo"><a href="http://www.codeproject.com/"><img id="ctl00_Logo" tabindex="1" title="CodeProject" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/logo250x135.gif" alt="Home" style="height:135px;width:250px;border-width:0px;"></a></div>
            <div class="promo"><div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="General-Programming/Threads-Processes-IPC/Multi-threading" data-tags="VS2008, C++, Windows, Dev, Linux, Intermediate, Threading, C++11,rating4.5"><noscript><a href="http://ad.doubleclick.net/N6839/jump/lqm.codeproject.site/General-Programming/Threads-Processes-IPC/Multi-threading;sz=728x90;ord=635750249543508504?"><img src="http://ad.doubleclick.net/N6839/ad/lqm.codeproject.site/General-Programming/Threads-Processes-IPC/Multi-threading;sz=728x90;ord=635750249543508504?"  width="728px" height="90px" /></a></noscript></div></div>
        </div>
    </div>

	<a href="#Main"><img alt="Click here to Skip to main content" class="access-link" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t_002.gif"></a>

	
	<div id="ctl00_TPR" class="sub-headerbar clearfix fixed">
    <div class="float-right">
		

<div class="searchbar">

<form method="get" action="/search.aspx?sbo=kw" name="Search" class="tight">


<table class="search" border="0" cellpadding="0" cellspacing="0"><tbody><tr><td><input tabindex="2" class="search  subdue" id="sb_tb" value="Search for articles, questions, tips" name="q"></td><td><input src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/search.gif" type="image"></td></tr></tbody></table>

<div class="hover-container">
	<div style="display: none;" id="SearchFilter" class="search-advanced small-text align-left">
	<b>Search within:<br></b>
		
		<input id="sb_kw" name="sbo" value="kw" checked="checked" type="radio"><label for="sb_kw">Articles</label><br>
<input id="sb_qa" name="sbo" value="qa" type="radio"><label for="sb_qa">Quick Answers</label><br>
<input id="sb_fm" name="sbo" value="fm" type="radio"><label for="sb_fm">Messages</label><br>


		
		

		
		
	</div>
</div>
</form>

</div>
    </div>
    <div class="float-left">
		

<div class="navbar clearfix">
<ul class="navmenu openable">

<li class="desktop-only"><a id="ctl00_TopNavBar_Home" href="http://www.codeproject.com/">home</a>


</li><li class=""><a id="ctl00_TopNavBar_Art" class="down selected" href="http://www.codeproject.com/script/Articles/Latest.aspx">articles</a>

	<ul>
		<li class=""><a id="ctl00_TopNavBar_ArtTopicList" class="fly" onmouseover="navBarMenu.ShowMap(this, 'ctl00_TopNavBar_MapFlyout');" href="http://www.codeproject.com/script/Content/SiteMap.aspx">Chapters and Sections<span class="has-submenu">&gt;</span></a><ul id="ctl00_TopNavBar_MapFlyout">
			<li>
				<div id="siteMap">
					<img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/animated.gif" alt="loading" style="margin:150px;width:100px;height:100px;">
				</div>
			</li>
			</ul>
		</li>
		<li><a id="ctl00_TopNavBar_ArtSearch" class="fly break" href="http://www.codeproject.com/search.aspx?sbo=kw">Search</a></li>
		<li><a id="ctl00_TopNavBar_ArtLatestArts" class="fly" href="http://www.codeproject.com/script/Articles/Latest.aspx?at=1,3,7">Latest Articles</a></li>
		<li><a id="ctl00_TopNavBar_ArtLatestTips" class="fly" href="http://www.codeproject.com/script/Articles/Latest.aspx?at=6">Latest Tips/Tricks</a></li>
		<li><a id="ctl00_TopNavBar_ArtTop" class="fly" href="http://www.codeproject.com/script/Articles/TopArticles.aspx?ta_so=5">Top Articles</a></li>
		<li><a id="ctl00_TopNavBar_ArtBeginner" class="fly" href="http://www.codeproject.com/search.aspx?sbo=kw?aidlst=152&amp;sa_us=True">Beginner Articles</a></li>
		<li><a id="ctl00_TopNavBar_ArtBlogArticles" class="fly break" href="http://www.codeproject.com/script/Articles/BlogArticleList.aspx">Technical Blogs</a></li>
		<li><a id="ctl00_TopNavBar_ArtGuide" class="fly" href="http://www.codeproject.com/info/Submit.aspx">Posting/Update Guidelines</a></li>
		<li><a id="ctl00_TopNavBar_ArtHelpForum" class="fly" href="http://www.codeproject.com/Forums/1641/Article-Writing.aspx">Article Help Forum</a></li>
		<li><a id="ctl00_TopNavBar_ArtCompetition" class="fly break" href="http://www.codeproject.com/script/Awards/CurrentCompetitions.aspx?cmpTpId=1">Article Competition</a></li>
		<li><a id="ctl00_TopNavBar_ArtPostArticle" class="fly highlight1" href="http://www.codeproject.com/script/Articles/Submit.aspx">
			<img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/write13.png" height="13px" width="13px"> Submit an article or tip
			</a></li>
		<li><a id="ctl00_TopNavBar_ArtPostBlog" class="fly highlight2" href="http://www.codeproject.com/script/Articles/BlogFeed.aspx">
			<img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/write13.png" height="13px" width="13px"> Post your Blog
			</a></li>		<li class="last"></li>
	</ul>

</li>



<li class="">
<a id="ctl00_TopNavBar_Answers" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active">
    <span class="desktop-only tablet-only">quick answers</span><span class="mobile-only">Q&amp;A</span>
</a>
	<ul>
		<li id="ctl00_TopNavBar_AQL"><a id="ctl00_TopNavBar_ArticleQuestion" class="fly highlight1" href="#_comments">
			<img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/write13.png" height="13px" width="13px"> Ask a Question about this 
			article</a>
		</li>

		<li><a id="ctl00_TopNavBar_QAAsk" class="fly highlight2" href="http://www.codeproject.com/Questions/ask.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/write13.png" height="13px" width="13px"> Ask a Question</a></li>

		
		<li><a id="ctl00_TopNavBar_QAUnanswered" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=unanswered">View Unanswered Questions</a></li>
		<li><a id="ctl00_TopNavBar_QALatest" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active">View All Questions...</a></li>
		
				<li><a id="ctl00_TopNavBar_QATR_ctl00_Tag" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=120" style="padding-left:30px">Linux questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl01_Tag" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=81" style="padding-left:30px">C# questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl02_Tag" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=85" style="padding-left:30px">ASP.NET questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl03_Tag" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=1223" style="padding-left:30px">C#5 questions</a></li>
			
				<li><a id="ctl00_TopNavBar_QATR_ctl04_Tag" class="fly" href="http://www.codeproject.com/script/Answers/List.aspx?tab=active&amp;alltags=true&amp;tags=93" style="padding-left:30px">SQL questions</a></li>
			
		<li class="last"></li>
	</ul>

</li>



<li class=""><a id="ctl00_TopNavBar_Forums" href="http://www.codeproject.com/script/Forums/List.aspx">
        <span class="desktop-only tablet-only">discussions</span><span class="mobile-only">forums</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_MessageBoardsAll" class="fly" href="http://www.codeproject.com/script/Forums/List.aspx">All Message Boards...</a></li>
		<li class=""><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1580997/Application-Lifecycle.aspx">Application Lifecycle<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="http://www.codeproject.com/Forums/1533717/Running-a-Business.aspx">Running a Business</a></li>
<li><a class="fly" href="http://www.codeproject.com/Forums/1533716/Sales-Marketing.aspx">Sales / Marketing</a></li>
<li><a class="fly" href="http://www.codeproject.com/Forums/1651/Collaboration-Beta-Testing.aspx">Collaboration / Beta Testing</a></li>
<li><a class="fly" href="http://www.codeproject.com/Forums/3304/Work-Issues.aspx">Work  Issues</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/369270/Design-and-Architecture.aspx">Design and Architecture</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/12076/ASP-NET.aspx">ASP.NET</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1580226/JavaScript.aspx">JavaScript</a>
</li>
<li class=""><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1647/C-Cplusplus-MFC.aspx">C / C++ / MFC<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="http://www.codeproject.com/Forums/4486/ATL-WTL-STL.aspx">ATL /  WTL / STL</a></li>
<li><a class="fly" href="http://www.codeproject.com/Forums/3785/Managed-Cplusplus-CLI.aspx">Managed C++/CLI</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1649/Csharp.aspx">C#</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1627782/Free-Tools.aspx">Free Tools</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1827460/Objective-C-and-Swift.aspx">Objective-C and Swift</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1725/Database.aspx">Database</a>
</li>
<li class=""><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/186301/Hardware-Devices.aspx">Hardware &amp; Devices<span class="has-submenu">&gt;</span></a>
<ul class="openable"><li><a class="fly" href="http://www.codeproject.com/Forums/1644/System-Admin.aspx">System Admin</a></li>
</ul></li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1606152/Hosting-and-Servers.aspx">Hosting and Servers</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1643/Java.aspx">Java</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1650/NET-Framework.aspx">.NET Framework</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1848626/Android.aspx">Android</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1876716/iOS.aspx">iOS</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/13695/Mobile.aspx">Mobile</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1540733/Sharepoint.aspx">Sharepoint</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1004257/Silverlight-WPF.aspx">Silverlight / WPF</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1646/Visual-Basic.aspx">Visual Basic</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/Forums/1640/Web-Development.aspx">Web Development</a>
</li>
<li><a class="fly" style="padding-left:30px" href="http://www.codeproject.com/suggestions.aspx">Site Bugs / Suggestions</a>
</li>

		<li class="last"></li>
	</ul>

</li>

<li class="desktop-only"><a id="ctl00_TopNavBar_Features" href="http://www.codeproject.com/Feature/">features</a>

	<ul>
		<li><a id="ctl00_TopNavBar_Comps" class="fly" href="http://www.codeproject.com/script/Awards/CurrentCompetitions.aspx?cmpTpId=1&amp;awsac=true">Competitions</a></li>
		<li><a id="ctl00_TopNavBar_News" class="fly" href="http://www.codeproject.com/script/News/List.aspx">News</a></li>
		<li><a id="ctl00_TopNavBar_Insider" class="fly" href="http://www.codeproject.com/Feature/Insider/">The Insider Newsletter</a></li>
    	<li><a id="ctl00_TopNavBar_DailyBuild" class="fly" href="http://www.codeproject.com/Feature/DailyBuild">The Daily Build Newsletter</a></li>
		<li><a id="ctl00_TopNavBar_Newsletters" class="fly" href="http://www.codeproject.com/script/Mailouts/Archive.aspx?mtpid=1">Newsletter archive</a></li>
		<li><a id="ctl00_TopNavBar_Surveys" class="fly" href="http://www.codeproject.com/script/Surveys/List.aspx">Surveys</a></li>
		<li><a id="ctl00_TopNavBar_Showcase" class="fly" href="http://www.codeproject.com/KB/showcase/">Product Showcase</a></li>
		<li><a id="ctl00_TopNavBar_Research" class="fly" href="http://www.codeproject.com/script/ResearchLibrary/Index.aspx">Research Library</a></li>

		<li><a id="ctl00_TopNavBar_Stuff" class="fly" href="http://www.codeproject.com/Info/Stuff.aspx">CodeProject Stuff</a></li>
		<li class="last"></li>
	</ul>

</li>


<li class=""><a id="ctl00_TopNavBar_Lounge" href="http://www.codeproject.com/Lounge.aspx">
            <span class="desktop-only tablet-only">community</span><span class="mobile-only">lounge</span>
</a>

	<ul>
		<li><a id="ctl00_TopNavBar_WhosWho" class="fly" href="http://www.codeproject.com/script/Membership/Profiles.aspx">Who's Who</a></li>
		<li><a id="ctl00_TopNavBar_MVPs" class="fly break" href="http://www.codeproject.com/script/Awards/MVPWinners.aspx">Most Valuable Professionals</a></li>
		

		<li><a id="ctl00_TopNavBar_LoungeLnk" class="fly highlight2" href="http://www.codeproject.com/Lounge.aspx">The Lounge &nbsp;</a></li>
		<li><a id="ctl00_TopNavBar_InsiderLnk" class="fly" href="http://www.codeproject.com/Insider.aspx">The Insider News</a></li>
		<li><a id="ctl00_TopNavBar_WeirdWonderful" class="fly" href="http://www.codeproject.com/Feature/WeirdAndWonderful.aspx">The Weird &amp; The Wonderful</a></li>
		<li><a id="ctl00_TopNavBar_SoapBoxLnk" class="fly" href="http://www.codeproject.com/Forums/1536756/The-Soapbox.aspx">The Soapbox</a></li>
		<li><a id="ctl00_TopNavBar_PRLnk" class="fly break" href="http://www.codeproject.com/Forums/1738007/Press-Releases.aspx">Press Releases</a></li>

		
		<li class=""><a class="fly" href="http://www.codeproject.com/Forums/1580229/Hindi.aspx">Non-English Language
			<span class="has-submenu">&gt;</span></a>
		<ul>
		<li><a class="fly" href="http://www.codeproject.com/Forums/1580229/Hindi.aspx">General Indian Topics</a></li>
		<li><a class="fly" href="http://www.codeproject.com/Forums/1580230/Chinese.aspx">General Chinese Topics</a></li>
		</ul>
		</li><li class="last"></li>
		
	</ul>

</li>


<li class="desktop-only tablet-only" style="margin-left:20px"><a id="ctl00_TopNavBar_Help" href="http://www.codeproject.com/KB/FAQs/">help</a>

	<ul>
		<li><a id="ctl00_TopNavBar_HelpWhatIs" class="fly" href="http://www.codeproject.com/info/guide.aspx">What is 'CodeProject'?</a></li>
		<li><a id="ctl00_TopNavBar_HelpGeneral" class="fly break" href="http://www.codeproject.com/KB/FAQs/">General FAQ</a></li>
		<li><a id="ctl00_TopNavBar_HelpPostQuestion" class="fly break highlight2" href="http://www.codeproject.com/Questions/ask.aspx">Ask a Question</a></li>
		<li><a id="ctl00_TopNavBar_HelpBugs" class="fly" href="http://www.codeproject.com/suggestions.aspx">Bugs and Suggestions</a></li>
		<li><a id="ctl00_TopNavBar_HelpArticles" class="fly" href="http://www.codeproject.com/Forums/1641/Article-Writing.aspx">Article Help Forum</a></li>
		<li><a id="ctl00_TopNavBar_HelpSiteMap" class="fly" href="http://www.codeproject.com/script/Content/SiteMap.aspx">Site Map</a></li>
		<li><a id="ctl00_TopNavBar_HelpAdvertise" class="fly" href="http://developermedia.com/">Advertise with us</a></li>
		<li><a id="ctl00_TopNavBar_HelpJobs" class="fly" href="http://www.codeproject.com/info/Jobs/">Employment Opportunities</a></li>
		<li><a id="ctl00_TopNavBar_HelpAboutUs" class="fly" href="http://www.codeproject.com/info/about.aspx">About Us</a></li>
		<li class="last"></li>
	</ul>

</li>

</ul>

</div>
    </div>
	<div class="sub-headerbar-divider"></div>
	</div>		
	

	<div id="A" class="container-content-wrap fixed"> 

	<div itemscope="" itemtype="http://schema.org/Article" class="container-content"> 


		<div class="clearfix">
			<div class="container-breadcrumb float-left ">
				<div><a href="http://www.codeproject.com/script/Content/SiteMap.aspx">Articles</a> » <a href="http://www.codeproject.com/Chapters/6/General-Programming.aspx">General Programming</a> » <a href="http://www.codeproject.com/KB/threads/"><span itemprop="articleSection">Threads, Processes &amp; IPC</span></a> » <a href="http://www.codeproject.com/KB/threads/#Multi-threading">Multi-threading</a></div>
			</div>

			<div class="float-left">
				
			</div>

			<div class="edit-links float-right">
				


 
&nbsp;










			</div>

			<div class="article-nav float-right">
					
		        
		        
					

                
				

<a id="ctl00_ActionLinks_BookmarkMd_ImgBt" title="Bookmark" alternatetext="Bookmark" name="bm_43510_2" onclick="return bookmarkMe(43510,2,'/script/Bookmarks/Ajax/Add.aspx?obid=43510&amp;obtid=2&amp;action=AddBookmark&amp;bio=true&amp;bis=medium','medium');" href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=43510&amp;obtid=2&amp;action=AddBookmark&amp;bio=true&amp;bis=medium" style="display:inline-block;height:24px;width:24px;"><img title="Bookmark" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/bookmark24.png" alt="" style="border-width:0px;"></a>


<span id="ctl00_ActionLinks_BookmarkMd_StatusMsg" class="tiny-text" style="display:none" name="bm_43510_2"></span>
<a id="ctl00_ActionLinks_PrintMd" href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?display=Print">
	<img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/print24.png" title="Print" style="border:0" height="24px" width="24px">
</a>
			</div>
		</div>

		<table class="extended container-article-parts" cellpadding="0" cellspacing="0">
        <tbody><tr valign="top">
		<td class="article-wing-left" width="117px">

			<div style="position: fixed; top: 10px; left: 272.5px;" id="ctl00_Nav" class="container-article-tabs stuck">
				<div class="tabs">
					

<div class="">
	<div class="selected">Article</div><div class="unselected"><a href="http://www.codeproject.com/script/Articles/ViewDownloads.aspx?aid=43510">Browse Code</a></div><div class="unselected"><a href="http://www.codeproject.com/script/Articles/Statistics.aspx?aid=43510">Stats</a></div><div class="unselected"><a href="http://www.codeproject.com/script/Articles/ListVersions.aspx?aid=43510">Revisions (18)</a></div><div class="unselected"><a href="http://www.codeproject.com/script/Articles/ListAlternatives.aspx?aid=43510">Alternatives</a></div>

	<div class="unselected"><a href="http://www.codeproject.com/Articles/43510/WebControls/#_comments" id="ctl00_ArticleTabs_CommentLink" class="anchorLink">Comments 
        <span id="ctl00_ArticleTabs_CmtCnt">(93)</span></a>
	</div>
</div>	

				</div>

				<a id="ctl00_AddAlternative" title="Write a related article about upgrades or translate this into a different language." class="add-item" href="http://www.codeproject.com/script/Articles/SubmissionWizard.aspx?at=1&amp;apid=43510">Add your own<br>alternative version</a>

			    <div class="tags"> 
                    <h4>Tagged as</h4>
			        <span id="ctl00_TagsList_TagWrp" class="tags">
	
	
	
	<span id="ctl00_TagsList_VisibleTags"><div class="t"><a rel="tag" href="http://www.codeproject.com/Tags/VS2008">VS2008</a></div><div class="t"><a rel="tag" href="http://www.codeproject.com/Tags/C--plus----plus--">C++</a></div><div class="t"><a rel="tag" href="http://www.codeproject.com/Tags/Windows">Windows</a></div><div class="t"><a rel="tag" href="http://www.codeproject.com/Tags/Dev">Dev</a></div><div class="t"><a rel="tag" href="http://www.codeproject.com/Tags/Linux">Linux</a></div><div class="t"><a rel="tag" href="http://www.codeproject.com/Tags/Intermediate">Intermediate</a></div><div class="t"><a rel="tag" href="http://www.codeproject.com/Tags/Threading">Threading</a></div><div class="t"><a rel="tag" href="http://www.codeproject.com/Tags/C--plus----plus--11">C++11</a></div></span> 

	
	
</span>

			    </div>
                
			</div>

		</td>
		<td>
			
			<div id="AT" class="container-article  fixed"> 

				<div class="article">

					<form name="aspnetForm" method="post" action="/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular" id="aspnetForm" style="margin:0;padding:0">
<div>
<input name="__VIEWSTATE" id="__VIEWSTATE" value="gx9Vi6Hsp0lfaOY+dA9nNflxYZyctvAhiOboLXMuSku56w3Qrhb9fYNsdP/KcikjUeiS1thyUuDY+AMFfaKAk+E4TguDeD6fKvFTobRd4GvyqHQHeJ5Nm+MyZD1bIMnS3Y5qJBUi9p9DeaZVN0G1r4WMXq2+BUHcbuU2pv4ycDGtVR3I09FVy6ssp2zTnLyWgu7paOtkfwNkDynBq028DxXSaudDdd7KcqUNJyDc3wdaLXH8FaT5TRJkxiueIhAfKhE+yYj/PZHzsAgBnBKUAKQWTmKLcx3c36q9cC6wUzH6k6LTvz6vE8kw/E0xr1E0PLOql8UnjwljxFVKhmehVuJU5o5HmNaKBD8ZKmjwSd58poMrUzyQsghRaII/4+tofAHJlCxXdpxprCudG/To3u5071q9fwb5cDMPKBFRgb2EsvAGDc7d1blJSOw25bYCITwRV50+Eb8IyCzH2bUB6Nysvrx0Gl0Y5SPytEyGaIsGx92EISYV+PaDYrksXk31F/P/L829mUi7EU6JqOn+mPoJFxq+aLziEYbpJtQV1Umj0fetOQbnsX5iWhqtFhEf95a/+VezMz2tuaIGRMEwD7Hf2yhmdl8Z8ijBaBmhg8s2lqTdXZs2oXZ3UFWZQ/MvvTIp1kLiD32ZyHS7cNwZkZvldLAY5P5Bdnc//8mZeBarcP5z3/vLrPY1h+UKqEgF439gFwTXu5+Av1g1GiX/qB/cb+kuhTBi5nHdtqbyAS1N8q8elxT39UuDLf2tGIVSx1wDvh8t50Ugl4/pnvPMFZF9PbNJ7beMoc52JP36oLCFKJlCt2QUkJB4aLwTRwU4TeQ1MDPjjG5ULazwi58WGzCpHjYHSvQ3GmLINIk/y4d8Ygtfz4Ub7rWXr2iw5Yu/xmb4CQdFNpM40JbE/ZsRj7bhP3PEkXKI9uznf5jMSDvXXG0KGftWHVwZb1a/eW1mdxfNBXhOngCVc3kcpg8juhs/W+70LYlub5Joh/Rdf9wLjC2YQVp3UBMZxIKbGPuWjXtciI+iWO7i+Jvlggd+XBQO3V+qcAZ+FBESGK8Ycyjj4qhruYqFcbZBZBidToUxR5XnEaq6km/DC2dVO+Un9T6UI7nyABid08UmHDVPF0XUmuo374U/mMfDvs8OTkMznLDjfYERE1kUFtosVku5hGykO1tnU6c+UN+TOmGfX/7IbB9HPuHe62HUaJ9Wdf/B9KbHuVy2ZK0/CAJ4xXWssYtiDlissCXs0/ZnMiBI1Yrry2wGbLuId1f1KtnBWGAd2YDvLtjAqgoX5JNhG9/g/KSXyZbgM9rkC2VUItBjsIng6vmXENfxOgYxxSsvITSUhT9puAuRB0Jly4/w0FpDojBaBDJtFcD+CzxnkMlWNL6gTq1ZNEVOYSTb06u6JQK2RIrtXB90XrAmDkUPfKnSGx7IorqbAz8OKRB9P/a5Qu8bdA6foQHYxlKCJRAUMD9ac0z/wSgUBQVkeuf3FZ1UUrPmkBHu4ZKMcqLmMlXeFMLm6Mkg6Ci6aCUYJm+V1MCTcP9SvFk01GdSW8GJ6uSc50jJjvgios734zLnF1J3War5jBwlCd1DZi+XKCtIkJP+7qspZeABSYKf6D5ZEIeHG/40znMLxAwF17mAfZhkIkW5htMGzqe3IYEZBSDIsZLNTpZ+Vvp8pEF5OkVUL30qTzReec6C2RHWzYRLJiHQcwBY+WK+aqyuXFXC1y44gR6BGlg7CovhhPgxRqRM2Gr0T6AUOrrluM0hmGQVlSySly2o4BN6UIxZ2Gp1fW6SwZbwnu7sMJheSJA50cHRzVK0Ytr3qeElzOmFxFdu2I+1aq3UXv4U7uAyMKJhTpp03KncFuXyQ09YTq86VzEfDlM8ES1PEnLDAh3L9yv2kJmlsLez6T4exqCPS55yMHPycQG/dSibR8M5GMC4uO7rzlAWZgTC3ov5puMVkJMQC9hNLf8TA9fJ+VZybErqGjBVHVEMmfMIDj4gASv1ylBoFHqd243eVwq1kGXiK78qv6r0a9NkWd+W4zm/Yy/J6IoqDT1cLxk36EVWdj0SxFf6ZVJqRrW1tygwkgJjfpiUzijS5eg9PP4vZp7FO4/7KfNUUHEivwj5pADAswMrluZkk/U7kwkewjinOC4fWGncsuNueiiR3hGkVJtL4MxcjyyOAYWjBzUy0dHEai7urmujcx1A3Jr2utRsrxczVzw8WnlQRiyEy2FjEQxO255axX8md7MUbkQGPcEojpkD//eZpq96N+/QMPmsU/bawkNdklb3POvBZkB5JAq2ZJpWu/iNeylvCKZkr1cNx/HvbbzfrwbfoyGNyb9uNa02EgEkoKMi/NFpxEIHCpT+DJfX3mhw3Fj+oRuyCnQkN3JMUquLvyl9ZHMJbRSiVGMvrBC3pMZfyRmOm3FB0oVdhPizX6e4IbeCaZvJA8VXWAc1eWlnrNuFN0lZ7rNrwdcdn2FRVCkM6wDWsdLSsOhNs6WYuFywxxONlJ1cwJZaPLfe5nV/IjgxHfs2QjM=" type="hidden">
</div>

<div>

	<input name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="10C1FD69" type="hidden">
</div>

					
					 
					<div class="header">
					    <a name="Main"></a>

					    
					    <a name="_articleTop" id="_articleTop"></a>
					    <div class="title">
					        
					        <h1 id="ctl00_ArticleTitle" itemprop="name">Lock-Free Single-Producer - Single Consumer Circular Queue</h1> 
					    </div>

                        <div style="height:34px">
					        
					        <div class="entry float-left">
                                <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/148298ce-7230-48e9-b59a-dd227f75d173.JPG" id="ctl00_avatar" class="float-left avatar">
                                <div class="float-left">

						            <span class="author"><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931" rel="author"><span itemprop="author" itemscope="" itemtype="http://schema.org/Person"><span itemprop="name">KjellKod.cc</span></span></a></span>, 
						            <span class="date" itemprop="dateModified" content="2014-12-31 09:38:00">
							            31 Dec 2014</span>
			
                                    <a id="ctl00_LicenseLink" title="A Public Domain dedication" class="license" href="http://creativecommons.org/licenses/publicdomain/">Public Domain</a><span id="ctl00_ArtStats" class="stats"><img title="views" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/read32.png" style="width:16px;height:16px;"> 147.9K<img title="downloads" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/download32.png" style="width:16px;height:16px;"> 3.8K<img title="bookmarks" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/bookmark32.png" style="width:16px;height:16px;"> 172</span><div id="ctl00_CurRat" class="tooltip anchorLink" style="cursor:pointer;margin-top: 5px" name="CurRat_43510">
				
							            

<table class="small-text" itemprop="aggregateRating" itemscope="" itemtype="http://schema.org/AggregateRating" cellpadding="0" cellspacing="0"> 
<tbody><tr>
	
	<td class="nowrap">

		
			<meta itemprop="bestRating" content="5"> 
			<meta itemprop="worstRating" content="1">
		

		<span id="ctl00_ArticleRating_VI">
		<div class="nowrap rating-stars-large" style="height:21px;width:119px;position:relative;">
	<div class="clipped align-left float-left" style="height:19px;width:115px;">
		<img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/stars-fill-lg.png" style="border-width:0px;">
	</div><div class="clipped" style="height:19px;width:4px;position:relative;">
		<img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/stars-empty-lg.png" style="border-width:0px;position:absolute;top:0;right:0;">
	</div>
</div>
		</span>

		
	</td>
	
	<td id="ctl00_ArticleRating_VR" class="nowrap">
		&nbsp;
		<span id="ctl00_ArticleRating_VotesR">&nbsp;<span itemprop="ratingValue" class="rating">4.82</span> (<span itemprop="ratingCount" class="count">51</span> votes)</span>
		
	</td>

</tr>

</tbody></table>


							            <div id="ctl00_RB" class="speech-bubble-container-up">
								            <div class="speech-bubble-up" style="width:150px !important">
									                        
<div>
<table class="feature" title="Voting Distribution. Recent data only" height="50px" cellpadding="0" cellspacing="0" width="100%"><tbody><tr class="chart-row"><td class="chart-column"><span title="0 votes">1</span></td>
<td class="chart-column"><span title="0 votes">2</span></td>
<td class="chart-column"><div class="rating-ignore-vote" title="Votes not included in score."><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pollcol.gif" alt="1 vote, 2.0%" title="1 vote, 2.0%" height="1px" border="0px" width="20pxpx"></div><span title="0 votes">3</span></td>
<td class="chart-column"><div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pollcol.gif" alt="7 votes, 14.0%" title="7 votes, 14.0%" height="8px" border="0px" width="20pxpx"></div><span title="7 votes">4</span></td>
<td class="chart-column"><div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pollcol.gif" alt="43 votes, 86.0%" title="43 votes, 86.0%" height="50px" border="0px" width="20pxpx"></div><span title="43 votes">5</span></td>
</tr></tbody></table><div class="small-text align-center">4.82/5 - 51 votes</div><div class="small-text align-center subdue">1 removed</div><div class="small-text align-center subdue">μ 4.77, σ<sub>a</sub> 0.84 [<a href="http://www.codeproject.com/KB/FAQs/RatingReputationFAQ.aspx#noisefilter">?</a>]</div>
</div>
								            </div>
								            <div class="speech-bubble-pointer-up">
									            <div class="speech-bubble-pointer-up-inner"></div>
								            </div>
							            </div>
						            </div>
                                </div>
					        </div>

                            
						    <div id="ctl00_RateArticleRow" class="float-right align-right voting-bar">
						        <div id="ctl00_RateArticle_RateItemWrapper" class="small-text" name="RateItem_43510">

	<table class="small-text" cellpadding="0" cellspacing="0" width="100%">
	<tbody><tr>
		<td id="ctl00_RateArticle_VoteResultDiv" class="rating-result align-right">
			<span class="align-right"></span>
			<img class="loaderImg" alt="loading..." src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/animated_loading_blue.gif" style="display:none;" height="16px" width="16px"> 
		</td>

	
		<td class="voteTbl" style="white-space:nowrap" align="right">
			<table class="small-text">
			<tbody><tr>
				
				<td id="ctl00_RateArticle_StartForm" align="right" nowrap="nowrap">Rate: </td>

				<td id="ctl00_RateArticle_VoteFormDiv" class="nowrap rating-stars-voter-large">
					

					<span id="ctl00_RateArticle_RB" class="tooltip ajaxHist radio voting">
						<span id="ctl00_RateArticle_VoteRBL"><input style="display: none;" id="ctl00_RateArticle_VoteRBL_0" name="ctl00$RateArticle$VoteRBL" value="1" type="radio"><input style="display: none;" id="ctl00_RateArticle_VoteRBL_1" name="ctl00$RateArticle$VoteRBL" value="2" type="radio"><input style="display: none;" id="ctl00_RateArticle_VoteRBL_2" name="ctl00$RateArticle$VoteRBL" value="3" type="radio"><input style="display: none;" id="ctl00_RateArticle_VoteRBL_3" name="ctl00$RateArticle$VoteRBL" value="4" type="radio"><input style="display: none;" id="ctl00_RateArticle_VoteRBL_4" name="ctl00$RateArticle$VoteRBL" value="5" type="radio"></span> 

						
					<div class="rating-star-block"><a title="vote 1" class="star outline" rating="1" href="#">vote 1</a><a title="vote 2" class="star outline" rating="2" href="#">vote 2</a><a title="vote 3" class="star outline" rating="3" href="#">vote 3</a><a title="vote 4" class="star outline" rating="4" href="#">vote 4</a><a title="vote 5" class="star outline" rating="5" href="#">vote 5</a></div></span>

				</td>

				
				<td style="padding-left:5px">	
					<input style="display: none;" name="ctl00$RateArticle$SubmitRateBtn" value="Vote!" id="ctl00_RateArticle_SubmitRateBtn" class="button" type="submit">
				</td>
			</tr>
			</tbody></table>
			
		</td>
	</tr>
	</tbody></table>
	<div class="hover-container">
		<div style="display: none;" id="ctl00_RateArticle_RCD" class="rating-comment align-left float-right">
			Add a reason or comment to your vote:
            <a href="#" id="clear-rate_ctl00_RateArticle_RCD" title="close" class="rating-close">x</a>
            <br>
			<textarea class="RateComment" rows="5" cols="60" style="width:98%;"></textarea>
			<span id="ctl00_RateArticle_CommentReq" class="subdue">Adding a comment to your rating is optional</span>
		</div>
        
	</div>
</div>
						    </div>
						    	
                        </div>

   					    
                        <div id="ctl00_description" class="summary" itemprop="headline">How to make a wait-free, lock-free CircularFifo using C++11.</div><span id="ctl00_thumbnailUrl" class="date" itemprop="image" content="http://www.codeproject.com/KB/threads/LockFree/Thumb-43510.jpg"></span>			

                    </div>
                    
					
					

					

					
					
					

						
					

					

						
						<div id="contentdiv" class="text" itemprop="articleBody">
						



<ul class="download">
	<li><a href="http://www.codeproject.com/KB/threads/LockFree/lock-free-wait-free-circularfifo.zip">Download source code</a></li>
	<li>Latest <a href="https://bitbucket.org/KjellKod/lock-free-wait-free-circularfifo">lock-free-wait-free-circularfifo from BitBucket</a></li>
</ul>

<h2><a id="heading_introduction&quot;" name="heading_introduction"></a>Introduction</h2>

<p>The wait-free and lock-free circular queue is a useful technique for 
time and memory sensitive systems. The wait-free nature of the queue 
gives a fixed number of steps for each operation. The lock-free nature 
of the queue enables two thread communication from a single source 
thread (the Producer) to a single destination thread (the Consumer) 
without using any locks.</p>

<p>The power of wait-free and lock-free together makes this type of 
circular queue attractive in a range of areas, from interrupt and signal
 handlers to real-time systems or other time sensitive software.</p>

<p><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/circular_queue___conceptual-view.jpg" height="401" width="512"></p>

<h2><a id="heading_background" name="heading_background">Background: Circular FIFO Queue</a>&nbsp;</h2>

<p>This circular <a href="http://en.wikipedia.org/wiki/FIFO_%28computing%29">FIFO</a> queue can be used for communicating between <strong>maximum two threads</strong>. This scenario is often referred to as the single producer → single consumer problem.</p>

<p><strong>The problem description</strong>: A high priority task that 
must not be delayed in lengthy operations and also requires the data 
processing to finish in the same order as they are started. Examples 
could be : Interrupt/Signal handler, GUI events, data recorder, etc.</p>

<p><strong>The solution</strong>: Delegate time consuming jobs to another thread that receives (i.e. <em>consumes</em>) the produced message. Using a <code>FIFO</code> queue gives predictable behaviour for the <strong>asynchronous</strong> delegation and processing of tasks as they pass from the <em>Producer</em> to the <em>Consumer</em>.</p>

<p>The Producer can add new tasks to the queue as long as the queue is 
not full. The Consumer can remove tasks from the queue as long as the 
queue is not empty. At the queue there is <strong>no waiting involved</strong> for adding or retrieving data. If there are no jobs to process the <em>Consumer</em> thread can continue with other tasks. If there is no room left in the queue for the <em>Producer</em> it is not required to wait until there is space.</p>

<p><strong>Obviously</strong> a full queue for a <em>Producer</em> is a 
non-ideal situation. Its maximum size and how that relates to the 
negative impact of dealing with a full queue must be carefully 
considered. Issues that deals with this, such as overwrite of old items,
 multiple priority queues, or other ways of handling this scenario are 
outside the scope of this article.</p>

<h2><a id="heading_background_article" name="heading_background_article">Background: Article Rationale</a></h2>

<p>Back in 2009 I published <a href="http://www.codeproject.com/KB/threads/ArticleVersion.aspx" ?aid="43510&amp;av=311159&quot;">my first CodeProject article</a> about a lock-free circular FIFO queue. In the military avionic industry I had seen what was in my view a <em>hazardous</em>
 technique for creating a lock-free circular FIFO. The queue was used 
for an interrupt handler as it pushed incoming messages from the 
interrupt handling to the real-time system.</p>

<p>If reading the original <a href="http://www.codeproject.com/KB/threads/ArticleVersion.aspx" ?aid="43510&amp;av=311159&quot;">version</a> of this article (also published <a href="http://www.kjellkod.cc/threadsafecircularqueue">here!</a>) there will be a description and reasoning of the <em>how, why and when</em> a hazardous technique <strong>could possibly work</strong> and when it <strong>would not work</strong>. The old article was written to try to understand this clearly discouraged technique but without recommending it.</p>

<p>The old article described a type of thread communication that goes against good <code>C++</code>
 practice using a circular FIFO queue that is highly platform dependent.
 It breaks easily as it is basically an ugly platform hack that looks 
appealing through an illusion of simplicity. It could break for 
something as simple as a compiler update or using it on another hardware
 architecture.</p>

<p>In the old article I gave a promise to publish a C++11 empowered queue that is lock-free through the use of <code>std::atomic</code>. <strong>That time has come now</strong>. <code>C++11</code> with its memory model, is available both <a href="http://kjellkod.wordpress.com/2012/06/02/g2log-now-with-mainstream-c11-implementation/">on Linux and Windows</a>. Using the <code>std::atomic</code> from the <code>‹atomic›</code> library effectively removes the need to ever again being tempted to use discouraged <a href="http://www.kjellkod.cc/threadsafecircularqueue#atomic_id">platform dependent hacks</a>.</p>

<p>The aim with the article is not only to show two wait-free, lock-free
 CircularFifo queues. The article is also explaining the rules governing
 the <code>C++11</code> memory models. After reading this article you should have an understanding of some of the fundamentals behind the <code>‹atomic›</code> library.</p>

<h2>Contents</h2>

<p>For those of you who want to read up on the inner workings of the 
Circular Queue, I have provided a short description of it and my 
implementation in <a href="#heading_part_I">Part I</a>. For those of you who are already familiar with it can shorten this read by going to <a href="#heading_part_II">Part II</a>. Part II describes briefly the <code>C++11</code> different memory models and how they with <code>std::atomic</code> are used to create the lock-free aspect of these circular queues.</p>

<h2><a href="#heading_part_I">Part I</a></h2>

<h2><a href="#heading_part_II">Part II</a></h2>

<ul>
	<li><a href="#heading_introduction">Introduction</a></li>
	<li><a href="#heading_background">Background: Circular FIFO Queue</a></li>
	<li><a href="#heading_background_article">Background: Article Rationale</a></li>
	<li><a href="#heading_disclaimer">Disclaimer</a></li>
	<li><a href="#heading_memory_model">Memory model: sequential or relaxed/acquire/release?</a></li>
	<li><a href="#heading_using_the_code">Using the code</a></li>
	<li><a href="#heading_code_explained">Code Explained: Circularfifo‹Type, Size›</a></li>
	<li><a href="#heading_how_it_works">How it works</a><br>
	  <a href="#heading_empty">Empty</a><br>
	  <a href="#heading_producer_adds_items">Producer adds items</a><br>
	  <a href="#heading_consumer_retrieves_item">Consumer retrieves item</a><br>
	  <a href="#heading_full">Full</a></li>
	<li><a href="#heading_thread_safe">Thread Safe Use and Implementation</a></li>
	<li><a href="#heading_making_it_work">Making It Work</a></li>
	<li><a href="#heading_atomic_operations">Atomic operations and the different Memory Models</a></li>
	<li><a href="#heading_sequential">Sequential Consistent</a><br>
	  <a href="#heading_rules_for_sequential">Rules for Sequential Consistent Memory Model and Operations</a><br>
	  <a href="#heading_sequential_code">Sequential Consistent Atmic Code</a><br>
	  <a href="#heading_sequential_caveats">Caveats with the Sequential Memory Model</a><br>
	  <a href="#heading_simplified_atomic_sequential">Simplified Atomic Sequential operations</a></li>
	<li><a href="#heading_refined_memory_order">Refined Memory Order</a></li>
	<li><a href="#heading_relaxed_memory_model">Relaxed-Memory Model</a><br>
	  <a href="#heading_rules_for_relaxed_memory_model">Rules for the Relaxed Memory Model and Operations</a></li>
	<li><a href="#heading_acquire_release_model">Acquire-Release Memory model</a><br>
	  <a href="#heading_rules_for_acquire_release">Rules for the Acquire-Release Memory Model and Operations</a></li>
	<li><a href="#heading_code_explained_acquire_release">Code Explained: Acquire-Release/Relaxed Circularfifo</a></li>
	<li><a href="#heading_platform_comparison">x86-x64 Comparison: Sequential vs Refined Memory Order</a></li>
	<li><a href="#heading_conclusions">Conclusion</a></li>
	<li><a href="#heading_history">History</a></li>
	<li><a href="#heading_references">References</a></li>
</ul>

<h2><a id="heading_disclaimer" name="heading_disclaimer">Disclaimer</a></h2>

<p><strong>Lock-free, really? But ...</strong><br>
The C++11 standard guarantees that the <strong><code>std::atomic_flag</code></strong> is lock-free. In fact the <code>std::atomic_flag</code> is the <strong>only</strong>
 type that is guaranteed to be lock-free. It is possible that some 
platform/library implementations will use locks internally for the 
native atomic types. However, although this is system dependent it is <strong>likely</strong> that many native atomic types are lock-free.</p>

<p>The <code>CircularFifo</code> provides a function <code>bool isLockFree() const {...} </code>that can be called to see if it is truly lock-free, even behind the scenes. ´</p>

<p><a id="heading_disclaimer" name="heading_disclaimer"></a><strong>But what about ...</strong><br>
Just like in the <a href="http://www.codeproject.com/KB/threads/ArticleVersion.aspx" ?aid="43510&amp;av=311159&quot;">old CodeProject article</a>
 this text is written to be simple and easy to understand. All the 
nitty-gritty details that an optimal solution might have are not 
covered. These details are usually in the area of:</p>

<ul>
	<li>Consumer/Producer handling for empty/full queues.</li>
	<li>Handling of variable sized items</li>
</ul>

<p><strong><strike>Multiple</strike> Producers, <strike>Multiple</strike> Consumers</strong><br>
<strong>Never use multiples</strong> of either Consumer or Producer for 
this queue. Using more Producer or Consumer threads breaks this design 
and corrupts the queue. This queue must only be used in a <strong>single Producer</strong> and <strong>single Consumer</strong> scenario. If more threads are needed, then a different solution should be used.</p>

<p><strong>Nothing <em>New</em>!</strong><br>
This article <strong>does not claim</strong> to introduce a new concept,
 or a new way of writing this type of lock-free circular queue. On the 
contrary, this article presents as far as I understand a well known, 
widely accepted way of writing such a queue. The resulting code is in 
fact remarkably similar to the <a href="https://bitbucket.org/KjellKod/lock-free-wait-free-circularfifo/src/8dae655acf689067e9ffa612bc5a3cb5cfc9e9f9/src/circularfifo_hazard_platform_dependent.hpp?at=default">old code</a>,
 almost identical. Comparing the code might give an illusion of only 
trivial code changes but the impact of the changes is enormous. The real
 difference is the atomic declaration and handling. This is of course a 
huge difference since there are lots of things happening behind the 
scenes</p>

<p>The old code should be considered <em>broken</em> and where the old code is not guaranteed to work by any standard the code presented here should work according to the new <code>C++11</code> standard [2].</p>

<p><strong>Public Domain</strong><br>
Use the code on your own risk. I am using it myself of course but because of the <em>Public Domain</em>
 status I will not give any guarantees. Nor will I give any promises in 
case of bugs that might have slipped me by. Using the code or not is 
your own responsibility. Using the code can be done freely with no 
obligations to me or towards a license. Modify and use the code to your 
hearts content.</p>

<p><strong>Tail first or Head first?</strong><br>
Should items be added at the tail and removed at the head, or is the opposite more logical? The <a href="http://en.wikipedia.org/wiki/FIFO#Head_or_tail_first">opinions differ</a>. This article uses the methodology of "<em>items are added at the tail, removed from the head</em>" to be consistent with the old article and to make it similar with the common and well-known <code>pop_front</code> and <code>push_back</code> queue operations.</p>

<h2><a id="heading_memory_model" name="heading_memory_model"></a>Memory model: sequential or relaxed/acquire/release?</h2>

<p>Two versions of the wait and lock-free circular FIFO are presented. 
The first, most intuitive, use C++11 default memory-ordering <code>memory_order_seq_cst</code>. The other, somewhat more complicated, use <code>memory_order_relaxed</code>, <code>memory_order_acquire</code> and <code>memory_order_release</code>. The use of the memory orders will be explained and I will also try to show that the default <code>memory_order_seq_cst</code> is not only the easiest to reason about but also has very good performance on x86-x64 architectures.</p>

<h2><a id="heading_part_I" name="heading_part_I"></a>Part I</h2>

<h2><a id="heading_using_the_code" name="heading_using_the_code"></a>Using the code</h2>

<p>Please remember to use only <strong>one</strong> thread as the Producer and only <strong>one</strong>
 thread as the Consumer. If more threads are involved on either side it 
will break the thread-safe design and corrupt the Producer → Consumer 
communication.</p>

<p>It could not be any simpler to use the code.</p>

<div class="pre-action-link" id="premain51267" style="width:100%;display:block;"><span id="prehide51267" onclick="processCodeBlocks.togglePre(51267);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(51267);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre51267" lang="C++">CircularFifo&amp;lsaquo;Message, 128&amp;rsaquo; queue;     <span class="code-comment">//</span><span class="code-comment"> 128 'Messages' will fit
</span>  
<span class="code-comment">/*</span><span class="code-comment"> Producer thread */</span>
Message m = ...
<span class="code-keyword">if</span> ( <span class="code-keyword">false</span> == queue.push(m)) { <span class="code-comment">/*</span><span class="code-comment">false equals full queue */</span> }
  
  
<span class="code-comment">/*</span><span class="code-comment"> Consumer thread */</span>
Message m;
<span class="code-keyword">if</span> ( <span class="code-keyword">false</span> == queue.pop(m)) { <span class="code-comment">/*</span><span class="code-comment"> false equals empty queue */</span> }</pre>

<p>You can find more examples in the unit tests that come with the code.</p>

<h2><a id="heading_code_explained" name="heading_code_explained">Code Explained: Circularfifo‹Type, Size›</a></h2>

<p>Let us go straight to the sequential consistent code without further 
ado. The code is slightly simplified to increase article readability. If
 you prefer the full syntax you could open up the code and view it 
side-by-side.</p>

<div class="pre-action-link" id="premain553576" style="width:100%;display:block;"><span id="prehide553576" onclick="processCodeBlocks.togglePre(553576);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(553576);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre553576" lang="C++">template&amp;lsaquo;<span class="code-keyword">typename</span> Element, <span class="code-sdkkeyword">size_t</span> Size&amp;rsaquo; 
<span class="code-keyword">class</span> CircularFifo{
<span class="code-keyword">public</span>:
  <span class="code-keyword">enum</span> { Capacity = Size+1 };

  CircularFifo() : _tail(<span class="code-digit">0</span>), _head(<span class="code-digit">0</span>){}   
  <span class="code-keyword">virtual</span> ~CircularFifo() {}

  <span class="code-keyword">bool</span> push(<span class="code-keyword">const</span> Element&amp; item); 
  <span class="code-keyword">bool</span> pop(Element&amp; item);

  <span class="code-keyword">bool</span> wasEmpty() <span class="code-keyword">const</span>;
  <span class="code-keyword">bool</span> wasFull() <span class="code-keyword">const</span>;
  <span class="code-keyword">bool</span> isLockFree() <span class="code-keyword">const</span>;

<span class="code-keyword">private</span>:
  <span class="code-sdkkeyword">size_t</span> increment(<span class="code-sdkkeyword">size_t</span> idx) <span class="code-keyword">const</span>; 

  std::atomic&amp;lsaquo;size_t&amp;rsaquo;  _tail;  
  Element              _array[Capacity];
  std::atomic&amp;lsaquo;size_t&amp;rsaquo;  _head; 
};</pre>

<h2><a id="heading_how_it_works" name="heading_how_it_works">How it works</a></h2>

<p>The first described queue uses the <strong>default, sequential</strong>
 atomic operations. The sequential model makes it easy to reason about 
the atomics and how they relate in respect to atomic operations in other
 threads. On the strong hardware memory (e.g. processor) architectures 
that <code>x86</code> and <code>x64</code> have it gives some performance overhead when using the <em>sequential atomic</em> <code>CircularFifo</code> compared to the later discussed <code>CircularFifo</code> that uses fine grained <code>std::memory_order_</code>{<code>relaxed/acquire/release</code>}.</p>

<p>On a weakly ordered memory architecture the performance difference between the queues would be more significant.</p>

<p><strong>Push and Pop</strong><br>
<code>bool push(Item&amp;)</code> will be done by a Producer thread. The <code>bool pop(Item&amp;)</code> will be used by the Consumer thread.</p>

<h3><a id="heading_empty" name="heading_empty">Empty </a></h3>

<p><img alt="Empty Queue" complete="true" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/fifo_empty.jpg" height="81" hspace="0" border="0" width="423"></p>

<p>When the buffer is <strong>empty</strong>, both indexes will be the same. Any reads by the Consumer will fail.</p>

<div class="pre-action-link" id="premain968035" style="width:100%;display:block;"><span id="prehide968035" onclick="processCodeBlocks.togglePre(968035);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(968035);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre968035" lang="C++"><span class="code-keyword">bool</span> wasEmpty() <span class="code-keyword">const</span>
{
  <span class="code-keyword">return</span> (_head.load() == _tail.load());
}
</pre>

<p>Any attempts by the Consumer to retrieve, <code>bool pop(Item&amp;)</code>, when the queue is empty will <strong>fail</strong>. Checking if the queue is empty with <code>wasEmpty()</code> will give a snapshot of the queue status. Of course the <em>empty</em>
 status might change before the reader has even acted on it. This is OK 
and fine, it should be treated as a snapshot and nothing else.</p>

<h3><a id="heading_producer_adds_items" name="heading_producer_adds_items">Producer adds items</a></h3>

<p>The Producer adds, <code>push()</code>, a new item at the position 
indexed by the tail. After writing, the tail is incremented one step, or
 wrapped to the beginning if at end of the queue. The queue grows with 
the tail.</p>

<p><img alt="Empty Queue" complete="true" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/fifo_one_item.jpg" height="83" hspace="0" border="0" width="425"></p>

<div class="pre-action-link" id="premain729098" style="width:100%;display:block;"><span id="prehide729098" onclick="processCodeBlocks.togglePre(729098);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(729098);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre729098" lang="C++"><span class="code-comment">/*</span><span class="code-comment"> Producer only: updates tail index <strong>after</strong> setting the element in place */</span>
<span class="code-keyword">bool</span> push(Element&amp; item_)
{	
  <span class="code-keyword">auto</span> current_tail = _tail.load();            
  <span class="code-keyword">auto</span> next_tail = increment(current_tail);    
  <span class="code-keyword">if</span>(next_tail != _head.load())                         
  {
    _array[current_tail] = item;               
    _tail.store(next_tail);                    
    <span class="code-keyword">return</span> <span class="code-keyword">true</span>;
  }
  
  <span class="code-keyword">return</span> <span class="code-keyword">false</span>;  <span class="code-comment">//</span><span class="code-comment"> full queue
</span>}
</pre>

<p>The Producer adds another item and the tail is incremented again.</p>

<p><img alt="Producer adds second item" complete="true" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/fifo_two_items.jpg" height="81" hspace="0" border="0" width="421"></p>

<h3><a id="heading_consumer_retrieves_item" name="heading_consumer_retrieves_item">Consumer retrieves item</a></h3>

<p>The Consumer retrieves, <code>pop()</code>, the item indexed by the 
head. The head is moved toward the tail as it is incremented one step. 
The queue shrinks with the head.</p>

<p><img alt="Empty Queue" complete="true" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/fifo_one_item_b.jpg" height="86" hspace="0" border="0" width="425"></p>

<div class="pre-action-link" id="premain694253" style="width:100%;display:block;"><span id="prehide694253" onclick="processCodeBlocks.togglePre(694253);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(694253);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre694253" lang="C++"><span class="code-comment">/*</span><span class="code-comment"> Consumer only: updates head index <strong>after</strong> retrieving the element */</span>
<span class="code-keyword">bool</span> pop(Element&amp; item)
{
  <span class="code-keyword">const</span> <span class="code-keyword">auto</span> current_head = _head.load();  
  <span class="code-keyword">if</span>(current_head == _tail.load())  
    <span class="code-keyword">return</span> <span class="code-keyword">false</span>;   <span class="code-comment">//</span><span class="code-comment"> empty queue
</span>
  item = _array[current_head]; 
  _head.store(increment(current_head)); 
  <span class="code-keyword">return</span> <span class="code-keyword">true</span>;
}</pre>

<h3><a id="heading_full" name="heading_full">Full</a></h3>

<p>If the Producer pushes more items onto the queue than the Consumer can keep up with, the queue will eventually become full.</p>

<p><img alt="Full Queue" complete="true" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/fifo_full.jpg" height="85" hspace="0" border="0" width="424"></p>

<p>When the queue is full, there will be a one slot difference between 
head and tail. At this point, any writes by the Producer will fail. Yes 
it <strong>must</strong> even fail since otherwise the <strong>empty queue</strong> criterion i.e. <code>head == tail</code> would come true.</p>

<div class="pre-action-link" id="premain788182" style="width:100%;display:block;"><span id="prehide788182" onclick="processCodeBlocks.togglePre(788182);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(788182);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre788182" lang="C++"><span class="code-keyword">bool</span> wasFull() <span class="code-keyword">const</span>
{
  <span class="code-keyword">const</span> <span class="code-keyword">auto</span> next_tail = increment(_tail.load());
  <span class="code-keyword">return</span> (next_tail == _head.load());
}


<span class="code-sdkkeyword">size_t</span> increment(<span class="code-sdkkeyword">size_t</span> idx) <span class="code-keyword">const</span>
{
  <span class="code-keyword">return</span> (idx + <span class="code-digit">1</span>) % Capacity;
}</pre>

<h4>% modulus operator</h4>

<p>The <code>%</code> modulus operator can be confusing if not encountered before. The <code>% operator</code>
 gives the remainder from integer division. It can be used in a range of
 ways and here it is used to calculate when the index should be wrapped 
back to the beginning in a <em>circular</em> way.</p>

<div class="pre-action-link" id="premain96875" style="width:100%;display:block;"><span id="prehide96875" onclick="processCodeBlocks.togglePre(96875);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(96875);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre96875" lang="C++"> <span class="code-comment">//</span><span class="code-comment"> Example: A CircularFifo with Size of 99
</span> <span class="code-comment">//</span><span class="code-comment"> Capacity is Size+1. The padding of +1 is used to simplify the logic
</span> increment(<span class="code-digit">98</span>) ---&gt; will yield <span class="code-digit">99</span>
 increment(<span class="code-digit">99</span>) ---&gt; will yield <span class="code-digit">0</span> 
}</pre>

<p>When the <code>next_tail</code> showed in <code>push()</code> is one larger then the queue's size it wraps back to the beginning, i.e., <code>index 0</code>.</p>

<h2><a id="heading_thread_safe" name="heading_thread_safe">Thread Safe Use and Implementation</a></h2>

<p>The thread safety is ensured through the class design and its 
intended use. Only two functions can modify the state of the queue, <code>push()</code> and <code>pop()</code>. Only one thread should be allowed to touch <code>push()</code>. Only one thread should be allowed to touch <code>pop()</code>. Thread safety is guaranteed in this way when <code>push()</code> and <code>pop()</code> are used by a at most <strong>one</strong> corresponding <strong>thread</strong>. The Producer thread should only access <code>push()</code> and the Consumer thread only <code>pop()</code>.</p>

<p><strong><em>The design can be further emphasized with access through interfaces</em></strong> but for this article I think it is enough to clarify it here and in the comments. For a real-world project it <em>might</em> make sense to use something like <code>SingleConsumerInputQueue</code> and <code>SingleProducerOutputQueue</code> interfaces to decrease the risk for <em>error by confusion</em>.</p>

<p><strong>Atomic access when used the intended way</strong><br>
Producer: <code>push()</code> writes only to the <code>tail</code>, but reads a <code>head</code> snapshot to verify queue is not full.<br>
Consumer: <code>pop()</code> writes only to the <code>head</code>, but reads a <code>tail</code> snapshot to verify that the queue is not empty. Only the Producer thread will update <code>tail</code> and only the Consumer thread will update head.</p>

<p><strong>However</strong> reading and writing of both tail and head 
must be thread safe in the sense that we do not want to read old, cached
 values and both reads and writes must be atomic. As explained below the
 update of <code>tail</code> and <code>head</code> indexes are atomic. 
The atomic read/write together with this class design will ensure thread
 safety for at most one Producer thread and one Consumer thread.</p>

<p><strong>Important</strong>: The text further down explains how 
atomic, non-reordered reads and writes are achieved for this Circular 
Queue. It is probably the most important part of this article. It 
explains both the <code>sequential</code> and the <code>acquire-release/relaxed models</code>.</p>

<h2><a id="heading_thread_safe" name="heading_thread_safe"></a><a id="heading_part_II" name="heading_part_II">Part II</a></h2>

<h2><a id="heading_making_it_work" name="heading_making_it_work">Making It Work</a></h2>

<p>It is imperative that the head and tail indexes must be updated only <strong>after</strong> the element (<code>pop()</code> or <code>push()</code>) is read or written. Thus, any updates to the <code>head</code> or <code>tail</code> will ensure proper access to the elements. For this to work, the read and writes of the <code>head</code> and <code>tail</code> must be atomic and must not be re-ordered.</p>

<h2><a id="heading_atomic_operations" name="heading_atomic_operations">Atomic operations and the different Memory Models</a></h2>

<p>Below is described a subset of the functionality that you can get 
from the different C++11 memory models and atomic operations. It is in 
no way comprehensive but contains the necessary pieces to explain both 
types of the C++11 empowered wait-free, lock-free circular queue.</p>

<p>There are <strong>three different memory-ordering models</strong> in C++11 and with them six ordering options.</p>

<ol>
	<li>Sequentially consistent model
	<ul>
		<li><code>memory_order_seq_cst</code></li>
	</ul>
	</li>
	<li>acquire-release model
	<ul>
		<li><code>memory_order_consume</code></li>
		<li><code>memory_order_acquire</code></li>
		<li><code>memory_order_release</code></li>
		<li><code>memory_order_acq_rel</code></li>
	</ul>
	</li>
	<li>relaxed model
	<ul>
		<li><code>memory_order_relaxed</code></li>
	</ul>
	</li>
</ol>

<h2><a id="heading_sequential" name="heading_sequential">Sequential Consistent</a></h2>

<p>The default, sequential memory ordering is used in the code example 
above. This atomic, sequentially consistent memory model is probably 
what most of us are comfortable with when reasoning about possibly 
sequences of threaded atomic operations.</p>

<h3><a id="heading_rules_for_sequential" name="heading_rules_for_sequential">Rules for Sequential Consistent Memory Model and Operations</a></h3>

<ol>
	<li>
	<p>A sequential consistent store will be synchronized with a sequential
 consistent load of the same data. It is guaranteed thanks to a global 
synchronization between involved threads.</p>
	</li>
	<li>
	<p>All threads participating in these sequential atomic operations will see exactly the same order of the operations.</p>
	</li>
	<li>
	<p>Atomic operations within the same thread cannot be reordered.</p>
	</li>
	<li>A seqence of atomic operations in one thread will have the same sequence of order seen by other threads</li>
</ol>

<h3><a id="heading_sequential_code" name="heading_sequential_code">Sequential Consistent Atmic Code</a></h3>

<p>These rules give that the sequential atomic operations used in <code>push()</code> and <code>pop()</code> are safe. Let us recap with <code>pop()</code> to demonstrate this:</p>

<div class="pre-action-link" id="premain614564" style="width:100%;display:block;"><span id="prehide614564" onclick="processCodeBlocks.togglePre(614564);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(614564);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre614564" lang="C++"><span class="code-comment">/*</span><span class="code-comment"> Consumer only: updates head index <strong>after</strong> retrieving the element */</span>
<span class="code-keyword">bool</span> pop(Element&amp; item)
{
  <span class="code-keyword">const</span> <span class="code-keyword">auto</span> current_head = _head.load();  <span class="code-comment">//</span><span class="code-comment"> 1. loads sequentially the head
</span>  <span class="code-keyword">if</span>(current_head == _tail.load())         <span class="code-comment">//</span><span class="code-comment"> 2. compares head to snapshot of tail
</span>    <span class="code-keyword">return</span> <span class="code-keyword">false</span>;   <span class="code-comment">//</span><span class="code-comment"> empty queue
</span>
  item = _array[current_head];             <span class="code-comment">//</span><span class="code-comment"> 3. retrievs the item pointed to by head
</span>  _head.store(increment(current_head));    <span class="code-comment">//</span><span class="code-comment"> 4. update the head index to new position
</span>  <span class="code-keyword">return</span> <span class="code-keyword">true</span>;
}
</pre>

<p>The <em>atomic sequential</em> rules guarantee that step 3-4&nbsp;&nbsp;will not be reordered <span style="font-size: 14.4444446563721px;">&nbsp;(</span><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?msg=4970744#xx4970744xx"><sub><em>reordering would however not be harmful</em></sub></a><span style="font-size: 14.4444446563721px;">). The <em>atomic sequential rules </em>guarantee also that </span>the&nbsp;<em>Consumer</em> thread will not get out-of-order updates when reading the tail snapshot with <code>head.load()</code></p>

<p>It is with this sequential memory model you can get this warm fuzzy 
feeling in your stomach. It seems easy to reason about, right?</p>

<h3><a id="heading_sequential_caveats" name="heading_sequential_caveats">Caveats with the Sequential Memory Model</a></h3>

<p><strong>Caveat 1</strong>:<br>
<strong>Non-sequential</strong>, relaxed memory atomic operations might 
not see the same ordering of operations as the sequential, atomic, 
operations. To get the power of <em>easy-to-reason-about</em> ordering 
of operations the sequentially consistent memory ordering should be used
 for all atomic operations that are interacting.</p>

<p><a id="heading_sequential_caveats" name="heading_sequential_caveats"></a><strong>Caveat 2</strong>:<br>
On the x86-x64 processor architecture which use a strong hardware memory model [6] the sequential consistent model is <a href="#heading_platform_comparison">relatively cheap</a>.
 On a weakly-ordered hardware memory architecture [7] the sequential 
consistent model is more expensive as it requires more internal 
synchronization operations. On such weakly-ordered hardware memory 
architecture the sequential consistent model will have a significant 
performance penalty due to much higher synchronization overhead then the
 <em>acquire-release</em> memory model.</p>

<h3><a id="heading_simplified_atomic_sequential" name="heading_simplified_atomic_sequential"></a>Simplified Atomic Sequential operations</h3>

<p>One last thing on the sequential atomic operations: Not only are they
 easy to reason about they are also easier to write. Since they are the 
default choice it is not necessary to write explicitly the memory 
operation type.</p>

<div class="pre-action-link" id="premain132981" style="width:100%;display:block;"><span id="prehide132981" onclick="processCodeBlocks.togglePre(132981);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(132981);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre132981" lang="C++"><span class="code-keyword">bool</span> CircularFifo::wasFull() <span class="code-keyword">const</span>
{
  <span class="code-keyword">auto</span> index = _tail.load();
  <span class="code-keyword">auto</span> next_tail = (index + <span class="code-digit">1</span>) % Capacity;
  <span class="code-keyword">return</span> (next_tail == _head.load());
}</pre>

<p>Using the default means that you can write <code>_tail.load()</code> and not specify the memory order. You <strong>can</strong> of course explicitly write that it is using the sequential consistent memory order <code>std::memory_order_seq_cst</code>.</p>

<div class="pre-action-link" id="premain576302" style="width:100%;display:block;"><span id="prehide576302" onclick="processCodeBlocks.togglePre(576302);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(576302);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre576302" lang="C++"><span class="code-keyword">bool</span> CircularFifo::wasFull() <span class="code-keyword">const</span>
{
  <span class="code-keyword">auto</span> index = _tail.load(std::memory_order_seq_cst);
  <span class="code-keyword">auto</span> next_tail = (index + <span class="code-digit">1</span>) % Capacity;
  <span class="code-keyword">return</span> (next_tail == _head.load(std::memory_order_seq_cst));
}</pre>

<h2><a id="heading_refined_memory_order" name="heading_refined_memory_order"></a>Refined Memory Order</h2>

<p>Using the fine grained memory models <em>acquire-release</em> and <em>relaxed</em>, together can squeeze out better performance thanks to less synchronization overhead. The nice to reason about <em>global synchronization guarantee</em> from the sequential consistent model is no longer there.</p>

<p>Threads may now see different views of the interacting atomic operations. It is time to thread <small>(pun intended)</small> very carefully. Quoting Anthony Williams: <small>[1, chapter 5.3.3 Memory ordering for atomic operations]</small></p>

<p style="TEXT-ALIGN: center"><em>"In the absence of other ordering 
constraints, the only requirements is that all threads agree on the 
modification order of each individual variable" </em></p>

<p>Below are written short, simplified examples for the two fine-grained
 memory models, relaxed and aquire-release. The area is more advanced 
then explained here but it is enough for explaining this lock-free code 
and can work as an <strong>initial</strong> introduction to the fine grained atomic operations.</p>

<h2><a id="heading_relaxed_memory_model" name="heading_relaxed_memory_model"></a>Relaxed-Memory Model</h2>

<p>The relaxed atomic operations can be powerful if used together with 
acquire-release operations. By itself the relaxed operations can cause 
quite a bit of confusion for the unwary.</p>

<h3><a id="heading_rules_for_relaxed_memory_model" name="heading_rules_for_relaxed_memory_model"></a>Rules for the Relaxed Memory Model and Operations</h3>

<ol>
	<li>
	<p>Relaxed atomic opertions on the same variable, on the same thread guarantee happens-before ordering within that same thread.</p>
	</li>
	<li>
	<p>Operations on the same thread, on the same variable will not be reordered</p>
	</li>
	<li>
	<p>For a synchronized ordering between threads there must be a pair of <em>acquire - release</em>.</p>
	</li>
	<li>
	<p>Only the modification order of the atomic operations on a variable 
is communicated to other threads, but as the relaxed memory operation 
does not use <em>synchronize-with</em> the result may surprise you...</p>
	</li>
</ol>

<h4>Relaxed-Memory operations example</h4>

<p>Example inspired from C++11 standard [2, <small>§29.3 Atomics Opertions Library: "Order and Consistency"</small>].</p>

<div class="pre-action-link" id="premain609990" style="width:100%;display:block;"><span id="prehide609990" onclick="processCodeBlocks.togglePre(609990);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(609990);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre609990" lang="C++"><span class="code-comment">//</span><span class="code-comment"> A possible thread interleaving snapshot, i.e. below is an 
</span><span class="code-comment">//</span><span class="code-comment"> possible 'chronological' order of events between two threads
</span><span class="code-comment">//</span><span class="code-comment"> as they actually "happen"  
</span>
<span class="code-comment">//</span><span class="code-comment"> x, y are initially zero
</span>
<span class="code-comment">//</span><span class="code-comment"> thread_1
</span><span class="code-keyword">auto</span> r1 = y.load(std::memory_order_relaxed);    <span class="code-comment">//</span><span class="code-comment"> t1: 1
</span>x.store(r1, std::memory_order_relaxed);         <span class="code-comment">//</span><span class="code-comment"> t1: 2
</span>
<span class="code-comment">//</span><span class="code-comment"> thread_2
</span><span class="code-keyword">auto</span> r2 = x.load(std:memory_order_relaxed);     <span class="code-comment">//</span><span class="code-comment"> t2: 1
</span>y.store(<span class="code-digit">123</span>, std::memory_order_relaxed);        <span class="code-comment">//</span><span class="code-comment"> t2: 2</span></pre>

<p>These are thread operations that are <strong>memory unordered</strong>. Even if the thread interleaving snapshot happens in the above <em>chronological</em> order the events can <em>impact</em> in a different sequence.</p>

<p>I.e. the following <strong>impact</strong> sequence is possible</p>

<div class="pre-action-link" id="premain314644" style="width:100%;display:block;"><span id="prehide314644" onclick="processCodeBlocks.togglePre(314644);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(314644);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre314644" lang="C++">y.store(<span class="code-digit">123</span>, std::memory_order_relaxed);        <span class="code-comment">//</span><span class="code-comment"> t2: 2
</span><span class="code-keyword">auto</span> r1 = y.load(std::memory_order_relaxed);    <span class="code-comment">//</span><span class="code-comment"> t1: 1
</span>x.store(r1, std::memory_order_relaxed);         <span class="code-comment">//</span><span class="code-comment"> t1: 2
</span><span class="code-keyword">auto</span> r2 = x.load(std:memory_order_relaxed);     <span class="code-comment">//</span><span class="code-comment"> t2: 1</span></pre>

<p>Resulting in <strong>r1 = r2 = 123;</strong>.</p>

<h2><a id="heading_acquire_release_model" name="heading_acquire_release_model"></a>Acquire-Release Memory model</h2>

<p>The acquire-release memory model give <em>some guarantees</em> for thread synchronization</p>

<h3><a id="heading_rules_for_acquire_release" name="heading_rules_for_acquire_release"></a>Rules for the Acquire-Release Memory Model and Operations</h3>

<ol>
	<li>
	<p>No guaranteed order for <em>all</em> atomic operations</p>
	</li>
	<li>
	<p>Still, it has stronger synchronization orderings than relaxed</p>
	</li>
	<li>
	<p>Guaranteed <em>thread-pair</em> ordering synchronization. I.e.between the thread that does <em>release</em> and the thread that does <em>acquire</em></p>
	</li>
	<li>
	<p>Reordering is restricted but still not sequential...</p>

	<div class="pre-action-link" id="premain96320" style="width:100%;display:block;"><span id="prehide96320" onclick="processCodeBlocks.togglePre(96320);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(96320);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre96320" lang="C++"><span class="code-comment">//</span><span class="code-comment"> thread_1: 
</span>y.store(<span class="code-keyword">true</span>, std::memory_order_release);
 
<span class="code-comment">//</span><span class="code-comment">thread_2:
</span><span class="code-keyword">while</span>(!y.load(std::memory_order_acquire));</pre>

	<p>It is guaranteed that <em>thread_2</em> will, <strong>at some point</strong>, see that <strong><code>y</code></strong> is true and exit the <em>while-loop</em>. The <code>memory_order_release</code> synchronizes with the <code>memory_order_acquire</code>.</p>
	</li>
	<li>
	<p>Relaxed operations obey a <em>happens-before</em> rule that can be used together with acquire-release operations...</p>

	<div class="pre-action-link" id="premain338308" style="width:100%;display:block;"><span id="prehide338308" onclick="processCodeBlocks.togglePre(338308);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(338308);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre338308" lang="C++"><span class="code-comment">//</span><span class="code-comment"> thread_1
</span>x.store(<span class="code-digit">123</span>, std::memory_order_relaxed); <span class="code-comment">//</span><span class="code-comment"> relaxed X happens-before Y store
</span>y.store(<span class="code-keyword">true</span>, std::memory_order_release);

<span class="code-comment">//</span><span class="code-comment"> thread_2
</span><span class="code-keyword">while</span>(!y.load(std::memory_order_acquire));
assert(<span class="code-digit">123</span> == x.load(std::memory_order_relaxed));</pre>

	<p>The <em>happens-before</em> relationship <strong>guarantees</strong> that there will be <strong>no assert failure</strong> in <code>assert(123 == x.load(relaxed))</code>.</p>

	<p>Since the <em>thread_1</em>: <code>x.store(123,relaxed)</code> <strong>happens-before</strong> the <code>y.store(true, release)</code> it is guaranteed that when <em>thread_2</em>: reads <code>true == y.load(acquire)</code> the value of x must already be 123.</p>
	</li>
</ol>

<h2><a id="heading_code_explained_acquire_release" name="heading_code_explained_acquire_release"></a>Code Explained: Acquire-Release/Relaxed Circularfifo</h2>

<p>The fine grained memory models and operations explained above can be used to create even more effective <code>push()</code> and <code>pop()</code> operations.</p>

<p>Remember that the Producer could only update one variable (<code>tail</code>) and the Consumer could only update one member variable (<code>head</code>).</p>

<p>The relexed memory operation is only used for loading the atomic 
variable in that very thread that is responsible for updating the 
variable. Within the same thread the relaxed operation cannot be 
reordered for the variable.</p>

<h4>bool push(const Element&amp; item)</h4>

<div class="pre-action-link" id="premain833714" style="width:100%;display:block;"><span id="prehide833714" onclick="processCodeBlocks.togglePre(833714);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(833714);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre833714" lang="C++"><span class="code-keyword">bool</span> push(<span class="code-keyword">const</span> Element&amp; item)
{       
  <span class="code-keyword">const</span> <span class="code-keyword">auto</span> current_tail = _tail.load(std::memory_order_relaxed);  <span class="code-comment">//</span><span class="code-comment"> 1
</span>  <span class="code-keyword">const</span> <span class="code-keyword">auto</span> next_tail = increment(current_tail);                   
  <span class="code-keyword">if</span>(next_tail != _head.load(std::memory_order_acquire))            <span class="code-comment">//</span><span class="code-comment"> 2               
</span>  {     
    _array[current_tail] = item;                                    <span class="code-comment">//</span><span class="code-comment"> 3
</span>    _tail.store(next_tail, std::memory_order_release);              <span class="code-comment">//</span><span class="code-comment"> 4
</span>    <span class="code-keyword">return</span> <span class="code-keyword">true</span>;
  }
  <span class="code-keyword">return</span> <span class="code-keyword">false</span>; <span class="code-comment">//</span><span class="code-comment"> full queue
</span>}</pre>

<ol>
	<li><small><em>Relaxed loading</em> of the <code>tail</code> value. Since the Producer thread is the only thread calling <code>push()</code> it is guaranteed that the tail value will be the latest. No cross-thread synchronization is needed for the load. </small></li>
	<li><small>The <code>next_tail</code> is compared against the <code>head</code> value snapshot. The <code>head</code> value is pair-wise <em>acquire-release</em> synchronized. It is guaranteed to never come <em>out-of-order</em> with following <code>head</code> updates. </small></li>
	<li><small>The item is saved in the position pointed to by the <em>not-yet-synchronized</em> <code>next_tail</code>. This <em>happens-before</em> the <code>release</code> store in (4) and is guaranteed that the save is <em>seen</em> before (4). </small></li>
	<li><small>The <code>tail</code> is updated with <code>release</code> order. Pair-synchronization with the Consumer thread is guaranteed with the Consumer's <code>acquire</code> reading of <code>tail</code>. </small></li>
</ol>

<h4>bool pop(const Element&amp; item)</h4>

<div class="pre-action-link" id="premain397496" style="width:100%;display:block;"><span id="prehide397496" onclick="processCodeBlocks.togglePre(397496);">Hide</span>  &nbsp; <span onclick="return processCodeBlocks.copyCode(397496);">Copy Code</span></div><pre style="margin-top: 0px;" id="pre397496" lang="C++"><span class="code-keyword">bool</span> pop(Element&amp; item)
{
  <span class="code-keyword">const</span> <span class="code-keyword">auto</span> current_head = _head.load(std::memory_order_relaxed);    <span class="code-comment">//</span><span class="code-comment"> 1
</span>  <span class="code-keyword">if</span>(current_head == _tail.load(std::memory_order_acquire))           <span class="code-comment">//</span><span class="code-comment"> 2
</span>    <span class="code-keyword">return</span> <span class="code-keyword">false</span>; <span class="code-comment">//</span><span class="code-comment"> empty queue
</span>
  item = _array[current_head];                                       <span class="code-comment">//</span><span class="code-comment"> 3
</span>  _head.store(increment(current_head), std::memory_order_release);   <span class="code-comment">//</span><span class="code-comment"> 4
</span>  <span class="code-keyword">return</span> <span class="code-keyword">true</span>;
}</pre>

<ol>
	<li><small><em>Relaxed loading</em> of the <code>head</code> value. Since the Consumer thread is the only thread calling <code>pop()</code> it is guaranteed that the <code>head</code> value will be the latest. No cross-thread synchronization is needed for the load. </small></li>
	<li><small>The <code>current_head</code> is compared against the <code>tail</code> value snapshot. The <code>tail</code> value is pair-wise <em>acquire-release</em> synchronized. It is guaranteed to never come <em>out-of-order</em> with following <code>tail</code> updates. </small></li>
	<li><small>The item is retrieved from the position pointed to by the <code>current_head</code>. This <em>happens-before</em> the <code>release</code> store in (4). </small></li>
	<li><small>The <code>head</code> is updated with <code>release</code> order. Pair-wise synchronization with the Producer's thread is guaranteed with the Producer's <code>acquire</code> reading of <code>tail</code>. </small></li>
</ol>

<p><strong>Summary</strong><br>
There is <em>thread-pair</em> ordering synchronization between the Producer and the Consumer for <code>tail</code> and <code>head</code>. The Producer can never see out-of-order updates for the Consumer updated <code>head</code> and vice-versa for <code>tail</code>.</p>

<h2><a id="heading_platform_comparison" name="heading_platform_comparison"></a>x86-x64 Comparison: Sequential vs. Refined Memory Order</h2>

<p>So does it really matter if using the acquire-release-relaxed type of <code>CircularFifo</code> compared to the sequential?</p>

<p>A very quick and not very scientific test both on Windows (VS2012) and Linux (gcc 4.7.2) <a href="https://docs.google.com/spreadsheet/pub?key=0AkliMT3ZybjAdGJvbWpXclZyaHotNDRqbU5ib0xDaEE&amp;output=html">showed that</a></p>

<ul>
	<li>Windows (x64): acquire-release was approximately 23% faster then the sequential.</li>
	<li>Windows (x86): acquire-release was approximately 22% faster then the sequential.</li>
	<li>Linux (x64): acquire-release was approximately 44% faster then the sequential.</li>
	<li>Linux (x68): acquire-release was approximately 36% faster then the sequential.</li>
</ul>

<h2><a id="heading_conclusions" name="heading_conclusions"></a>Conclusion</h2>

<p>When I wrote the original article it was a platform hack. Such hacks are no longer necessary. With C++11 <code>std::atomic</code>
 can supply all the needed functionality. The big caveat is that apart 
from the sequential consistent model it is pretty hard to reason about 
how the operations interact.</p>

<p>The sequential consistent model is very easy to reason about and to implement in a simple structure such as the <code>CircularFifo</code>. Whether or not you use that one or the acquire-release type is up to you.</p>

<p><strong>Finally</strong> I have reached the end of this long article.
 Thank you for reading it. Any comments, improvement suggestions or 
questions are more then welcome.</p>

<h2><a id="heading_history" name="heading_history"></a>History</h2>

<p><strong>Initial Version &nbsp;</strong>&nbsp;</p>

<ul>
	<li>3<sup>rd</sup> November, 2009: Initial version</li>
	<li>4<sup>th</sup> November, 2009: Corrected sentences and highlighted keywords</li>
	<li>12<sup>th</sup> November, 2009: Corrected text after feedback from readers. Fixed pictures and code display problems</li>
	<li>10<sup>th</sup> June, 2011: "full queue" image and corresponding text after feedback from a <a href="http://www.codeproject.com/Messages/3634954/Great-job-vote-5-Question-on-the-picture-of-full-q.aspx">reader</a></li>
</ul>

<p><strong>Complete rewrite for safe use thanks to C++11 atomic </strong>&nbsp;</p>

<ul>
	<li>27<sup>th</sup> November, 2012: Complete <strong>rewrite</strong>. Using C++11 atomics, showing sequential consistent and acquire-release, relaxed orderded atomics to build the CircularFifo.</li>
	<li>2<sup>nd</sup> December, 2012: Spell check correction, separation of article in Part I and Part II for an easier read.</li>
	<li>29<sup>th</sup>&nbsp; December, 2014. Updated &nbsp;the atomic 
sequential text in regard to reordering and integrity of the queues. 
Corrected &nbsp;typos.&nbsp;</li>
</ul>

<h2><a id="heading_references" name="heading_references">References</a></h2>

<ol>
	<li>Anthony Williams book <a href="http://www.manning.com/williams/">C++ Concurrency in Action: Practical Multithreading</a></li>
	<li>C++11 <a href="http://www.iso.org/iso/home/store/catalogue_tc/catalogue_detail.htm?csnumber=50372">ISO IEC_14882:2011 (costs $)"</a>.<br>
	A free, slightly newer <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2012/n3337.pdf%22">draft (n3337)</a> version (but contains more than the standard).<br>
	An older, free draft, <a href="http://www.open-std.org/jtc1/sc22/wg21/docs/papers/2011/n3242.pdf">version (n3242)</a></li>
	<li>The <strong>original</strong> version of this <a href="http://www.codeproject.com/KB/threads/ArticleVersion.aspx" ?aid="43510&amp;av=311159&quot;">article</a>. <code>Warning</code>: highly platform dependent</li>
	<li><a href="http://en.wikipedia.org/wiki/FIFO">Wikipedia on FIFO queues</a></li>
	<li><a href="http://www.stdthread.co.uk/doc/headers/atomic/atomic_flag.html">std::atomic_flag class</a></li>
	<li>Explained: <a href="http://preshing.com/20120930/weak-vs-strong-memory-models">Weak vs Strong Memory Models</a> (Preshing on programming)</li>
	<li>Example of <a href="http://preshing.com/20121019/this-is-why-they-call-it-a-weakly-ordered-cpu">weakly-ordered hardware memory model</a> (Preshing on programming)</li>
</ol>


						</div>
						

						<div class="float-right" style="margin:20px 0 0 10px;border:1px solid #ccc">
						<div class="msg-300x250" data-format="300x250" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="General-Programming/Threads-Processes-IPC/Multi-threading" data-loadonview="true" data-tags="VS2008, C++, Windows, Dev, Linux, Intermediate, Threading, C++11,rating4.5"><noscript><a href="http://ad.doubleclick.net/N6839/jump/lqm.codeproject.site/General-Programming/Threads-Processes-IPC/Multi-threading;sz=300x250;ord=635750249543508504?"><img src="http://ad.doubleclick.net/N6839/ad/lqm.codeproject.site/General-Programming/Threads-Processes-IPC/Multi-threading;sz=300x250;ord=635750249543508504?"  width="300px" height="250px" /></a></noscript></div>
						</div>
                        
                        
						
						<h2>License</h2>
						<div id="LicenseTerms"><p>This article, along with any associated source code and files, is licensed under <a href="http://creativecommons.org/licenses/publicdomain/" rel="license">A Public Domain dedication</a></p></div>
						

                        
						<h2>Share</h2>
				        <div class="share-list">
					        



<!-- Buttons start here. Copy this ul to your document. -->
<ul class="rrssb-buttons clearfix rrssb-1">
    <li data-size="34" data-initwidth="16.666666666666668" style="width: calc(50% - 84px);" class="email">

        <a href="mailto:?subject=Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject&amp;body=Here%27s%20an%20interesting%20article%20on%20for%20you%20on%20codeproject.com%0a%0ahttp%3a%2f%2fwww.codeproject.com%2fArticles%2f43510%2fLock-Free-Single-Producer-Single-Consumer-Circular%0a">
            <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve"><g>
                        <path d="M20.111 26.147c-2.336 1.051-4.361 1.401-7.125 1.401c-6.462 0-12.146-4.633-12.146-12.265 
                            c0-7.94 5.762-14.833 14.561-14.833c6.853 0 11.8 4.7 11.8 11.252c0 5.684-3.194 9.265-7.399 
                            9.3 c-1.829 0-3.153-0.934-3.347-2.997h-0.077c-1.208 1.986-2.96 2.997-5.023 2.997c-2.532 
                            0-4.361-1.868-4.361-5.062 c0-4.749 3.504-9.071 9.111-9.071c1.713 0 3.7 0.4 4.6 0.973l-1.169 
                            7.203c-0.388 2.298-0.116 3.3 1 3.4 c1.673 0 3.773-2.102 3.773-6.58c0-5.061-3.27-8.994-9.303-8.994c-5.957 
                            0-11.175 4.673-11.175 12.1 c0 6.5 4.2 10.2 10 10.201c1.986 0 4.089-0.43 5.646-1.245L20.111 
                            26.147z M16.646 10.1 c-0.311-0.078-0.701-0.155-1.207-0.155c-2.571 0-4.595 2.53-4.595 5.529c0 
                            1.5 0.7 2.4 1.9 2.4 c1.441 0 2.959-1.828 3.311-4.087L16.646 10.068z"></path></g>
                </svg>
            </span>
            <span class="text">email</span>
        </a>
    </li>
    <li data-size="45" data-initwidth="16.666666666666668" style="width: calc(50% - 84px);" class="twitter">
        <!-- Replace href with your Meta and URL information  -->
        <a href="http://twitter.com/home?status=Lock-Free+Single-Producer+-+Single+Consumer+Circular+Queue+-+CodeProject+-+http%3a%2f%2fwww.codeproject.com%2fArticles%2f43510%2fLock-Free-Single-Producer-Single-Consumer-Circular" class="popup">
            <span class="icon">
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                <path d="M24.253,8.756C24.689,17.08,18.297,24.182,9.97,24.62c-3.122,0.162-6.219-0.646-8.861-2.32
                    c2.703,0.179,5.376-0.648,7.508-2.321c-2.072-0.247-3.818-1.661-4.489-3.638c0.801,0.128,1.62,0.076,2.399-0.155
                    C4.045,15.72,2.215,13.6,2.115,11.077c0.688,0.275,1.426,0.407,2.168,0.386c-2.135-1.65-2.729-4.621-1.394-6.965
                    C5.575,7.816,9.54,9.84,13.803,10.071c-0.842-2.739,0.694-5.64,3.434-6.482c2.018-0.623,4.212,0.044,5.546,1.683
                    c1.186-0.213,2.318-0.662,3.329-1.317c-0.385,1.256-1.247,2.312-2.399,2.942c1.048-0.106,2.069-0.394,3.019-0.851
                    C26.275,7.229,25.39,8.196,24.253,8.756z"></path>
                </svg>
            </span>
            <span class="text">twitter</span>
        </a>
    </li>

    <li data-size="56" data-initwidth="16.666666666666668" style="width: 42px;" class="facebook small">
        <!-- Replace with your URL. For best results, make sure you page has the proper FB Open Graph tags in header: 
        https://developers.facebook.com/docs/opengraph/howtos/maximizing-distribution-media-content/ -->
        <a href="https://www.facebook.com/sharer/sharer.php?u=http%3a%2f%2fwww.codeproject.com%2fArticles%2f43510%2fLock-Free-Single-Producer-Single-Consumer-Circular" class="popup">
            <span class="icon">
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <path d="M27.825,4.783c0-2.427-2.182-4.608-4.608-4.608H4.783c-2.422,0-4.608,2.182-4.608,4.608v18.434
                        c0,2.427,2.181,4.608,4.608,4.608H14V17.379h-3.379v-4.608H14v-1.795c0-3.089,2.335-5.885,5.192-5.885h3.718v4.608h-3.726
                        c-0.408,0-0.884,0.492-0.884,1.236v1.836h4.609v4.608h-4.609v10.446h4.916c2.422,0,4.608-2.188,4.608-4.608V4.783z"></path>
                </svg>
            </span>
            <span class="text">facebook</span>
        </a>
    </li>
    
    <li data-size="51" data-initwidth="16.666666666666668" style="width: 42px;" class="linkedin small">
        <!-- Replace href with your meta and URL information -->
        <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2fwww.codeproject.com%2fArticles%2f43510%2fLock-Free-Single-Producer-Single-Consumer-Circular&amp;title=Lock-Free+Single-Producer+-+Single+Consumer+Circular+Queue+-+CodeProject&amp;summary=&amp;source=codeproject.com" class="popup">
            <span class="icon">
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <path d="M25.424,15.887v8.447h-4.896v-7.882c0-1.979-0.709-3.331-2.48-3.331c-1.354,0-2.158,0.911-2.514,1.803
                        c-0.129,0.315-0.162,0.753-0.162,1.194v8.216h-4.899c0,0,0.066-13.349,0-14.731h4.899v2.088c-0.01,0.016-0.023,0.032-0.033,0.048
                        h0.033V11.69c0.65-1.002,1.812-2.435,4.414-2.435C23.008,9.254,25.424,11.361,25.424,15.887z M5.348,2.501
                        c-1.676,0-2.772,1.092-2.772,2.539c0,1.421,1.066,2.538,2.717,2.546h0.032c1.709,0,2.771-1.132,2.771-2.546
                        C8.054,3.593,7.019,2.501,5.343,2.501H5.348z M2.867,24.334h4.897V9.603H2.867V24.334z"></path>
                </svg>
            </span>
            <span class="text">linkedin</span>
        </a>
    </li>
    <li data-size="38" data-initwidth="16.666666666666668" style="width: 42px;" class="reddit small">
        <a href="http://www.reddit.com/submit?url=http%3a%2f%2fwww.codeproject.com%2fArticles%2f43510%2fLock-Free-Single-Producer-Single-Consumer-Circular&amp;title=Lock-Free+Single-Producer+-+Single+Consumer+Circular+Queue+-+CodeProject">
            <span class="icon">
                <svg xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" version="1.1" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve"><g>
                <path d="M11.794 15.316c0-1.029-0.835-1.895-1.866-1.895c-1.03 0-1.893 0.865-1.893 1.895s0.863 1.9 1.9 1.9 C10.958 17.2 11.8 16.3 11.8 15.316z"></path>
                <path d="M18.1 13.422c-1.029 0-1.895 0.864-1.895 1.895c0 1 0.9 1.9 1.9 1.865c1.031 0 1.869-0.836 1.869-1.865 C19.969 14.3 19.1 13.4 18.1 13.422z"></path>
                <path d="M17.527 19.791c-0.678 0.678-1.826 1.006-3.514 1.006c-0.004 0-0.009 0-0.014 0c-0.004 0-0.01 0-0.015 0 
                c-1.686 0-2.834-0.328-3.51-1.005c-0.264-0.265-0.693-0.265-0.958 0c-0.264 0.265-0.264 0.7 0 1 c0.943 0.9 2.4 1.4 
                4.5 1.402c0.005 0 0 0 0 0c0.005 0 0 0 0 0c2.066 0 3.527-0.459 4.47-1.402 c0.265-0.264 0.265-0.693 0.002-0.958C18.221 
                19.5 17.8 19.5 17.5 19.791z"></path><path d="M27.707 13.267c0-1.785-1.453-3.237-3.236-3.237c-0.793 0-1.518 0.287-2.082 
                0.761c-2.039-1.295-4.646-2.069-7.438-2.219 l1.483-4.691l4.062 0.956c0.071 1.4 1.3 2.6 2.7 2.555c1.488 0 2.695-1.208 
                2.695-2.695C25.881 3.2 24.7 2 23.2 2 c-1.059 0-1.979 0.616-2.42 1.508l-4.633-1.091c-0.344-0.081-0.693 0.118-0.803 
                0.455l-1.793 5.7 C10.548 8.6 7.7 9.4 5.6 10.75C5.006 10.3 4.3 10 3.5 10.029c-1.785 0-3.237 1.452-3.237 3.2 c0 1.1 0.6 
                2.1 1.4 2.69c-0.04 0.272-0.061 0.551-0.061 0.831c0 2.3 1.3 4.4 3.7 5.9 c2.299 1.5 5.3 2.3 8.6 2.325c3.228 0 6.271-0.825 
                8.571-2.325c2.387-1.56 3.7-3.66 3.7-5.917 c0-0.26-0.016-0.514-0.051-0.768C27.088 15.5 27.7 14.4 27.7 13.267z M23.186 
                3.355c0.74 0 1.3 0.6 1.3 1.3 c0 0.738-0.6 1.34-1.34 1.34s-1.342-0.602-1.342-1.34C21.844 4 22.4 3.4 23.2 3.355z M1.648 
                13.3 c0-1.038 0.844-1.882 1.882-1.882c0.31 0 0.6 0.1 0.9 0.209c-1.049 0.868-1.813 1.861-2.26 2.9 C1.832 14.2 1.6 13.8 1.6 
                13.267z M21.773 21.57c-2.082 1.357-4.863 2.105-7.831 2.105c-2.967 0-5.747-0.748-7.828-2.105 
                c-1.991-1.301-3.088-3-3.088-4.782c0-1.784 1.097-3.484 3.088-4.784c2.081-1.358 4.861-2.106 7.828-2.106 c2.967 0 5.7 
                0.7 7.8 2.106c1.99 1.3 3.1 3 3.1 4.784C24.859 18.6 23.8 20.3 21.8 21.57z M25.787 14.6 
                c-0.432-1.084-1.191-2.095-2.244-2.977c0.273-0.156 0.59-0.245 0.928-0.245c1.035 0 1.9 0.8 1.9 1.9 
                C26.354 13.8 26.1 14.3 25.8 14.605z"></path></g></svg>
            </span>
            <span class="text">reddit</span>
        </a>
    </li>
    <li data-size="52" data-initwidth="16.666666666666668" style="width: 42px;" class="googleplus small">
        <!-- Replace href with your meta and URL information.  -->
        <a href="https://plus.google.com/share?url=http%3a%2f%2fwww.codeproject.com%2fArticles%2f43510%2fLock-Free-Single-Producer-Single-Consumer-Circular" class="popup">
            <span class="icon">
                <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="28px" viewBox="0 0 28 28" enable-background="new 0 0 28 28" xml:space="preserve">
                    <g>
                        <g>
                            <path d="M14.703,15.854l-1.219-0.948c-0.372-0.308-0.88-0.715-0.88-1.459c0-0.748,0.508-1.223,0.95-1.663
                                c1.42-1.119,2.839-2.309,2.839-4.817c0-2.58-1.621-3.937-2.399-4.581h2.097l2.202-1.383h-6.67c-1.83,0-4.467,0.433-6.398,2.027
                                C3.768,4.287,3.059,6.018,3.059,7.576c0,2.634,2.022,5.328,5.604,5.328c0.339,0,0.71-0.033,1.083-0.068
                                c-0.167,0.408-0.336,0.748-0.336,1.324c0,1.04,0.551,1.685,1.011,2.297c-1.524,0.104-4.37,0.273-6.467,1.562
                                c-1.998,1.188-2.605,2.916-2.605,4.137c0,2.512,2.358,4.84,7.289,4.84c5.822,0,8.904-3.223,8.904-6.41
                                c0.008-2.327-1.359-3.489-2.829-4.731H14.703z M10.269,11.951c-2.912,0-4.231-3.765-4.231-6.037c0-0.884,0.168-1.797,0.744-2.511
                                c0.543-0.679,1.489-1.12,2.372-1.12c2.807,0,4.256,3.798,4.256,6.242c0,0.612-0.067,1.694-0.845,2.478
                                c-0.537,0.55-1.438,0.948-2.295,0.951V11.951z M10.302,25.609c-3.621,0-5.957-1.732-5.957-4.142c0-2.408,2.165-3.223,2.911-3.492
                                c1.421-0.479,3.25-0.545,3.555-0.545c0.338,0,0.52,0,0.766,0.034c2.574,1.838,3.706,2.757,3.706,4.479
                                c-0.002,2.073-1.736,3.665-4.982,3.649L10.302,25.609z"></path>
                            <polygon points="23.254,11.89 23.254,8.521 21.569,8.521 21.569,11.89 18.202,11.89 18.202,13.604 21.569,13.604 21.569,17.004
                                23.254,17.004 23.254,13.604 26.653,13.604 26.653,11.89      "></polygon>
                        </g>
                    </g>
                </svg>
            </span>
            <span class="text">google+</span>
        </a>
    </li>
    
</ul>
<!-- Buttons end here -->

				        </div> 
    			        


						
						<h2 id="ctl00_AboutHeading">About the Author</h2>
						    


<div class="author-wrapper">

    <div class="pic-wrapper"> 
        <img id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberPhoto" class="profile-pic" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/148298ce-7230-48e9-b59a-dd227f75d173.JPG" style="border-width:0px;transform:rotate(-4deg);">

    </div>

    <div class="container-member">  
        <b><a id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberProfileLink" class="author" href="http://www.codeproject.com/Members/KjellKod_cc">KjellKod.cc</a></b>

        <table class="extended">
        <tbody><tr>
            <td rowspan="2" nowrap="nowrap" valign="middle">
            
            </td>
            <td width="100%">
                <div class="company">
                    <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberJobTitle">Software Developer (Senior)</span>
	                <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberCompany">LogRhythm</span>
                </div>
            </td>
        </tr>
        <tr>
            <td>
                <span id="ctl00_AboutAuthorRptr_ctl00_AboutAuthor_memberLocation">United States <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/US.gif" alt="United States" height="11px" width="16px"></span>
            </td>
        </tr>
        </tbody></table>
    </div>

    <div class="description">
        Enjoying Colorado! Family and intense software development.<br>
<br>
Kjell is a driven developer with a passion for software development. His
 focus is on coding, boosting software development, improving 
development efficiency and turning bad projects into good projects. <br>
<br>
Kjell was twice national champion in WUKO and semi-contact Karate and now he focuses his <i>kime</i>
 towards software engineering, everyday challenges and moose hunting 
while not being (almost constantly) amazed by his daughter and sons.

        
    </div>

</div><br>
						
						

						<div class="clearfix"></div>

						<div style="padding-top:8px">
							
						</div>

					

				    
					</form>

				</div>

				
				<div class="bottom-promo"> 
				    <div class="msg-728x90" data-format="728x90" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="General-Programming/Threads-Processes-IPC/Multi-threading" data-loadonview="true" data-tags="VS2008, C++, Windows, Dev, Linux, Intermediate, Threading, C++11,rating4.5,pos_bottom"><noscript><a href="http://ad.doubleclick.net/N6839/jump/lqm.codeproject.site/General-Programming/Threads-Processes-IPC/Multi-threading;sz=728x90;ord=635750249543508504?"><img src="http://ad.doubleclick.net/N6839/ad/lqm.codeproject.site/General-Programming/Threads-Processes-IPC/Multi-threading;sz=728x90;ord=635750249543508504?"  width="728px" height="90px" /></a></noscript></div>
				</div>
				

                
        <h2 id="ctl00_AlsoRead_RelatedResults_ctl00_Header" class="also-read">You may also be interested in...</h2>
        <table class="spaced content-list also-read">
    
	    <tbody><tr>
        <td class="content-list-item" valign="top" width="50%">
            <div class="thumbnail"><a id="ctl00_AlsoRead_RelatedResults_ctl01_Thumbnail" href="http://www.codeproject.com/Articles/1016705/Intel-Edison-Board-User-Guide"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/Thumb-1016705.jpg" alt="" style="border-width:0px;"></a></div>
            <div class="text">
                <div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl01_Link" href="http://www.codeproject.com/Articles/1016705/Intel-Edison-Board-User-Guide">Intel® Edison Board User Guide </a></div>
                
            </div>
        </td>
	
        <td class="content-list-item" valign="top" width="50%">
            <div class="thumbnail"><a id="ctl00_AlsoRead_RelatedResults_ctl02_Thumbnail" href="http://www.codeproject.com/ResearchLibrary/159/Beyond-RDBMS-A-Guide-To-NoSQL-Databases"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/LibraryItemThumbnail_159_100x130.png" alt="" style="border-width:0px;"></a></div>
            <div class="text">
                <div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl02_Link" href="http://www.codeproject.com/ResearchLibrary/159/Beyond-RDBMS-A-Guide-To-NoSQL-Databases">Beyond RDBMS: A Guide To NoSQL Databases</a></div>
                
            </div>
        </td>
	    </tr>
	
	    <tr>
        <td class="content-list-item" valign="top" width="50%">
            <div class="thumbnail"><a id="ctl00_AlsoRead_RelatedResults_ctl03_Thumbnail" href="http://www.codeproject.com/Articles/1016404/Putting-databases-under-version-control-with-Redga"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/Thumb-1016404.png" alt="" style="border-width:0px;"></a></div>
            <div class="text">
                <div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl03_Link" href="http://www.codeproject.com/Articles/1016404/Putting-databases-under-version-control-with-Redga">Putting databases under version control with Redgate's SQL Source Control</a></div>
                
            </div>
        </td>
	
        <td class="content-list-item" valign="top" width="50%">
            <div class="thumbnail"><a id="ctl00_AlsoRead_RelatedResults_ctl04_Thumbnail" href="http://www.codeproject.com/ResearchLibrary/158/Why-NoSQL"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/LibraryItemThumbnail_158_100x130.png" alt="" style="border-width:0px;"></a></div>
            <div class="text">
                <div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl04_Link" href="http://www.codeproject.com/ResearchLibrary/158/Why-NoSQL">Why NoSQL?</a></div>
                
            </div>
        </td>
	    </tr>
	
	    <tr>
        <td class="content-list-item" valign="top" width="50%">
            <div class="thumbnail"><a id="ctl00_AlsoRead_RelatedResults_ctl05_Thumbnail" href="http://www.codeproject.com/ResearchLibrary/157/Four-App-Deployment-Disasters-Every-Business-Shoul"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/LibraryItemThumbnail_157_100x130.png" alt="" style="border-width:0px;"></a></div>
            <div class="text">
                <div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl05_Link" href="http://www.codeproject.com/ResearchLibrary/157/Four-App-Deployment-Disasters-Every-Business-Shoul">Four App Deployment Disasters Every Business Should Know About</a></div>
                
            </div>
        </td>
	
        <td class="content-list-item" valign="top" width="50%">
            <div class="thumbnail"><a id="ctl00_AlsoRead_RelatedResults_ctl06_Thumbnail" href="http://www.codeproject.com/ResearchLibrary/148/Learn-to-Accelerate-Mobile-App-Development-with-IB"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/LibraryItemThumbnail_148_100x130.png" alt="" style="border-width:0px;"></a></div>
            <div class="text">
                <div class="title"><a id="ctl00_AlsoRead_RelatedResults_ctl06_Link" href="http://www.codeproject.com/ResearchLibrary/148/Learn-to-Accelerate-Mobile-App-Development-with-IB">Learn to Accelerate Mobile App Development with IBM's Cloud-Based MobileFirst Platform</a></div>
                
            </div>
        </td>
	    </tr>
	
		</tbody></table>
	



				
				

					<h2>Comments and Discussions</h2>
					<a class="float-left" name="_comments" id="_comments">&nbsp;</a><div id="_MessageBoardctl00_MessageBoard" onclick="return SwitchMessage(event, null)">
<table id="ForumTable" class="forum relaxed" cellpadding="0" cellspacing="0">
<tbody><tr>
<td><table border="0" cellpadding="3px" cellspacing="0" width="100%">
<tbody><tr class="header1">
<td colspan="2" style="white-space:nowrap;"><div class="container">
<div class="button new-message compose float-left" onclick="FireNew(this)">
<a rel="nofollow" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular" name="Frm_HoverNL" target="_top">Add a Comment or Question&nbsp;</a>
</div><div class="admin-links float-left align-middle" style="width:60px;line-height:24px;margin-top:4px;">
&nbsp;<a href="http://www.codeproject.com/KB/FAQs/MessageBoardsFAQ.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/help_sm.png" title="FAQ" alt="FAQ" style="border-width:0;width:16px;height:16px;vertical-align:middle;"></a>
</div><div class="float-right">
<form action="/Search.aspx?sbo=fm" method="get" class="searchbar">
<input name="fid" value="1551445" type="hidden"><input name="sbo" value="fm" type="hidden"><b>Search Comments </b><input class="search" name="qf" type="search">&nbsp;<input value="Go" class="button" type="submit">
</form>
</div>
</div></td>
</tr><tr class="header2">
<td></td><td style="width:100%;"><div style="text-align:right;">
<form action="/script/Forums/SetOptions.aspx?floc=%2fArticles%2f43510%2fLock-Free-Single-Producer-Single-Consumer-Circular&amp;fid=1551445&amp;df=10000&amp;mpp=50&amp;prof=False&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed" method="get" style="margin:0;padding:0;">
<input name="fid" value="1551445" type="hidden"><input name="currentQS" value="?floc=%2fArticles%2f43510%2fLock-Free-Single-Producer-Single-Consumer-Circular&amp;fid=1551445&amp;df=10000&amp;mpp=50&amp;prof=False&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed" type="hidden"><input name="floc" value="/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular" type="hidden"><input name="prof" id="prof" style="vertical-align:middle;" type="checkbox"><label for="prof">Profile popups</label>&nbsp;&nbsp;&nbsp;&nbsp;Spacing<select size="1" class="dropdown" name="spc">
<option selected="selected" value="Relaxed">Relaxed</option><option value="Compact">Compact</option><option value="Tight">Tight</option>
</select>&nbsp;&nbsp;Layout<select size="1" class="dropdown" name="view">
<option selected="selected" value="Normal">Normal</option><option value="Topic">Open Topics</option><option value="Expanded">Open All</option><option value="Thread">Thread View</option>
</select>&nbsp;&nbsp;Per page<select size="1" class="dropdown" name="mpp">
<option value="10">10</option><option value="25">25</option><option selected="selected" value="50">50</option>
</select>&nbsp;&nbsp;&nbsp;<input value="Update" name="SetOpt" class="button" type="submit">
</form>
</div></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><a name="xx0xx"></a><table border="0" cellpadding="2px" cellspacing="0" width="100%">
<tbody><tr class="navbar">
<td></td><td style="text-align:right;width:50%;"></td><td style="text-align:right;white-space:nowrap;"><span class="nav-link disabled">First</span> <span class="nav-link disabled">Prev</span><a class="nav-link" name="Frm_HoverNL" href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;prof=False&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;fr=51#xx0xx">Next</a></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><table class="fixed-layout blank-background" border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="5px" border="0" width="1px"></td>
</tr><tr id="F5096558_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx5096558xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="5096558" parent="0" thread="5096558" href="http://www.codeproject.com/Messages/5096558/My-sample-program-get-error-of-malloc.aspx">My sample program get error of malloc().</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Member 11818687</span><span class="date">23-Jul-15  1:59</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=11818687">Member 11818687</a></span></td><td class="date"><span>23-Jul-15  1:59&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5096558_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="11818687" msgid="5096558" votingtype="GoodOrBad"><a href="#xx5096558xx" onclick="RateMsg(11818687,5096558,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx5096558xx" onclick="RateMsg(11818687,5096558,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Hello sir,<br>
<br>
I made a sample program of single producer and single consumer queue 
using linked list.It is not circular.Now,I want to deallocate memory but
 I don't understand where should I do this.Can you please edit my code 
so that it works better.It also hanged some time.<br>
<br>
Thanks in advance. <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_smile.gif" alt="Smile | :)" align="top">   <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_smile.gif" alt="Smile | :)" align="top">  <div class="pre-action-link" id="premain291982" style="width:100%;display:block;"><span id="prehide291982" onclick="processCodeBlocks.togglePre(291982);">Hide</span>  &nbsp; <span id="preShrink291982" onclick="processCodeBlocks.shrinkExpand(291982);">Shrink</span> <img id="preimg291982" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(291982);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(291982);">Copy Code</span></div><pre id="pre291982" style="margin-top: 0px;" lang="c++"><span class="code-preprocessor">#include</span><span class="code-preprocessor"> <span class="code-keyword">&lt;</span><span class="code-leadattribute">cstdlib</span><span class="code-keyword">&gt;</span>
</span><span class="code-preprocessor">#include</span><span class="code-preprocessor"> <span class="code-keyword">&lt;</span><span class="code-leadattribute">atomic</span><span class="code-keyword">&gt;</span>
</span><span class="code-preprocessor">#include</span><span class="code-preprocessor"> <span class="code-keyword">&lt;</span><span class="code-leadattribute">iostream</span><span class="code-keyword">&gt;</span>
</span><span class="code-preprocessor">#include</span><span class="code-preprocessor"> <span class="code-keyword">&lt;</span><span class="code-leadattribute">stdio.h</span><span class="code-keyword">&gt;</span>
</span><span class="code-preprocessor">#include</span><span class="code-preprocessor"> <span class="code-keyword">&lt;</span><span class="code-leadattribute">string.h</span><span class="code-keyword">&gt;</span>
</span><span class="code-preprocessor">#include</span><span class="code-preprocessor"> <span class="code-keyword">&lt;</span><span class="code-leadattribute">thread</span><span class="code-keyword">&gt;</span>
</span><span class="code-preprocessor">#include</span><span class="code-preprocessor"> <span class="code-keyword">&lt;</span><span class="code-leadattribute">unistd.h</span><span class="code-keyword">&gt;</span>
</span><span class="code-keyword">using</span> <span class="code-keyword">namespace</span> std;
&nbsp;
<span class="code-comment">/*</span><span class="code-comment">
 * 
 */</span>
<span class="code-preprocessor">#pragma</span> pack(<span class="code-digit">1</span>)
&nbsp;
<span class="code-keyword">struct</span> OrderBookQ
{
    <span class="code-keyword">unsigned</span> <span class="code-keyword">char</span>* data;
    <span class="code-keyword">int</span> length;
    <span class="code-keyword">struct</span> OrderBookQ *next;
};
&nbsp;

&nbsp;
std::atomic&lt;<span class="code-keyword">struct</span> OrderBookQ *&gt; OrderBookQFront;
std::atomic&lt;<span class="code-keyword">struct</span> OrderBookQ *&gt; OrderBookQRear;
&nbsp;
<span class="code-comment">//</span><span class="code-comment">push method
</span><span class="code-keyword">void</span> WriteOrderBook(<span class="code-keyword">unsigned</span> <span class="code-keyword">char</span> *data,<span class="code-keyword">int</span> len)
{
    <span class="code-keyword">struct</span> OrderBookQ *current_tail=(<span class="code-keyword">struct</span> OrderBookQ *)malloc(<span class="code-digit">1</span>*<span class="code-keyword">sizeof</span>(<span class="code-keyword">struct</span> OrderBookQ));
    <span class="code-keyword">struct</span> OrderBookQ *next_tail;
    
    <span class="code-keyword">if</span>(OrderBookQRear == NULL)
    {
        OrderBookQRear=(<span class="code-keyword">struct</span> OrderBookQ *)malloc(<span class="code-digit">1</span>*<span class="code-keyword">sizeof</span>(<span class="code-keyword">struct</span> OrderBookQ));
        
        OrderBookQFront=(<span class="code-keyword">struct</span> OrderBookQ *)malloc(<span class="code-digit">1</span>*<span class="code-keyword">sizeof</span>(<span class="code-keyword">struct</span> OrderBookQ));
&nbsp;
        current_tail=OrderBookQRear.load(std::memory_order_relaxed);
        
        OrderBookQFront.load(std::memory_order_acquire);
        {
            current_tail-&gt;data= (<span class="code-keyword">unsigned</span> <span class="code-keyword">char</span> *)malloc(len);
            memcpy(current_tail-&gt;data,data,len);
            current_tail-&gt;length=len;
            current_tail-&gt;next=NULL;
            
            OrderBookQRear.store(current_tail);
            OrderBookQFront.store(current_tail,std::memory_order_release);
        }
       
    }
    <span class="code-keyword">else</span>
    {
        current_tail=OrderBookQRear.load(std::memory_order_relaxed);
        next_tail=current_tail-&gt;next;
        next_tail=(<span class="code-keyword">struct</span> OrderBookQ *)malloc(<span class="code-digit">1</span>*<span class="code-keyword">sizeof</span>(<span class="code-keyword">struct</span> OrderBookQ));
        OrderBookQFront.load(std::memory_order_acquire);
        {
            next_tail-&gt;data=(<span class="code-keyword">unsigned</span> <span class="code-keyword">char</span> *)malloc(len);
            memcpy(next_tail-&gt;data,data,len);
            next_tail-&gt;length=len;
            next_tail-&gt;next=NULL;
            current_tail-&gt;next=next_tail;
            OrderBookQRear.store(next_tail,std::memory_order_release);
            
        } 
      
    }    
    
}
&nbsp;
<span class="code-comment">//</span><span class="code-comment">pop method
</span><span class="code-keyword">extern</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">char</span> * ReadOrderBook(<span class="code-keyword">int</span> *len)
{
    <span class="code-keyword">struct</span> OrderBookQ *current_front=(<span class="code-keyword">struct</span> OrderBookQ *)malloc(<span class="code-digit">1</span>*<span class="code-keyword">sizeof</span>(<span class="code-keyword">struct</span> OrderBookQ));
    
    current_front=OrderBookQFront.load(std::memory_order_relaxed);
    
    OrderBookQRear.load(std::memory_order_acquire);
    
    <span class="code-keyword">if</span>(current_front == NULL)
    {
        <span class="code-keyword">unsigned</span> <span class="code-keyword">char</span> *myval=NULL;
        <span class="code-keyword">return</span> myval;
    }
    <span class="code-keyword">else</span> <span class="code-keyword">if</span>(current_front-&gt;next != NULL)
    {
        <span class="code-keyword">unsigned</span> <span class="code-keyword">char</span> *myval=current_front-&gt;data;
        *len=current_front-&gt;length;
        
        OrderBookQFront.store(current_front-&gt;next,std::memory_order_release);
        free(current_front);
        <span class="code-keyword">return</span> myval;
    }
    <span class="code-keyword">else</span>
    {
        <span class="code-keyword">unsigned</span> <span class="code-keyword">char</span> *myval=current_front-&gt;data;
        *len=current_front-&gt;length;
        free(current_front);
        OrderBookQFront.store(NULL);
        OrderBookQRear.store(NULL,std::memory_order_release);
        <span class="code-keyword">return</span> myval;
    }
    
    
}
&nbsp;
<span class="code-keyword">void</span> displayOrderBookQ()
{
    <span class="code-keyword">struct</span> OrderBookQ *temp;
    temp = OrderBookQFront;
    <span class="code-keyword">int</span> i = <span class="code-digit">1</span>;
    <span class="code-keyword">while</span>(temp != NULL)
    {
<span class="code-comment">//</span><span class="code-comment">        for(i = 0; i &lt; temp-&gt;length ; i++)
</span><span class="code-comment">//</span><span class="code-comment">        {
</span><span class="code-comment">//</span><span class="code-comment">            printf("%02x,", temp-&gt;data[i]);
</span><span class="code-comment">//</span><span class="code-comment">        }
</span>         printf(<span class="code-string">"</span><span class="code-string">\n%d. Element From Front [%x - %x]"</span>,i++, temp-&gt;data[<span class="code-digit">125</span>], temp-&gt;data[<span class="code-digit">126</span>]);
        
        
        temp = temp-&gt;next;
        
    }
}
&nbsp;

<span class="code-keyword">void</span> threadfunction_push()
{
    <span class="code-keyword">unsigned</span> <span class="code-keyword">char</span> item=<span class="code-string">'</span><span class="code-string">0'</span>;
    <span class="code-keyword">int</span> i=0;
    <span class="code-keyword">unsigned</span> <span class="code-keyword">char</span> data[<span class="code-digit">128</span>];
    
    <span class="code-keyword">for</span>(i=0;i&lt;<span class="code-digit">5000</span>;i++)
    {
        memset(data,item,<span class="code-digit">127</span>);
         data[<span class="code-digit">127</span>]=<span class="code-string">'</span><span class="code-string">\0'</span>;
         WriteOrderBook(data,<span class="code-digit">128</span>);
         printf(<span class="code-string">"</span><span class="code-string">Pushed %d to the queue\n"</span>,i);
    }
}
&nbsp;
<span class="code-keyword">void</span> threadfunction_pop()
{
    <span class="code-keyword">unsigned</span> <span class="code-keyword">char</span> *val;
    <span class="code-keyword">int</span> len=128,i;
    
    <span class="code-keyword">for</span>(i=0;i&lt;<span class="code-digit">5000</span>;i++)
    {
      
        
        <span class="code-keyword">while</span>((val=ReadOrderBook(&amp;len))==NULL){
             std::this_thread::yield();
        }
        printf(<span class="code-string">"</span><span class="code-string">Popped %d from queue\n"</span>,i);
    }
    
}
&nbsp;

<span class="code-keyword">int</span> main(<span class="code-keyword">int</span> argc, <span class="code-keyword">char</span>** argv) {
           
    std::<span class="code-keyword">thread</span> thread_push(threadfunction_push);
    std::<span class="code-keyword">thread</span> thread_pop(threadfunction_pop);
    displayOrderBookQ();
    thread_push.join();
    thread_pop.join();
    printf(<span class="code-string">"</span><span class="code-string">both threads exited successfully\n"</span>);    
&nbsp;
    <span class="code-keyword">return</span> <span class="code-digit">0</span>;
} 
</pre><br><br><div class="modified">modified  23-Jul-15 3:40am.</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5096558&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5096558&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=5096558" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/5096558/My-sample-program-get-error-of-malloc.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=5096558&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=5096558&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF5096558" data-ref="3_5096558" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="11818687" msgid="5096558"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F5096789_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx5096789xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_answer.gif" alt="Answer" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="5096789" parent="5096558" thread="5096558" href="http://www.codeproject.com/Messages/5096789/Re-My-sample-program-get-error-of-malloc.aspx">Re: My sample program get error of malloc().</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">23-Jul-15  7:54</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>23-Jul-15  7:54&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5096789_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="5096789" votingtype="GoodOrBad"><a href="#xx5096789xx" onclick="RateMsg(4385931,5096789,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx5096789xx" onclick="RateMsg(4385931,5096789,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,5096558);" href="http://www.codeproject.com/Messages/5096558/My-sample-program-get-error-of-malloc.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Hi<br>
<br>
I'm sorry but I cannot assist you directly with this code that is unrelated to this article.<br>
<br>
There are other forums where you can post coding questions.<br>
<br>
If you have other questions that are regarding my article and the code described within I will gladly help you out.<br>
<br>
If you need to study this topic more and are seeking answers I can 
highly recommend Anthony Williams book "Concurrency in Action"<br>
<br>
Good luck<br>
Kjell<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5096789&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5096789&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=5096558" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/5096789/Re-My-sample-program-get-error-of-malloc.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=5096789&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=5096789&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF5096789" data-ref="3_5096789" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="5096789"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F5096809_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="56px"><a name="xx5096809xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="5096809" parent="5096789" thread="5096558" href="http://www.codeproject.com/Messages/5096809/Re-My-sample-program-get-error-of-malloc.aspx">Re: My sample program get error of malloc().</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Member 11818687</span><span class="date">23-Jul-15  8:30</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=11818687">Member 11818687</a></span></td><td class="date"><span>23-Jul-15  8:30&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5096809_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"><div done="true" class="voteform vertical" ownerid="11818687" msgid="5096809" votingtype="GoodOrBad"><a href="#xx5096809xx" onclick="RateMsg(11818687,5096809,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx5096809xx" onclick="RateMsg(11818687,5096809,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="56px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,5096789);" href="http://www.codeproject.com/Messages/5096789/Re-My-sample-program-get-error-of-malloc.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Ok sir...Thankss.. <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_smile.gif" alt="Smile | :)" align="top">   <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_smile.gif" alt="Smile | :)" align="top"> <br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5096809&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5096809&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=5096558" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/5096809/Re-My-sample-program-get-error-of-malloc.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=5096809&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=5096809&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF5096809" data-ref="3_5096809" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="11818687" msgid="5096809"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F5090710_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx5090710xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="5090710" parent="0" thread="5090710" href="http://www.codeproject.com/Messages/5090710/My-sample-program-not-works-proper.aspx">My sample program not works proper.</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Member 11818687</span><span class="date">13-Jul-15  5:52</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=11818687">Member 11818687</a></span></td><td class="date"><span>13-Jul-15  5:52&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5090710_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="11818687" msgid="5090710" votingtype="GoodOrBad"><a href="#xx5090710xx" onclick="RateMsg(11818687,5090710,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx5090710xx" onclick="RateMsg(11818687,5090710,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">I tried to create a lock free atomic circular queue but it is not working properly.<br>
<br>
I created 2 threads. One is for pushing into queue and another one is for popping from the queue. But;<br>
<br>
Problem: -<br>
<br>
When push thread running then pop thread does not get chance to run. Pop
 thread runs after push thread runs completely and vice versa.<br>
<br>
ex: <br>
<br>
size of queue: 100<br>
<br>
If i am pushing 1000 numbers then first push thread runs for 100 times then pop thread <br>
runs for 100 times. But I want that my both thread runs parallel like  
push(1),pop(1),push(2),push(3),pop(2),... that. If I put 100 microsecond
 delay then it gives me perfect result. <br>
<br>
I do not know much about C++. So, please can you edit my code so that it works?<br>
<br>
I am using GCC 4.8.1<br>
<br>
Thanks in advance.<br>
<br>
Code:<br>
  <br>
<div class="pre-action-link" id="premain922764" style="width:100%;display:block;"><span id="prehide922764" onclick="processCodeBlocks.togglePre(922764);">Hide</span>  &nbsp; <span id="preShrink922764" onclick="processCodeBlocks.shrinkExpand(922764);">Shrink</span> <img id="preimg922764" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(922764);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(922764);">Copy Code</span></div><pre id="pre922764" style="margin-top: 0px;" lang="cs">#include &lt;cstdlib&gt;
#include &lt;iostream&gt;
#include &lt;atomic&gt;
#include &lt;cstddef&gt;
#include &lt;thread&gt;
#include &lt;stdio.h&gt;
#include &lt;unistd.h&gt;
&nbsp;
<span class="code-preprocessor">#define</span> capacity <span class="code-digit">1000</span>
&nbsp;

&nbsp;
std::atomic&lt;<span class="code-keyword">int</span>&gt; _head;
std::atomic&lt;<span class="code-keyword">int</span>&gt; _tail;
&nbsp;
<span class="code-keyword">int</span> array[capacity];
&nbsp;
<span class="code-keyword">int</span> increment(<span class="code-keyword">int</span> size)
{
    <span class="code-keyword">return</span> (size+1)%capacity;
}
&nbsp;
<span class="code-keyword">bool</span> push(<span class="code-keyword">int</span> *item)
{
    printf(<span class="code-string">"</span><span class="code-string">Inside push\n"</span>);
    <span class="code-keyword">const</span> <span class="code-keyword">int</span> current_tail= _tail.load(std::memory_order_relaxed);
    <span class="code-keyword">const</span> <span class="code-keyword">int</span> next_tail=increment(current_tail);
&nbsp;
    <span class="code-keyword">if</span>(next_tail != _head.load(std::memory_order_acquire))
    {
         array[current_tail]=*item;
         _tail.store(next_tail,std::memory_order_release);
&nbsp;
         <span class="code-keyword">return</span> <span class="code-keyword">true</span>;
    }
&nbsp;
         <span class="code-keyword">return</span> <span class="code-keyword">false</span>; <span class="code-comment">//</span><span class="code-comment">Queue is Full
</span>}
&nbsp;
<span class="code-keyword">bool</span> pop(<span class="code-keyword">int</span> *item)
{
      printf(<span class="code-string">"</span><span class="code-string">Inside pop\n"</span>);
      <span class="code-keyword">const</span> <span class="code-keyword">int</span> current_head=_head.load(std::memory_order_relaxed);
&nbsp;
      <span class="code-keyword">if</span>(current_head==_tail.load(std::memory_order_acquire))
      {
          <span class="code-keyword">return</span> <span class="code-keyword">false</span>;<span class="code-comment">//</span><span class="code-comment">empty queue
</span>      }
&nbsp;
      *item=array[current_head];
      _head.store(increment(current_head),std::memory_order_release);
&nbsp;
      <span class="code-keyword">return</span> <span class="code-keyword">true</span>;
}
&nbsp;
<span class="code-keyword">bool</span> isEmpty()
{
    <span class="code-keyword">return</span>(_head.load()==_tail.load());
}
&nbsp;
<span class="code-keyword">bool</span> isFull()
{
    <span class="code-keyword">const</span> <span class="code-keyword">int</span> next_tail=increment(_tail);
&nbsp;
    <span class="code-keyword">return</span> (next_tail==_head.load());
}
&nbsp;
<span class="code-keyword">bool</span> isLockfree()
{
    <span class="code-keyword">return</span> (_tail.is_lock_free() &amp;&amp; _head.is_lock_free());
}
&nbsp;
<span class="code-keyword">void</span> *threadfunction_push()
{
    <span class="code-keyword">int</span> item,i;
    <span class="code-keyword">bool</span> flag;
    item=0;
&nbsp;
    <span class="code-keyword">for</span>(i=0;i&lt;<span class="code-digit">10000</span>;i++)
    {
        <span class="code-keyword">while</span>(isFull())
        std::this_thread::<span class="code-keyword">yield</span>();
&nbsp;
        ++item;
        push(&amp;item);
        printf(<span class="code-string">"</span><span class="code-string">pushed %d into queue\n"</span>,item);
        <span class="code-comment">//</span><span class="code-comment">usleep(100);
</span>
     }
&nbsp;
}
&nbsp;
<span class="code-keyword">void</span> *threadfunction_pop()
{
    <span class="code-keyword">int</span> item,i;
&nbsp;
    item=0;
    <span class="code-keyword">for</span>(i=0;i&lt;<span class="code-digit">10000</span>;i++)
    {
       <span class="code-keyword">while</span>(isEmpty())
             std::this_thread::<span class="code-keyword">yield</span>();
&nbsp;
       pop(&amp;item);
       printf(<span class="code-string">"</span><span class="code-string">popped %d from queue\n"</span>,item);
&nbsp;

    }
&nbsp;
     i=isLockfree();
     <span class="code-keyword">if</span>(i)
        printf(<span class="code-string">"</span><span class="code-string">Queue is lock Free"</span>);
}
&nbsp;

<span class="code-keyword">int</span> main(<span class="code-keyword">int</span> argc, char** argv)
{
&nbsp;

    std::thread thread_push(threadfunction_push);
    std::thread thread_pop(threadfunction_pop);
&nbsp;
    thread_push.join();
    thread_pop.join();
&nbsp;
     <span class="code-keyword">return</span> <span class="code-digit">0</span>;
}</pre><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5090710&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5090710&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=5090710" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/5090710/My-sample-program-not-works-proper.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=5090710&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=5090710&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF5090710" data-ref="3_5090710" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="11818687" msgid="5090710"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F5090764_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx5090764xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_answer.gif" alt="Answer" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="5090764" parent="5090710" thread="5090710" href="http://www.codeproject.com/Messages/5090764/Re-My-sample-program-not-works-proper.aspx">Re: My sample program not works proper.</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">13-Jul-15  7:40</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>13-Jul-15  7:40&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5090764_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="5090764" votingtype="GoodOrBad"><a href="#xx5090764xx" onclick="RateMsg(4385931,5090764,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx5090764xx" onclick="RateMsg(4385931,5090764,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,5090710);" href="http://www.codeproject.com/Messages/5090710/My-sample-program-not-works-proper.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Hi, <br>
<br>
You had a few warnings so I cleaned up the code a bit.  You can see it here:<br>
<a href="http://coliru.stacked-crooked.com/a/b48c58f9ee9856aa">http://coliru.stacked-crooked.com/a/b48c58f9ee9856aa</a><br>
<br>
<br>
In Coliru it takes too long time the execution of this snippet so the 
process is killed. On my ubuntu box I have no such restrictions <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_wink.gif" alt="Wink | ;)" align="top">  so the execution was fine. <br>
<br>
Please <b>note</b> however that this is <b>not</b> a high performing queue! It was mostly written to understand and explain how a simple lock-free queue could work. <br>
<br>
<i>1) Do you really need it to be lock-free? (I have some suggestions of
 faster queues then). Remember that lock-free doesn't necessarily mean 
**faster**, only that it is lock /mutex free.</i><br><br><div class="modified">modified  13-Jul-15 8:46am.</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5090764&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5090764&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=5090710" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/5090764/Re-My-sample-program-not-works-proper.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=5090764&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=5090764&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF5090764" data-ref="3_5090764" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="5090764"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F5090793_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="56px"><a name="xx5090793xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="5090793" parent="5090764" thread="5090710" href="http://www.codeproject.com/Messages/5090793/Re-My-sample-program-not-works-proper.aspx">Re: My sample program not works proper.</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Member 11818687</span><span class="date">13-Jul-15  8:11</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=11818687">Member 11818687</a></span></td><td class="date"><span>13-Jul-15  8:11&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5090793_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"><div done="true" class="voteform vertical" ownerid="11818687" msgid="5090793" votingtype="GoodOrBad"><a href="#xx5090793xx" onclick="RateMsg(11818687,5090793,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx5090793xx" onclick="RateMsg(11818687,5090793,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="56px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,5090764);" href="http://www.codeproject.com/Messages/5090764/Re-My-sample-program-not-works-proper.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>It
 is not working in my compiler.It is 1000 number first and then popping 
1000 numbers(Size of queue is 1000 thats why).Why in coliru it runs 
perfect?<br>
<br>
I am using "Red Hat Enterprise Linux Server release 6.5 (Santiago)" and GCC 4.8.1.<br><br><div class="modified">modified  13-Jul-15 9:33am.</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5090793&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5090793&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=5090710" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/5090793/Re-My-sample-program-not-works-proper.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=5090793&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=5090793&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF5090793" data-ref="3_5090793" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="11818687" msgid="5090793"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F5090836_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="74px"><a name="xx5090836xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="5090836" parent="5090793" thread="5090710" href="http://www.codeproject.com/Messages/5090836/Re-My-sample-program-not-works-proper.aspx">Re: My sample program not works proper.</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">13-Jul-15  9:01</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>13-Jul-15  9:01&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5090836_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:74px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="5090836" votingtype="GoodOrBad"><a href="#xx5090836xx" onclick="RateMsg(4385931,5090836,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx5090836xx" onclick="RateMsg(4385931,5090836,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="74px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,5090793);" href="http://www.codeproject.com/Messages/5090793/Re-My-sample-program-not-works-proper.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Please don't completely rewrite your comments. It's better to add a new comment. Or add to your comment.<br>
<br>
You asked first<br>
&gt;&gt; ya,I need faster queue.All your suggestion welcome.<br>
Thanks...<br>
<br>
The queues I have tested are MoodyCamel's mpmc and  Dmitry Vuykov<br>
<br>
If you check out the "MoodyCamel's" queue blog posts and bench tests 
notations you can find example of many other lock free queues.<br>
<br>
Instead of pasting all the links I give you the blog post where I tested them<br>
<a href="https://kjellkod.wordpress.com/2015/06/30/the-worlds-fastest-logger-vs-g3log/">https://kjellkod.wordpress.com/2015/06/30/the-worlds-fastest-logger-vs-g3log/</a>[<a href="https://kjellkod.wordpress.com/2015/06/30/the-worlds-fastest-logger-vs-g3log/" target="_blank" title="New Window">^</a>]<br>
<br>
2) I don't know why the queue doesn't work for you. Did you use the same
 compile arguments as coliru? Please test again with the corrected code I
 gave and with exactly the same compilation options<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5090836&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5090836&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=5090710" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/5090836/Re-My-sample-program-not-works-proper.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=5090836&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=5090836&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF5090836" data-ref="3_5090836" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="5090836"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F5090854_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="92px"><a name="xx5090854xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="5090854" parent="5090836" thread="5090710" href="http://www.codeproject.com/Messages/5090854/Re-My-sample-program-not-works-proper.aspx">Re: My sample program not works proper.</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Member 11818687</span><span class="date">13-Jul-15  9:17</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=11818687">Member 11818687</a></span></td><td class="date"><span>13-Jul-15  9:17&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5090854_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:92px;"><div done="true" class="voteform vertical" ownerid="11818687" msgid="5090854" votingtype="GoodOrBad"><a href="#xx5090854xx" onclick="RateMsg(11818687,5090854,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx5090854xx" onclick="RateMsg(11818687,5090854,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="92px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,5090836);" href="http://www.codeproject.com/Messages/5090836/Re-My-sample-program-not-works-proper.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Ya, I forgot to put -02 option(Full Atomic) in the command. Now it works fine. Thnaks so much.. <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_smile.gif" alt="Smile | :)" align="top">   <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_smile.gif" alt="Smile | :)" align="top"> <br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5090854&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5090854&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=5090710" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/5090854/Re-My-sample-program-not-works-proper.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=5090854&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=5090854&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF5090854" data-ref="3_5090854" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="11818687" msgid="5090854"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F5091519_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="92px"><a name="xx5091519xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="5091519" parent="5090836" thread="5090710" href="http://www.codeproject.com/Messages/5091519/Re-My-sample-program-not-works-proper.aspx">Re: My sample program not works proper.</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Member 11818687</span><span class="date">14-Jul-15  7:59</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=11818687">Member 11818687</a></span></td><td class="date"><span>14-Jul-15  7:59&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5091519_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:92px;"><div done="true" class="voteform vertical" ownerid="11818687" msgid="5091519" votingtype="GoodOrBad"><a href="#xx5091519xx" onclick="RateMsg(11818687,5091519,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx5091519xx" onclick="RateMsg(11818687,5091519,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="92px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,5090836);" href="http://www.codeproject.com/Messages/5090836/Re-My-sample-program-not-works-proper.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>I forgot to add "-02" option while compiling. Now it<b> works fine</b>.Thanksss <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_smile.gif" alt="Smile | :)" align="top">   <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_smile.gif" alt="Smile | :)" align="top"> <br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5091519&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5091519&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=5090710" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/5091519/Re-My-sample-program-not-works-proper.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=5091519&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=5091519&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF5091519" data-ref="3_5091519" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="11818687" msgid="5091519"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F5026422_h0" class="header hover-row root">
<td class="subject-line normal  vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx5026422xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="5026422" parent="0" thread="5026422" href="http://www.codeproject.com/Messages/5026422/wasEmpty-is-not-a-good-name.aspx">wasEmpty is not a good name.</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Member 1659281</span><span class="date">23-Mar-15  11:33</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=1659281">Member 1659281</a></span></td><td class="date"><span>23-Mar-15  11:33&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5026422_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="1659281" msgid="5026422" votingtype="GoodOrBad"><a href="#xx5026422xx" onclick="RateMsg(1659281,5026422,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx5026422xx" onclick="RateMsg(1659281,5026422,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">The wasEmpty function returns different things when called by different threads.<br>
<br>
If called by the consumer thread then the return value means 'wasEmpty', more specifically:<br>
true means "is or was recently empty" and false means "is not empty".<br>
<br>
If called by the producer thread then the return value means 'notWasNonEmpty', or:<br>
true means "is empty" and false means "is or was recently non-empty".<br>
<br>
HOWEVER, if this function is called by a third thread, not the producer or consumer, then<br>
the returned value has no meaning. Not even (as I think it should for this function<br>
to have any usefulness for other threads) true meaning "is or was recently empty" and<br>
false meaning "is or was recently non-empty". The problem namely is that even if<br>
the queue is entirely full it could return true (empty!) if first the value of m_head<br>
is read and then the value of m_tail, and both are incremented in between those reads.<br>
<br>
Even explicitly first reading m_tail and then m_head will not solve this problem<br>
unless all loads and stores on both are done with sequential consistency - which you<br>
are not doing.<br>
<br>
Hence, you should either explicitly warn the users to only call this function<br>
from the producer or consumer threads, or remove it. A comparable story can be<br>
held for the wasFull() function.<br>
<div class="signature">Carlo Wood</div><br><br><div class="modified">modified  24-Mar-15 13:49pm.</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5026422&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5026422&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=5026422" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/5026422/wasEmpty-is-not-a-good-name.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=5026422&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=5026422&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF5026422" data-ref="3_5026422" class="rating-label" style="white-space:nowrap;"><span>5.00/5 (1 vote)</span><span class="reportform" ownerid="1659281" msgid="5026422"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F5026478_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx5026478xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_answer.gif" alt="Answer" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="5026478" parent="5026422" thread="5026422" href="http://www.codeproject.com/Messages/5026478/Re-wasEmpty-is-not-a-good-name.aspx">Re: wasEmpty is not a good name.</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">23-Mar-15  13:03</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>23-Mar-15  13:03&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F5026478_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="5026478" votingtype="GoodOrBad"><a href="#xx5026478xx" onclick="RateMsg(4385931,5026478,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx5026478xx" onclick="RateMsg(4385931,5026478,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,5026422);" href="http://www.codeproject.com/Messages/5026422/wasEmpty-is-not-a-good-name.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Good observation!<br>
<br>
As you probably already know, It is stated explicitly, several times in the article, that this is a "two threads queue" only.<br>
<br>
One producer thread and one consumer thread.<br>
<br>
The "wasEmpty" has likely no practical use except for unit testing.,, 
but even so: using it from a third thread is outside the scope of this 
code (and article)<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5026478&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=5026478&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=5026422" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/5026478/Re-wasEmpty-is-not-a-good-name.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=5026478&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=5026478&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF5026478" data-ref="3_5026478" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="5026478"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4970288_h0" class="header hover-row root">
<td class="subject-line normal  vote-hi" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4970288xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4970288" parent="0" thread="4970288" href="http://www.codeproject.com/Messages/4970288/doubt-the-case-of-queue-corrupted.aspx">doubt the case of queue corrupted.</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">PengUBC</span><span class="date">29-Dec-14  0:17</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=10965142">PengUBC</a></span></td><td class="date"><span>29-Dec-14  0:17&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4970288_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="10965142" msgid="4970288" votingtype="GoodOrBad"><a href="#xx4970288xx" onclick="RateMsg(10965142,4970288,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4970288xx" onclick="RateMsg(10965142,4970288,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">In the section of `Sequential Consistent Atmic Code`, there is paragraph started with <br>
"<i>If the step 3. or 4. would be rearranged the queue would be corrupted. </i>".<br>
I cannot convince myself why the queue will be corrupted if step3 and step4 was reversed. Assuming no other code change made. <br>
<br>
Since there is always <b>`one open slot`</b> in the circular queue, even when step4 goes before step3, the user of this queue will never get corrupted data.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4970288&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4970288&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4970288" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4970288/doubt-the-case-of-queue-corrupted.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4970288&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4970288&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4970288" data-ref="3_4970288" class="rating-label" style="white-space:nowrap;"><span>5.00/5 (1 vote)</span><span class="reportform" ownerid="10965142" msgid="4970288"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4970621_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx4970621xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_answer.gif" alt="Answer" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4970621" parent="4970288" thread="4970288" href="http://www.codeproject.com/Messages/4970621/Re-doubt-the-case-of-queue-corrupted.aspx">Re: doubt the case of queue corrupted.</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">29-Dec-14  14:45</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>29-Dec-14  14:45&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4970621_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4970621" votingtype="GoodOrBad"><a href="#xx4970621xx" onclick="RateMsg(4385931,4970621,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4970621xx" onclick="RateMsg(4385931,4970621,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4970288);" href="http://www.codeproject.com/Messages/4970288/doubt-the-case-of-queue-corrupted.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>You are not guaranteed to that it will always be one open slot in the circular queue? Where did you get that from?<br>
<br>
<div class="pre-action-link" id="premain889648" style="width:100%;display:block;"><span id="prehide889648" onclick="processCodeBlocks.togglePre(889648);">Hide</span>  &nbsp; <span id="preShrink889648" onclick="processCodeBlocks.shrinkExpand(889648);">Shrink</span> <img id="preimg889648" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(889648);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(889648);">Copy Code</span></div><pre id="pre889648" style="margin-top: 0px;" lang="c++"><span class="code-comment">//</span><span class="code-comment"> queue empty when: 
</span>current_head == _tail
&nbsp;
<span class="code-comment">//</span><span class="code-comment"> queue full when: 
</span>next_tail == _head
</pre>
<br>
In a scenario where the queue is full and the "tail" pushing thread is 
waiting for a slot to push data to. If the step 3-4 are reordered then 
the following could happen <br>
<br>
<div class="pre-action-link" id="premain96916" style="width:100%;display:block;"><span id="prehide96916" onclick="processCodeBlocks.togglePre(96916);">Hide</span>  &nbsp; <span id="preShrink96916" onclick="processCodeBlocks.shrinkExpand(96916);">Shrink</span> <img id="preimg96916" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(96916);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(96916);">Copy Code</span></div><pre id="pre96916" style="margin-top: 0px;" lang="c++"><span class="code-comment">/*</span><span class="code-comment"> Here the RETRIEVAL of the data is done AFTER the head is updated.
 
   This causes a RACE with tail that can push data onto the location and data
   we hoped to retrieve was overwritten with the latest from tail.
*/</span>
<span class="code-keyword">bool</span> pop(Element&amp; item)
{
  <span class="code-keyword">const</span> <span class="code-keyword">auto</span> current_head = _head.load();  <span class="code-comment">//</span><span class="code-comment"> 1. loads sequentially the head
</span>  <span class="code-keyword">if</span>(current_head == _tail.load())                <span class="code-comment">//</span><span class="code-comment"> 2. compares head to snapshot of tail
</span>    <span class="code-keyword">return</span> <span class="code-keyword">false</span>;   <span class="code-comment">//</span><span class="code-comment"> empty queue
</span>
  <span class="code-comment">//</span><span class="code-comment"> At this point next_tail == head: i.e. (tail+1 == head)  i.e. the queue is full. 
</span>  <span class="code-comment">//</span><span class="code-comment"> The producer is waiting to push onto the queue
</span>
  _head.store(increment(current_head));    <span class="code-comment">//</span><span class="code-comment"> 4. update the head index to new position
</span>   <span class="code-comment">//</span><span class="code-comment"> oops:  3-4 were switched out. 
</span>   <span class="code-comment">//</span><span class="code-comment"> the head is updated to the new position i.e. now next_tail != head i.e. 
</span>   <span class="code-comment">//</span><span class="code-comment"> the queue is no longer full.  
</span>   <span class="code-comment">//</span><span class="code-comment"> The producer thread is now pushing an item into this location pointed to by "current_head"
</span>
  item = _array[current_head];             <span class="code-comment">//</span><span class="code-comment"> 3. retrievs the item pointed to by head
</span>  <span class="code-comment">//</span><span class="code-comment"> the item is retrieved but the queues integrity is corrupted since 3-4 switched place. 
</span>  <span class="code-comment">//</span><span class="code-comment"> The item was overwritten before the consumer had a chance of reading it, instead the consumer
</span>  <span class="code-comment">//</span><span class="code-comment"> will read the latest from the tail.  
</span>  <span class="code-keyword">return</span> <span class="code-keyword">true</span>;
}
</pre><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4970621&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4970621&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4970288" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4970621/Re-doubt-the-case-of-queue-corrupted.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4970621&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4970621&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4970621" data-ref="3_4970621" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4970621"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4970695_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="56px"><a name="xx4970695xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4970695" parent="4970621" thread="4970288" href="http://www.codeproject.com/Messages/4970695/Re-doubt-the-case-of-queue-corrupted.aspx">Re: doubt the case of queue corrupted.</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">PengUBC</span><span class="date">29-Dec-14  17:48</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=10965142">PengUBC</a></span></td><td class="date"><span>29-Dec-14  17:48&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4970695_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"><div done="true" class="voteform vertical" ownerid="10965142" msgid="4970695" votingtype="GoodOrBad"><a href="#xx4970695xx" onclick="RateMsg(10965142,4970695,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4970695xx" onclick="RateMsg(10965142,4970695,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="56px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4970621);" href="http://www.codeproject.com/Messages/4970621/Re-doubt-the-case-of-queue-corrupted.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Thank you very much for your timely reply.  <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_smile.gif" alt="Smile | :)" align="top">   I still bear the doubt though. <br>
 <br>
Issue #1: Why I say the queue <b>always `has one open slot`</b>. Assume we have <div class="pre-action-link" id="premain339660" style="width:100%;display:block;"><span id="prehide339660" onclick="processCodeBlocks.togglePre(339660);">Hide</span>  &nbsp; <span id="preShrink339660" onclick="processCodeBlocks.shrinkExpand(339660);">Shrink</span> <img id="preimg339660" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(339660);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(339660);">Copy Code</span></div><pre id="pre339660" style="margin-top: 0px;" lang="c++">CircularFifo&lt;<span class="code-keyword">int</span>,<span class="code-digit">4</span>&gt; lfq</pre>
lfq has an array of 4+1, which is equal to lfq.Capacity. Since 
`next_tail == _head.load()` indicates lfq is full, lfq can accommodate 
at most 4 items. 5-4=1, that's why I claim CircularFifo always has one 
open slot. <br>
<br>
Issue #2: When <b>other code stays the same</b>, even the step3 and 
step4 are reversed, the consumer also consumes the items in the order of
 the producer produces. As long as this FIFO invariant is preserved, I 
claim the queue is not corrupted. I do not know which criterion you use 
for `corruption` though. <br>
<br>
Asssume that the updating head(step4) is executed before retrieving the 
item(step3). When the queue is not full, nothing will go wrong. So the 
only case we need to consider is the queue being full and producer tries
 to push and consumer tries to pop `<i>at the same time</i>`. <br>
<br>
After the consumer executes step4, the producer starts `<b>push()</b>`. 
Like you said in your comment, to the consumer's view, the queue is not 
full since the consumer has already updated the read. So the producer 
will push an item at location current_tail. <b>This `<i>current_tail</i>` is always <big>at least</big> one slot before the `<i>current_head</i>`(step3)</b>.
 So when step3 is executed, the item used to be at `current_head` is 
still there. FIFO invariant is not invalidated so both producer and 
consumer are happy. <br>
<br>
In conclusion, the item consumer is supposed to retrieve at step3 will 
not be overwritten, because there is always one open slot.<br>
<br>
Thank you very much. Looking forward to your reply.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4970695&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4970695&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4970288" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4970695/Re-doubt-the-case-of-queue-corrupted.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4970695&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4970695&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4970695" data-ref="3_4970695" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="10965142" msgid="4970695"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4970744_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="74px"><a name="xx4970744xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4970744" parent="4970695" thread="4970288" href="http://www.codeproject.com/Messages/4970744/Re-doubt-the-case-of-queue-corrupted.aspx">Re: doubt the case of queue corrupted</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">29-Dec-14  22:23</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>29-Dec-14  22:23&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4970744_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:74px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4970744" votingtype="GoodOrBad"><a href="#xx4970744xx" onclick="RateMsg(4385931,4970744,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4970744xx" onclick="RateMsg(4385931,4970744,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="74px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4970695);" href="http://www.codeproject.com/Messages/4970695/Re-doubt-the-case-of-queue-corrupted.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Good catch <a href="http://www.codeproject.com/Members/pengubc">@PengUBC</a>. You are absolutely right. <br>
<br>
Since the tail is at most is one slot-behind, and the written value will
 be saved on the  "current_tail" instead of the "incremented tail" then:
  <b>Yes. Step 3-4 can be reordered. They do not have to happen in this order thanks to the one-slot buffering</b>. <br>
<br>
This is of course also true for the <code>memory-aquire-release</code> queue and not only the <code>memory-sequential</code> queue. <br>
<br>
<br>
I totally missed that when I wrote the article.  The error is on the 
benign side! The integrity of the code is the same as if the steps 3-4 
would be reordered. <br>
<br>
<br>
In practice I can't say if this would make any significant performance 
difference but I will make sure to correct the text in the article. <br>
<br>
Thanks for the correction <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_smile.gif" alt="Smile | :)" align="top"> <br>
<br>
Cheers<br>
Kjell<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4970744&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4970744&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4970288" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4970744/Re-doubt-the-case-of-queue-corrupted.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4970744&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4970744&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4970744" data-ref="3_4970744" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4970744"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4632183_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4632183xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4632183" parent="0" thread="4632183" href="http://www.codeproject.com/Messages/4632183/My-vote-of.aspx">My vote of 4</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Mic</span><span class="date">8-Aug-13  18:34</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4778206">Mic</a></span></td><td class="date"><span>8-Aug-13  18:34&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4632183_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="4778206" msgid="4632183" votingtype="GoodOrBad"><a href="#xx4632183xx" onclick="RateMsg(4778206,4632183,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4632183xx" onclick="RateMsg(4778206,4632183,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Very Good<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4632183&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4632183&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4632183" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4632183/My-vote-of.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4632183&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4632183&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4632183" data-ref="3_4632183" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4778206" msgid="4632183"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4624856_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4624856xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4624856" parent="0" thread="4624856" href="http://www.codeproject.com/Messages/4624856/Possible-typo.aspx">Possible typo?</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">bsamim</span><span class="date">30-Jul-13  18:32</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=5174332">bsamim</a></span></td><td class="date"><span>30-Jul-13  18:32&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4624856_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="5174332" msgid="4624856" votingtype="GoodOrBad"><a href="#xx4624856xx" onclick="RateMsg(5174332,4624856,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4624856xx" onclick="RateMsg(5174332,4624856,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="pre-action-link" id="premain501636" style="width:100%;display:block;"><span id="prehide501636" onclick="processCodeBlocks.togglePre(501636);">Hide</span>  &nbsp; <span id="preShrink501636" onclick="processCodeBlocks.shrinkExpand(501636);">Shrink</span> <img id="preimg501636" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(501636);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(501636);">Copy Code</span></div><pre id="pre501636" style="margin-top: 0px;" lang="cs"><span class="code-comment">//</span><span class="code-comment"> thread_1
</span>x.store(<span class="code-digit">123</span>, std::memory_order_releaxed); <span class="code-comment">//</span><span class="code-comment"> relaxed X happens-before Y store</span></pre>
<br>
<br>
relaxed is misspelled.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4624856&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4624856&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4624856" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4624856/Possible-typo.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4624856&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4624856&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4624856" data-ref="3_4624856" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="5174332" msgid="4624856"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4624860_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx4624860xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_answer.gif" alt="Answer" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4624860" parent="4624856" thread="4624856" href="http://www.codeproject.com/Messages/4624860/Re-Possible-typo.aspx">Re: Possible typo?</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">30-Jul-13  18:44</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>30-Jul-13  18:44&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4624860_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4624860" votingtype="GoodOrBad"><a href="#xx4624860xx" onclick="RateMsg(4385931,4624860,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4624860xx" onclick="RateMsg(4385931,4624860,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4624856);" href="http://www.codeproject.com/Messages/4624856/Possible-typo.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Absolutely correct of course. <br>
<br>
Thanks. I will update the article.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4624860&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4624860&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4624856" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4624860/Re-Possible-typo.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4624860&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4624860&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4624860" data-ref="3_4624860" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4624860"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4835689_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="56px"><a name="xx4835689xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4835689" parent="4624860" thread="4624856" href="http://www.codeproject.com/Messages/4835689/Re-Possible-typo.aspx">Re: Possible typo?</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">4-Jun-14  21:56</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>4-Jun-14  21:56&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4835689_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4835689" votingtype="GoodOrBad"><a href="#xx4835689xx" onclick="RateMsg(4385931,4835689,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4835689xx" onclick="RateMsg(4385931,4835689,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="56px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4624860);" href="http://www.codeproject.com/Messages/4624860/Re-Possible-typo.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>CodeProject's interface for editing the articles is <b>still</b> very buggy. Just opening the article for editing removes all the pictures. <br>
<br>
If I need to update this article I will make this change as well. Otherwise I will leave it be (sigh)<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4835689&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4835689&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4624856" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4835689/Re-Possible-typo.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4835689&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4835689&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4835689" data-ref="3_4835689" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4835689"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4970750_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="74px"><a name="xx4970750xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4970750" parent="4835689" thread="4624856" href="http://www.codeproject.com/Messages/4970750/Re-Possible-typo.aspx">Re: Possible typo?</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">29-Dec-14  22:40</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>29-Dec-14  22:40&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4970750_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:74px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4970750" votingtype="GoodOrBad"><a href="#xx4970750xx" onclick="RateMsg(4385931,4970750,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4970750xx" onclick="RateMsg(4385931,4970750,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="74px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4835689);" href="http://www.codeproject.com/Messages/4835689/Re-Possible-typo.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Typos corrected.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4970750&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4970750&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4624856" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4970750/Re-Possible-typo.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4970750&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4970750&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4970750" data-ref="3_4970750" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4970750"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4581283_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4581283xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4581283" parent="0" thread="4581283" href="http://www.codeproject.com/Messages/4581283/My-vote-of.aspx">My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">golinvauxb</span><span class="date">6-Jun-13  5:05</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=2136995">golinvauxb</a></span></td><td class="date"><span>6-Jun-13  5:05&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4581283_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="2136995" msgid="4581283" votingtype="GoodOrBad"><a href="#xx4581283xx" onclick="RateMsg(2136995,4581283,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4581283xx" onclick="RateMsg(2136995,4581283,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">VERY clear, VERY nicely explained and most of all VERY useful for real-time systems. Kudos!!!!<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4581283&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4581283&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4581283" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4581283/My-vote-of.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4581283&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4581283&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4581283" data-ref="3_4581283" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="2136995" msgid="4581283"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4583713_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx4583713xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4583713" parent="4581283" thread="4581283" href="http://www.codeproject.com/Messages/4583713/Re-My-vote-of.aspx">Re: My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">9-Jun-13  16:54</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>9-Jun-13  16:54&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4583713_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4583713" votingtype="GoodOrBad"><a href="#xx4583713xx" onclick="RateMsg(4385931,4583713,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4583713xx" onclick="RateMsg(4385931,4583713,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4581283);" href="http://www.codeproject.com/Messages/4581283/My-vote-of.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Thank you <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_smile.gif" alt="Smile | :)" align="top"> <br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4583713&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4583713&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4581283" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4583713/Re-My-vote-of.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4583713&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4583713&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4583713" data-ref="3_4583713" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4583713"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4562312_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4562312xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4562312" parent="0" thread="4562312" href="http://www.codeproject.com/Messages/4562312/My-vote-of.aspx">My vote of 4</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">shiva_19</span><span class="date">11-May-13  10:30</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=6797171">shiva_19</a></span></td><td class="date"><span>11-May-13  10:30&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4562312_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="6797171" msgid="4562312" votingtype="GoodOrBad"><a href="#xx4562312xx" onclick="RateMsg(6797171,4562312,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4562312xx" onclick="RateMsg(6797171,4562312,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Nice explanation.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4562312&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4562312&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4562312" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4562312/My-vote-of.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4562312&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4562312&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4562312" data-ref="3_4562312" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="6797171" msgid="4562312"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4443484_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4443484xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4443484" parent="0" thread="4443484" href="http://www.codeproject.com/Messages/4443484/My-vote-of.aspx">My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Member 9655454</span><span class="date">4-Dec-12  8:18</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=9655454">Member 9655454</a></span></td><td class="date"><span>4-Dec-12  8:18&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4443484_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="9655454" msgid="4443484" votingtype="GoodOrBad"><a href="#xx4443484xx" onclick="RateMsg(9655454,4443484,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4443484xx" onclick="RateMsg(9655454,4443484,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">this article is excellent because i found solutions for more questions on thread.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4443484&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4443484&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4443484" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4443484/My-vote-of.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4443484&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4443484&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4443484" data-ref="3_4443484" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="9655454" msgid="4443484"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4443617_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx4443617xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4443617" parent="4443484" thread="4443484" href="http://www.codeproject.com/Messages/4443617/Re-My-vote-of.aspx">Re: My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">4-Dec-12  9:33</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>4-Dec-12  9:33&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4443617_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4443617" votingtype="GoodOrBad"><a href="#xx4443617xx" onclick="RateMsg(4385931,4443617,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4443617xx" onclick="RateMsg(4385931,4443617,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4443484);" href="http://www.codeproject.com/Messages/4443484/My-vote-of.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Thank you. I am glad it + forum was helpful<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4443617&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4443617&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4443484" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4443617/Re-My-vote-of.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4443617&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4443617&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4443617" data-ref="3_4443617" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4443617"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4439912_h0" class="header hover-row root">
<td class="subject-line normal  vote-lo" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4439912xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4439912" parent="0" thread="4439912" href="http://www.codeproject.com/Messages/4439912/Multiple-producers-consumers.aspx">Multiple producers/consumers</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Jorge L Orejel</span><span class="date">29-Nov-12  13:09</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=9619541">Jorge L Orejel</a></span></td><td class="date"><span>29-Nov-12  13:09&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4439912_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="9619541" msgid="4439912" votingtype="GoodOrBad"><a href="#xx4439912xx" onclick="RateMsg(9619541,4439912,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4439912xx" onclick="RateMsg(9619541,4439912,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">There is a simple way to handle multiple producers and 
consumers using "lock" at the right places in the code.  Thanks, Jorge 
Orejel.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4439912&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4439912&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4439912" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4439912/Multiple-producers-consumers.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4439912&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4439912&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4439912" data-ref="3_4439912" class="rating-label" style="white-space:nowrap;"><span>1.00/5 (1 vote)</span><span class="reportform" ownerid="9619541" msgid="4439912"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4439950_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx4439950xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_answer.gif" alt="Answer" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4439950" parent="4439912" thread="4439912" href="http://www.codeproject.com/Messages/4439950/Re-Multiple-producers-consumers.aspx">Re: Multiple producers/consumers</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">29-Nov-12  13:51</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>29-Nov-12  13:51&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4439950_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4439950" votingtype="GoodOrBad"><a href="#xx4439950xx" onclick="RateMsg(4385931,4439950,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4439950xx" onclick="RateMsg(4385931,4439950,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4439912);" href="http://www.codeproject.com/Messages/4439912/Multiple-producers-consumers.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Definitely! I would even go so far as to say that for most coders a lock-free structure is probably never of interest. For <b>most </b>code
 a sensible use of locks will do the trick and the bottlenecks will 
likely be elsewhere,... for most code, but not for all code.<br>
<br>
For lock-based approach with multiple clients I like Anthony Williams 
approach in his book "C++ Concurrency In Action". I use it for the 
internal message queue in an asynchronous, "crash safe" logger <a href="https://bitbucket.org/KjellKod/"><big>g2log</big></a>[<a href="https://bitbucket.org/KjellKod/" target="_blank" title="New Window">^</a>]. A decent approach where the locks are hidden internally in the structure to avoid common problems involved with <i>external locking</i>. Here is a <a href="https://bitbucket.org/KjellKod/g2log/src/2666912a1d894382627155db8701ec111c1f6e19/g2log/src/shared_queue.h?at=default"><big>sample</big></a>[<a href="https://bitbucket.org/KjellKod/g2log/src/2666912a1d894382627155db8701ec111c1f6e19/g2log/src/shared_queue.h?at=default" target="_blank" title="New Window">^</a>]<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4439950&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4439950&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4439912" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4439950/Re-Multiple-producers-consumers.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4439950&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4439950&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4439950" data-ref="3_4439950" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4439950"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4556056_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx4556056xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_answer.gif" alt="Answer" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4556056" parent="4439912" thread="4439912" href="http://www.codeproject.com/Messages/4556056/Re-Multiple-producers-consumers.aspx">Re: Multiple producers/consumers</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">AlexDive</span><span class="date">3-May-13  5:44</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4048482">AlexDive</a></span></td><td class="date"><span>3-May-13  5:44&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4556056_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4048482" msgid="4556056" votingtype="GoodOrBad"><a href="#xx4556056xx" onclick="RateMsg(4048482,4556056,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4556056xx" onclick="RateMsg(4048482,4556056,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4439912);" href="http://www.codeproject.com/Messages/4439912/Multiple-producers-consumers.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Is
 it possible to get such code anywhere? Even multiple producer/single 
consumer would be already awesome. scenario: library logging. Thanks so 
much for sharing, cheers<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4556056&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4556056&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4439912" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4556056/Re-Multiple-producers-consumers.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4556056&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4556056&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4556056" data-ref="3_4556056" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4048482" msgid="4556056"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4556060_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="56px"><a name="xx4556060xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4556060" parent="4556056" thread="4439912" href="http://www.codeproject.com/Messages/4556060/Re-Multiple-producers-consumers.aspx">Re: Multiple producers/consumers</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">AlexDive</span><span class="date">3-May-13  5:48</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4048482">AlexDive</a></span></td><td class="date"><span>3-May-13  5:48&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4556060_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"><div done="true" class="voteform vertical" ownerid="4048482" msgid="4556060" votingtype="GoodOrBad"><a href="#xx4556060xx" onclick="RateMsg(4048482,4556060,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4556060xx" onclick="RateMsg(4048482,4556060,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="56px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4556056);" href="http://www.codeproject.com/Messages/4556056/Re-Multiple-producers-consumers.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Also,
 I wonder if in order to allow overwriting for very slow consumers that 
do not keep up with the producers rate will be safe to just avoid 
branching i.e. memory_relaxed_aquire_release.hpp:52 and incrementing 
also the head as one location has been overwritten. thanks!<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4556060&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4556060&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4439912" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4556060/Re-Multiple-producers-consumers.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4556060&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4556060&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4556060" data-ref="3_4556060" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4048482" msgid="4556060"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4556594_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="56px"><a name="xx4556594xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4556594" parent="4556056" thread="4439912" href="http://www.codeproject.com/Messages/4556594/Re-Multiple-producers-consumers.aspx">Re: Multiple producers/consumers</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">3-May-13  17:57</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>3-May-13  17:57&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4556594_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4556594" votingtype="GoodOrBad"><a href="#xx4556594xx" onclick="RateMsg(4385931,4556594,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4556594xx" onclick="RateMsg(4385931,4556594,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="56px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4556056);" href="http://www.codeproject.com/Messages/4556056/Re-Multiple-producers-consumers.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>I
 am a little confused by your comment as it was made in reply my comment
 where I pointed out exactly where you can find such code.<br>
<br>
Yes. Multiple producers sending log entries to a log consumer is very 
easy to implement if the message queue is protected by mutex. I used 
exactly that (see earlier answer) in my asynchronous, "crash safe" 
logger <a href="http://www.codeproject.com/Articles/288827/g2log-An-efficient-asynchronous-logger-using-Cplus">g2log</a>[<a href="http://www.codeproject.com/Articles/288827/g2log-An-efficient-asynchronous-logger-using-Cplus" target="_blank" title="New Window">^</a>].<br>
<br>
Or are you asking about lock-free multiple producer queue? Sure, that is
 possible as well. But are you sure you actually need lock-free?<br>
<br>
<b>Scenario 0:</b> Just the protected shared_queue pointed to in my earlier answer.<br>
<br>
<b>Scenario 1:</b> Multiple producers are known in advance. Each can 
then have their own lock-free "single-producer, single consumer" queue 
(a la the one in this article). The consumer can be the same thread just
 serving the producer-queues in a round robin manner<br>
<br>
<b>Scenario 2:</b> Use a dedicated multiple producer queue. There are 
several examples out there. Google for it, check here at CodeProject 
(here for <a href="http://www.codeproject.com/Articles/153898/Yet-another-implementation-of-a-lock-free-circular">instance</a>[<a href="http://www.codeproject.com/Articles/153898/Yet-another-implementation-of-a-lock-free-circular" target="_blank" title="New Window">^</a>])<br>
<br>
<b>Scenario 3:</b> Check out the "Disruptor" java pattern. There exist a
 C++ implementation as well. I am playing with the idea of making 
something similar for g2log.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4556594&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4556594&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4439912" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4556594/Re-Multiple-producers-consumers.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4556594&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4556594&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4556594" data-ref="3_4556594" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4556594"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4557861_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="74px"><a name="xx4557861xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4557861" parent="4556594" thread="4439912" href="http://www.codeproject.com/Messages/4557861/Re-Multiple-producers-consumers.aspx">Re: Multiple producers/consumers</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">AlexDive</span><span class="date">6-May-13  9:04</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4048482">AlexDive</a></span></td><td class="date"><span>6-May-13  9:04&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4557861_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:74px;"><div done="true" class="voteform vertical" ownerid="4048482" msgid="4557861" votingtype="GoodOrBad"><a href="#xx4557861xx" onclick="RateMsg(4048482,4557861,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4557861xx" onclick="RateMsg(4048482,4557861,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="74px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4556594);" href="http://www.codeproject.com/Messages/4556594/Re-Multiple-producers-consumers.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Thanks for answering, I didnt get any email notification.<br>
Yeah, I need lock free as one of the producing thread is audio 
real-time, and I can't lock a mutex on that. Looks like the 
implementation of scenario 2 is good for my needs! will check it out 
now, thank you in the meantime<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4557861&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4557861&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4439912" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4557861/Re-Multiple-producers-consumers.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4557861&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4557861&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4557861" data-ref="3_4557861" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4048482" msgid="4557861"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4439442_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4439442xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4439442" parent="0" thread="4439442" href="http://www.codeproject.com/Messages/4439442/possible-typo.aspx">possible typo</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">w-peuker</span><span class="date">29-Nov-12  6:41</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=9309181">w-peuker</a></span></td><td class="date"><span>29-Nov-12  6:41&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4439442_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="9309181" msgid="4439442" votingtype="GoodOrBad"><a href="#xx4439442xx" onclick="RateMsg(9309181,4439442,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4439442xx" onclick="RateMsg(9309181,4439442,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">It seems to me that there is a closing bracket missing (2 times in this article):<br>
<div class="pre-action-link" id="premain247365" style="width:100%;display:block;"><span id="prehide247365" onclick="processCodeBlocks.togglePre(247365);">Hide</span>  &nbsp; <span id="preShrink247365" onclick="processCodeBlocks.shrinkExpand(247365);">Shrink</span> <img id="preimg247365" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(247365);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(247365);">Copy Code</span></div><pre id="pre247365" style="margin-top: 0px;" lang="c++"><span class="code-keyword">while</span>(!y.load(std::memory_order_aquire);</pre><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4439442&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4439442&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4439442" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4439442/possible-typo.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4439442&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4439442&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4439442" data-ref="3_4439442" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="9309181" msgid="4439442"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4439577_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx4439577xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_answer.gif" alt="Answer" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4439577" parent="4439442" thread="4439442" href="http://www.codeproject.com/Messages/4439577/Re-possible-typo.aspx">Re: possible typo</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">29-Nov-12  8:45</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>29-Nov-12  8:45&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4439577_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4439577" votingtype="GoodOrBad"><a href="#xx4439577xx" onclick="RateMsg(4385931,4439577,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4439577xx" onclick="RateMsg(4385931,4439577,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4439442);" href="http://www.codeproject.com/Messages/4439442/possible-typo.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Thank you. I will fix that when I do the correction<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4439577&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4439577&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4439442" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4439577/Re-possible-typo.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4439577&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4439577&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4439577" data-ref="3_4439577" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4439577"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4438503_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4438503xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4438503" parent="0" thread="4438503" href="http://www.codeproject.com/Messages/4438503/Rewrite-finally-done-a-few-typos-detected.aspx">Rewrite finally done .... a few typos detected.</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">28-Nov-12  6:17</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>28-Nov-12  6:17&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4438503_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4438503" votingtype="GoodOrBad"><a href="#xx4438503xx" onclick="RateMsg(4385931,4438503,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4438503xx" onclick="RateMsg(4385931,4438503,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><strike>A few typos detected,. I will wait a few days and then correct it. <br>
<br>
* First "push()" function <code>!=</code> turned to <code>==</code> in the article text. The source code is correct<br>
* the the<br>
* another another<br>
* aquire --&gt; acquire  (3am writing gives me <i>creative</i> spelling)<br>
* some broken links in the beginning</strike><br>
<br>
Fixed!<br><br><div class="modified">modified  2-Dec-12 11:52am.</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4438503&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4438503&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4438503" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4438503/Rewrite-finally-done-a-few-typos-detected.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4438503&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4438503&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4438503" data-ref="3_4438503" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4438503"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4437293_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4437293xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4437293" parent="0" thread="4437293" href="http://www.codeproject.com/Messages/4437293/My-vote-of.aspx">My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">yunhua_lee</span><span class="date">27-Nov-12  3:01</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=9541053">yunhua_lee</a></span></td><td class="date"><span>27-Nov-12  3:01&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4437293_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="9541053" msgid="4437293" votingtype="GoodOrBad"><a href="#xx4437293xx" onclick="RateMsg(9541053,4437293,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4437293xx" onclick="RateMsg(9541053,4437293,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">very specific<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4437293&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4437293&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4437293" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4437293/My-vote-of.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4437293&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4437293&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4437293" data-ref="3_4437293" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="9541053" msgid="4437293"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4437457_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx4437457xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4437457" parent="4437293" thread="4437293" href="http://www.codeproject.com/Messages/4437457/Re-My-vote-of.aspx">Re: My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">27-Nov-12  6:28</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>27-Nov-12  6:28&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4437457_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4437457" votingtype="GoodOrBad"><a href="#xx4437457xx" onclick="RateMsg(4385931,4437457,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4437457xx" onclick="RateMsg(4385931,4437457,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4437293);" href="http://www.codeproject.com/Messages/4437293/My-vote-of.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Thank
 you. Do come back in a couple of days. A complete re-write of the 
article is pending. From platform hack to C++11 guaranteed.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4437457&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4437457&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4437293" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4437457/Re-My-vote-of.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4437457&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4437457&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4437457" data-ref="3_4437457" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4437457"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4436101_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4436101xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4436101" parent="0" thread="4436101" href="http://www.codeproject.com/Messages/4436101/How-to-adapt-this-to-use-shared-memory.aspx">How to adapt this to use shared memory?</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Member 9629871</span><span class="date">25-Nov-12  21:17</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=9629871">Member 9629871</a></span></td><td class="date"><span>25-Nov-12  21:17&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4436101_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="9629871" msgid="4436101" votingtype="GoodOrBad"><a href="#xx4436101xx" onclick="RateMsg(9629871,4436101,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4436101xx" onclick="RateMsg(9629871,4436101,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Hi,<br>
<br>
Thanks for the very nice article.  I believe the circular queue will 
only work between Windows threads.  But I would like to use this to pass
 data between two Windows processes and use shared memory.  Is this 
possible?  Do you have any suggestions on how to accomplish this?<br>
<br>
Thank you!<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4436101&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4436101&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4436101" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4436101/How-to-adapt-this-to-use-shared-memory.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4436101&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4436101&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4436101" data-ref="3_4436101" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="9629871" msgid="4436101"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4436228_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx4436228xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_answer.gif" alt="Answer" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4436228" parent="4436101" thread="4436101" href="http://www.codeproject.com/Messages/4436228/Re-How-to-adapt-this-to-use-shared-memory.aspx">Re: How to adapt this to use shared memory?</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">26-Nov-12  2:54</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>26-Nov-12  2:54&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4436228_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4436228" votingtype="GoodOrBad"><a href="#xx4436228xx" onclick="RateMsg(4385931,4436228,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4436228xx" onclick="RateMsg(4385931,4436228,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4436101);" href="http://www.codeproject.com/Messages/4436101/How-to-adapt-this-to-use-shared-memory.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Hi, <br>
<br>
You are more then right. I tested this originally on x64 and x86 both 
for Windows (VS) and Linux (gcc). Last week I ran tests for this Queue 
and I can now easily break it on Linux (x86+x64).<br>
<br>
I am putting up a huge disclaimer on this article shortly and I will 
instead point out how to do this in a guaranteed way both on Linux and 
Windows.<br>
<br>
The easy solution however is to just throw out old <strike>volatile </strike> code and use the C++11 default sequential atomics instead. Then it is almost no code changes apart from the <strike><code>volatile</code></strike><code> </code>to <code>atomic </code>. It is of course really is an <b>enormous difference</b> behind the scene.<br>
<br>
<br>
<div class="pre-action-link" id="premain352449" style="width:100%;display:block;"><span id="prehide352449" onclick="processCodeBlocks.togglePre(352449);">Hide</span>  &nbsp; <span id="preShrink352449" onclick="processCodeBlocks.shrinkExpand(352449);">Shrink</span> <img id="preimg352449" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(352449);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(352449);">Copy Code</span></div><pre id="pre352449" style="margin-top: 0px;" lang="c++"><span class="code-comment">//</span><span class="code-comment"> Here with memory_order_seq_cst for every operation. 
</span><span class="code-comment">//</span><span class="code-comment"> This is overkill but easy to reason about
</span><span class="code-keyword">namespace</span> memory_sequential_consistent {
<span class="code-keyword">template</span>&lt;<span class="code-keyword">typename</span> Element, <span class="code-sdkkeyword">size_t</span> Size&gt; 
<span class="code-keyword">class</span> CircularFifo{
<span class="code-keyword">public</span>:
  <span class="code-keyword">enum</span> { Capacity = Size+1 };
&nbsp;
  CircularFifo() : _tail(<span class="code-digit">0</span>), _head(<span class="code-digit">0</span>){}   
  <span class="code-keyword">virtual</span> ~CircularFifo() {}
&nbsp;
  <span class="code-keyword">bool</span> push(<span class="code-keyword">const</span> Element&amp; item); <span class="code-comment">//</span><span class="code-comment"> pushByMOve?
</span>  <span class="code-keyword">bool</span> pop(Element&amp; item);
&nbsp;
  <span class="code-keyword">bool</span> wasEmpty() <span class="code-keyword">const</span>;
  <span class="code-keyword">bool</span> wasFull() <span class="code-keyword">const</span>;
  <span class="code-keyword">bool</span> isLockFree() <span class="code-keyword">const</span>;
&nbsp;
<span class="code-keyword">private</span>:
  <span class="code-sdkkeyword">size_t</span> increment(<span class="code-sdkkeyword">size_t</span> idx) <span class="code-keyword">const</span>; 
&nbsp;
  std::atomic &lt;<span class="code-sdkkeyword">size_t</span>&gt;  _tail;  <span class="code-comment">//</span><span class="code-comment"> tail(input) index
</span>  Element    _array[Capacity];
  std::atomic&lt;<span class="code-sdkkeyword">size_t</span>&gt;   _head; <span class="code-comment">//</span><span class="code-comment"> head(output) index
</span>};
</pre>
<br>
The implementation for the sequential consistent atomic solution above is very straight forward.<br>
<div class="pre-action-link" id="premain660105" style="width:100%;display:block;"><span id="prehide660105" onclick="processCodeBlocks.togglePre(660105);">Hide</span>  &nbsp; <span id="preShrink660105" onclick="processCodeBlocks.shrinkExpand(660105);">Shrink</span> <img id="preimg660105" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(660105);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(660105);">Copy Code</span></div><pre id="pre660105" style="margin-top: 0px;" lang="c++"><span class="code-comment">//</span><span class="code-comment"> Push by Producer can only update the tail 
</span><span class="code-keyword">template</span>&lt;<span class="code-keyword">typename</span> Element, <span class="code-sdkkeyword">size_t</span> Size&gt;
<span class="code-keyword">bool</span> CircularFifo&lt;Element, Size&gt;::push(<span class="code-keyword">const</span> Element&amp; item)
{       
  <span class="code-keyword">const</span> <span class="code-keyword">auto</span> current_tail = _tail.load(); 
  <span class="code-keyword">const</span> <span class="code-keyword">auto</span> next_tail = increment(current_tail); 
  <span class="code-keyword">if</span>(next_tail != _head.load())                         
  {
    _array[current_tail] = item;
    _tail.store(next_tail); 
    <span class="code-keyword">return</span> <span class="code-keyword">true</span>;
  }
  
  <span class="code-keyword">return</span> <span class="code-keyword">false</span>;  <span class="code-comment">//</span><span class="code-comment"> full queue
</span>}
&nbsp;

<span class="code-comment">//</span><span class="code-comment"> Pop by Consumer can only update the head 
</span><span class="code-keyword">template</span>&lt;<span class="code-keyword">typename</span> Element, <span class="code-sdkkeyword">size_t</span> Size&gt;
<span class="code-keyword">bool</span> CircularFifo&lt;Element, Size&gt;::pop(Element&amp; item)
{
  <span class="code-keyword">const</span> <span class="code-keyword">auto</span> current_head = _head.load();  
  <span class="code-keyword">if</span>(current_head == _tail.load())  
    <span class="code-keyword">return</span> <span class="code-keyword">false</span>;   <span class="code-comment">//</span><span class="code-comment"> empty queue
</span>
  item = _array[current_head]; 
  _head.store(increment(current_head)); 
  <span class="code-keyword">return</span> <span class="code-keyword">true</span>;
}
&nbsp;
<span class="code-comment">//</span><span class="code-comment"> snapshot with acceptance of that this comparison function is not atomic
</span><span class="code-comment">//</span><span class="code-comment"> (*) Used by clients or test, since pop() avoid double load overhead by not
</span><span class="code-comment">//</span><span class="code-comment"> using wasEmpty()
</span><span class="code-keyword">template</span>&lt;<span class="code-keyword">typename</span> Element, <span class="code-sdkkeyword">size_t</span> Size&gt;
<span class="code-keyword">bool</span> CircularFifo&lt;Element, Size&gt;::wasEmpty() <span class="code-keyword">const</span>
{
  <span class="code-keyword">return</span> (_head.load() == _tail.load());
}
&nbsp;
<span class="code-comment">//</span><span class="code-comment"> snapshot with acceptance that this comparison is not atomic
</span><span class="code-comment">//</span><span class="code-comment"> (*) Used by clients or test, since push() avoid double load overhead by not
</span><span class="code-comment">//</span><span class="code-comment"> using wasFull()
</span><span class="code-keyword">template</span>&lt;<span class="code-keyword">typename</span> Element, <span class="code-sdkkeyword">size_t</span> Size&gt;
<span class="code-keyword">bool</span> CircularFifo&lt;Element, Size&gt;::wasFull() <span class="code-keyword">const</span>
{
  <span class="code-keyword">const</span> <span class="code-keyword">auto</span> next_tail = increment(_tail.load());
  <span class="code-keyword">return</span> (next_tail == _head.load());
}
&nbsp;
<span class="code-comment">//</span><span class="code-comment"> in case you want to verify that it is REALLY completely lock-free 
</span><span class="code-comment">//</span><span class="code-comment"> even behind the scenes. It is platform dependent whether or not the
</span><span class="code-comment">//</span><span class="code-comment"> atomic operations are lock-free for size_t (or whatever type)
</span><span class="code-keyword">template</span>&lt;<span class="code-keyword">typename</span> Element, <span class="code-sdkkeyword">size_t</span> Size&gt;
<span class="code-keyword">bool</span> CircularFifo&lt;Element, Size&gt;::isLockFree() <span class="code-keyword">const</span>
{
  <span class="code-keyword">return</span> (_tail.is_lock_free() &amp;&amp; _head.is_lock_free());
}
&nbsp;
<span class="code-keyword">template</span>&lt;<span class="code-keyword">typename</span> Element, <span class="code-sdkkeyword">size_t</span> Size&gt;
<span class="code-sdkkeyword">size_t</span> CircularFifo&lt;Element, Size&gt;::increment(<span class="code-sdkkeyword">size_t</span> idx) <span class="code-keyword">const</span>
{
  <span class="code-keyword">return</span> (idx + <span class="code-digit">1</span>) % Capacity;
}
</pre>
<br>
<br>
<b>To Verify Broken Queue and C++11 Corrected Queue<br>
</b><br>
Last, to easily verify that in fact this article's code is just as 
dangerous as I tried to show. It can be tested on Windows (VS2012) and 
Linux (gcc). At least on Linux with gcc it now breaks as proven by a 
simple test. Below is a snapshot of a unit test that I ran that can show
 this. <br>
<br>
Some functionality is not here but you get the gist I am sure. You can 
replace whatever's missing easily for something equivalent.<br>
<br>
<div class="pre-action-link" id="premain779788" style="width:100%;display:block;"><span id="prehide779788" onclick="processCodeBlocks.togglePre(779788);">Hide</span>  &nbsp; <span id="preShrink779788" onclick="processCodeBlocks.shrinkExpand(779788);">Shrink</span> <img id="preimg779788" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(779788);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(779788);">Copy Code</span></div><pre id="pre779788" style="margin-top: 0px;" lang="c++"><span class="code-keyword">using</span> <span class="code-keyword">namespace</span> memory_sequential_consistent;
<span class="code-keyword">typedef</span> <span class="code-keyword">unsigned</span> <span class="code-keyword">int</span>  Number;
&nbsp;
<span class="code-keyword">namespace</span> {
  <span class="code-keyword">const</span> std::<span class="code-sdkkeyword">size_t</span>  k_queue_size = <span class="code-digit">1000</span>; 
  <span class="code-keyword">const</span> std::<span class="code-sdkkeyword">size_t</span>  k_amount_to_process = <span class="code-digit">10</span>*<span class="code-digit">1000</span>*<span class="code-digit">1000</span>; <span class="code-comment">//</span><span class="code-comment"> 10 million
</span>  <span class="code-keyword">const</span> Number k_lower_limit = <span class="code-digit">0</span>;
  <span class="code-keyword">const</span> Number k_upper_limit = <span class="code-digit">10000</span>;
  <span class="code-keyword">const</span> std::string queue_type_message = <span class="code-string">"</span><span class="code-string">CircularFifo_SEQUENTIAL (default sequential) "</span>;
  <span class="code-keyword">typedef</span> Number Message;
  <span class="code-keyword">typedef</span> CircularFifo&lt;Message, k_queue_size&gt; MessageQueue;
&nbsp;
} <span class="code-comment">//</span><span class="code-comment"> anonymous
</span>
&nbsp;

<span class="code-comment">//</span><span class="code-comment"> The producer functionality
</span>std::vector&lt;Message&gt; Producer(MessageQueue&amp; out_fifo, <span class="code-keyword">const</span> <span class="code-sdkkeyword">size_t</span> enough_processed)
{
  std::vector&lt;Message&gt; all_data;
  all_data.resize(enough_processed);
  replaceContentWithRandoms(all_data, k_lower_limit, k_upper_limit);
&nbsp;
  std::vector&lt;Message&gt; pushed_data; <span class="code-comment">//</span><span class="code-comment"> for later verification
</span>  <span class="code-keyword">for</span>(Message m : all_data)
  {
    <span class="code-keyword">while</span>(<span class="code-keyword">false</span> == out_fifo.push(m))
    {
      std::this_thread::yield();
    }
    pushed_data.push_back(m);
  }
  <span class="code-keyword">return</span> pushed_data;
}
&nbsp;

<span class="code-comment">//</span><span class="code-comment"> The consumer functionality (background)
</span>std::vector&lt;Message&gt; Consumer(MessageQueue&amp; in_fifo, <span class="code-keyword">const</span> <span class="code-sdkkeyword">size_t</span> enough_processed)
{
  std::vector&lt;Message&gt; received_data; <span class="code-comment">//</span><span class="code-comment"> for later verification with produced/sent items
</span>  <span class="code-keyword">for</span>(<span class="code-sdkkeyword">size_t</span> count = <span class="code-digit">0</span>; enough_processed &gt; count; ++count)
  {
    Message m;
    <span class="code-keyword">while</span>(<span class="code-keyword">false</span> == in_fifo.pop(m))
    {
      std::this_thread::yield();
    }
    received_data.push_back(m);
  }
  <span class="code-keyword">return</span> received_data;
}
&nbsp;

<span class="code-comment">//</span><span class="code-comment"> Using google test framework
</span>TEST(ThreadedTest, SingleProducerSingleConsumer)
{
  std::cout &lt;&lt; queue_type_message &lt;&lt; <span class="code-string">"</span><span class="code-string">\nPrepare to wait a bit, pushing "</span>; 
  std::cout &lt;&lt; k_amount_to_process &lt;&lt; <span class="code-string">"</span><span class="code-string"> through a circular fifo of size: "</span>;
  std::cout &lt;&lt; MessageQueue::Capacity-<span class="code-digit">1</span> &lt;&lt; std::flush;
&nbsp;

  MessageQueue msg_queue;
  g2::StopWatch clock; <span class="code-comment">//</span><span class="code-comment"> implementation at http://kjellkod.wordpress.com/2012/02/06/exploring-c11-part-1-time/
</span>
&nbsp;
  <span class="code-keyword">auto</span> future_consumed = <span class="code-comment">/*</span><span class="code-comment"> launch::async force actual thread to run */</span>
      std::async(std::launch::async, &amp;Consumer, std::<span class="code-keyword">ref</span>(msg_queue), k_amount_to_process); 
&nbsp;

  <span class="code-keyword">auto</span> producer_made = Producer(std::<span class="code-keyword">ref</span>(msg_queue), k_amount_to_process); <span class="code-comment">//</span><span class="code-comment"> this thread scope
</span>  <span class="code-keyword">auto</span> consumer_received = future_consumed.get(); <span class="code-comment">//</span><span class="code-comment"> wait for consumer to finish
</span>  <span class="code-keyword">auto</span> elapsed_ms = clock.elapsedMs();
&nbsp;

  std::cout &lt;&lt; <span class="code-string">"</span><span class="code-string">\n\t#"</span> &lt;&lt; k_amount_to_process &lt;&lt; <span class="code-string">"</span><span class="code-string"> items took #"</span> &lt;&lt; elapsed_ms.count();
  std::cout &lt;&lt; <span class="code-string">"</span><span class="code-string"> milliseconds to shuffle"</span> &lt;&lt; std::flush;
&nbsp;

&nbsp;
  ASSERT_TRUE(consumer_received.size() == producer_made.size());
  ASSERT_TRUE(consumer_received.size() == k_amount_to_process);
&nbsp;

  <span class="code-comment">//</span><span class="code-comment"> Possibly VERY LONG printout if using the broken queue (volatile)
</span>  <span class="code-comment">//</span><span class="code-comment"> but will not get any diffs if using the above corrected atomic lock-free, wait-free 
</span>  <span class="code-comment">//</span><span class="code-comment"> circularfifo
</span>  <span class="code-keyword">auto</span> getitr = consumer_received.begin();
  <span class="code-keyword">auto</span> putitr = producer_made.begin();
  <span class="code-keyword">auto</span> idx = <span class="code-digit">0</span>;
  <span class="code-keyword">while</span>(getitr != consumer_received.end())
  {
    <span class="code-keyword">if</span>((*getitr) != (*putitr))
    {
      std::cout &lt;&lt; <span class="code-string">"</span><span class="code-string">\nC:"</span> &lt;&lt; *getitr &lt;&lt; <span class="code-string">"</span><span class="code-string">\tP:"</span> &lt;&lt; *putitr &lt;&lt; <span class="code-string">"</span><span class="code-string">\tidx:"</span> &lt;&lt; idx;
    }
    ++idx;
    ++getitr;
    ++putitr;
  }
&nbsp;

  <span class="code-comment">//</span><span class="code-comment"> Will likely (not always) show an error for the dangerous and obsolete
</span>  <span class="code-comment">//</span><span class="code-comment"> volatile circular fifo
</span>  ASSERT_TRUE(std::equal(producer_made.begin(), producer_made.end(), consumer_received.begin()));
}
</pre><br><br><div class="modified">modified  26-Nov-12 4:35am.</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4436228&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4436228&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4436101" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4436228/Re-How-to-adapt-this-to-use-shared-memory.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4436228&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4436228&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4436228" data-ref="3_4436228" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4436228"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4273343_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4273343xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4273343" parent="0" thread="4273343" href="http://www.codeproject.com/Messages/4273343/Will-it-be-thread-safe-if-used-as-a-buffer.aspx">Will it be thread-safe if used as a buffer?</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">a_kavo</span><span class="date">6-Jun-12  17:00</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=7967289">a_kavo</a></span></td><td class="date"><span>6-Jun-12  17:00&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4273343_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="7967289" msgid="4273343" votingtype="GoodOrBad"><a href="#xx4273343xx" onclick="RateMsg(7967289,4273343,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4273343xx" onclick="RateMsg(7967289,4273343,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Hello,<br>
Thank you for a great article. <br>
I would like to use this kind of structure as a buffer to push and pull text.<br>
Therefore I would rather use a memcpy and then increment the index by 
the length of the string all in one call rather than push and pop 
character by character. I would check if there is enough space prior to 
this of course.<br>
Would doing this break any assumptions?<br>
I don't think it would, but then again I'm new to this topic...<br>
<br>
Thank you<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4273343&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4273343&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4273343" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4273343/Will-it-be-thread-safe-if-used-as-a-buffer.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4273343&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4273343&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4273343" data-ref="3_4273343" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="7967289" msgid="4273343"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4273497_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx4273497xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_answer.gif" alt="Answer" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4273497" parent="4273343" thread="4273343" href="http://www.codeproject.com/Messages/4273497/Re-Will-it-be-thread-safe-if-used-as-a-buffer.aspx">Re: Will it be thread-safe if used as a buffer?</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">6-Jun-12  23:29</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>6-Jun-12  23:29&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4273497_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4273497" votingtype="GoodOrBad"><a href="#xx4273497xx" onclick="RateMsg(4385931,4273497,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4273497xx" onclick="RateMsg(4385931,4273497,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4273343);" href="http://www.codeproject.com/Messages/4273343/Will-it-be-thread-safe-if-used-as-a-buffer.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Hi a_kavo<br>
<br>
What you describe seems similar to the circular buffer I first saw and 
which gave idea to this article, to investigate whether or not such code
 would work. You can see what I wrote about that <a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?msg=4273343#heading0002">"initial queue" here</a>[<a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?msg=4273343#heading0002" target="_blank" title="New Window">^</a>].  So "yes" such code can work, but I would do you a disservice to say that it definitely would. It all "depends" <br>
{<code>queue implementation : hardware architecture : compiler<br>
</code> } <br>
<br>
<u>Some questions back to you</u>:<br>
1. What platform have you planned to use this on? This code, as is, could break on some platforms.<br>
<br>
2. Do you have access to C++11 <code>std::atomic<int></int></code>, i.e visual studio 11 (2012), gcc 4.7 or the C++11 library implementation by <code>just::thread</code>?<br>
If you can say <b>yes </b>to any of these questions then the <code>head </code>and <code>tail </code> should take advantage of that instead of how it is in the current implementation<br>
<br>
* <code>std::atomic<int></int></code> only guarantees atomicity not lock-free. If it is lock-free (platform dependent) is easy to find out, I belive the call <code>std::atomic<int>::is_lock_free()</int></code> or similar would answer that for your platform.<br>
<br>
--- So <b>bottom line</b>: "Maybe", but you should look into using C++11 features instead.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4273497&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4273497&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4273343" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4273497/Re-Will-it-be-thread-safe-if-used-as-a-buffer.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4273497&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4273497&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4273497" data-ref="3_4273497" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4273497"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4464557_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="56px"><a name="xx4464557xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4464557" parent="4273497" thread="4273343" href="http://www.codeproject.com/Messages/4464557/Re-Will-it-be-thread-safe-if-used-as-a-buffer.aspx">Re: Will it be thread-safe if used as a buffer?</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">a_kavo</span><span class="date">4-Jan-13  7:41</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=7967289">a_kavo</a></span></td><td class="date"><span>4-Jan-13  7:41&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4464557_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"><div done="true" class="voteform vertical" ownerid="7967289" msgid="4464557" votingtype="GoodOrBad"><a href="#xx4464557xx" onclick="RateMsg(7967289,4464557,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4464557xx" onclick="RateMsg(7967289,4464557,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="56px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4273497);" href="http://www.codeproject.com/Messages/4273497/Re-Will-it-be-thread-safe-if-used-as-a-buffer.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Hello,<br>
I ended up implementing the interface I mentioned in my question and 
wanted to post it here for the record in case anyone finds it useful.<br>
What I was looking for was an interface similar to socket send()/recv() 
which could allow for batching of elements or for the use of the ring 
buffer as a message queue.<br>
<br>
Edited/fixed bugs 4/3/13<br>
<div class="pre-action-link" id="premain53912" style="width:100%;display:block;"><span id="prehide53912" onclick="processCodeBlocks.togglePre(53912);">Hide</span>  &nbsp; <span id="preShrink53912" onclick="processCodeBlocks.shrinkExpand(53912);">Shrink</span> <img id="preimg53912" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(53912);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(53912);">Copy Code</span></div><pre id="pre53912" style="margin-top: 0px;" lang="c++"><span class="code-comment">/*</span><span class="code-comment">
	Push an array of elements.
	Return the number of elements pushed.
*/</span>
<span class="code-keyword">template</span>&lt;<span class="code-keyword">typename</span> Element, <span class="code-sdkkeyword">size_t</span> Size&gt;
<span class="code-sdkkeyword">size_t</span> RingBuffer&lt;Element, Size&gt;::push(<span class="code-keyword">const</span> Element* data, <span class="code-sdkkeyword">size_t</span> len)
{
	<span class="code-sdkkeyword">size_t</span> current_tail = _tail.load(std::memory_order_relaxed);
	<span class="code-comment">//</span><span class="code-comment">
</span>	<span class="code-sdkkeyword">size_t</span> sz_left = size_left_p_();
	<span class="code-sdkkeyword">size_t</span> sz_to_end = Capacity - current_tail;
	<span class="code-comment">//</span><span class="code-comment">will not push more than than there is space available up to the end of the array
</span>	<span class="code-sdkkeyword">size_t</span> sz_to_push = std::min(len, sz_left);
	sz_to_push = std::min(sz_to_push, sz_to_end);
	<span class="code-comment">//</span><span class="code-comment">
</span>	memcpy(&amp;_array[current_tail], data, sz_to_push*<span class="code-keyword">sizeof</span>(Element));
	current_tail = increment(current_tail, sz_to_push);
	<span class="code-comment">//</span><span class="code-comment">update tail
</span>	_tail.store(current_tail, std::memory_order_release); 
	<span class="code-keyword">return</span> sz_to_push;
}
&nbsp;
<span class="code-comment">/*</span><span class="code-comment">
	Pop multiple elements up the size of the array provided.
	Return the number of elements popped.
*/</span>
<span class="code-keyword">template</span>&lt;<span class="code-keyword">typename</span> Element, <span class="code-sdkkeyword">size_t</span> Size&gt;
<span class="code-sdkkeyword">size_t</span> RingBuffer&lt;Element, Size&gt;::pop(Element* data, <span class="code-sdkkeyword">size_t</span> len)
{
	<span class="code-sdkkeyword">size_t</span> current_head = _head.load(std::memory_order_relaxed);
	<span class="code-comment">//</span><span class="code-comment">
</span>	<span class="code-sdkkeyword">size_t</span> sz_used = size_c_();
	<span class="code-sdkkeyword">size_t</span> sz_to_end = Capacity - current_head;
	<span class="code-comment">//</span><span class="code-comment">will not pop more than the supplied buffer can hold or further than the end of the array
</span>	<span class="code-sdkkeyword">size_t</span> sz_to_pop = std::min(len, sz_used);
	sz_to_pop = std::min(sz_to_pop, sz_to_end);
	<span class="code-comment">//</span><span class="code-comment">
</span>	memcpy(data, &amp;_array[current_head], sz_to_pop*<span class="code-keyword">sizeof</span>(Element));
	current_head = increment(current_head, sz_to_pop);
	<span class="code-comment">//</span><span class="code-comment">update tail
</span>	_head.store(current_head, std::memory_order_release); 
	<span class="code-keyword">return</span> sz_to_pop;
}
&nbsp;
<span class="code-comment">/*</span><span class="code-comment">
	Like size() but with more efficient memory ordering,
	assuming it is called strictly by consumer
*/</span>
<span class="code-keyword">template</span>&lt;<span class="code-keyword">typename</span> Element, <span class="code-sdkkeyword">size_t</span> Size&gt;
<span class="code-sdkkeyword">size_t</span> RingBuffer&lt;Element, Size&gt;::size_c_() <span class="code-keyword">const</span>
{
	<span class="code-sdkkeyword">size_t</span> curTail = _tail.load(std::memory_order_acquire);
	<span class="code-sdkkeyword">size_t</span> curHead = _head.load(std::memory_order_relaxed);
	<span class="code-keyword">if</span>(curTail &gt;= curHead)
	{
		<span class="code-keyword">return</span> curTail - curHead;
	}
	<span class="code-keyword">return</span> Capacity - curHead + curTail;
}
&nbsp;
<span class="code-comment">/*</span><span class="code-comment">
	Like (Size - size()) but with more efficient memory ordering,
	assuming it is called strictly by producer
*/</span>
<span class="code-keyword">template</span>&lt;<span class="code-keyword">typename</span> Element, <span class="code-sdkkeyword">size_t</span> Size&gt;
<span class="code-sdkkeyword">size_t</span> RingBuffer&lt;Element, Size&gt;::size_left_p_() <span class="code-keyword">const</span>
{
	<span class="code-comment">//</span><span class="code-comment">size_left() = Size - size()
</span>	<span class="code-comment">//</span><span class="code-comment"> or :
</span>	<span class="code-sdkkeyword">size_t</span> curTail = _tail.load(std::memory_order_relaxed);
	<span class="code-sdkkeyword">size_t</span> curHead = _head.load(std::memory_order_acquire);
	<span class="code-keyword">if</span>(curTail &gt;= curHead)
	{
		<span class="code-keyword">return</span> Size - curTail + curHead;
	}
	<span class="code-keyword">return</span> curHead - curTail - <span class="code-digit">1</span>;
}
&nbsp;
<span class="code-keyword">template</span>&lt;<span class="code-keyword">typename</span> Element, <span class="code-sdkkeyword">size_t</span> Size&gt;
<span class="code-keyword">inline</span> <span class="code-sdkkeyword">size_t</span> RingBuffer&lt;Element, Size&gt;::increment(<span class="code-sdkkeyword">size_t</span> idx, <span class="code-sdkkeyword">size_t</span> step) <span class="code-keyword">const</span>
{ 
	<span class="code-keyword">return</span> (idx+step) % Capacity;
}
</pre>
I believe the use of memory barriers above is correct and C++11 takes 
the pain away of making such code portable by abstracting the memory 
models of various architectures.<br>
<br>
By using the above interface, throughput is increased as the cost of the most expensive operations like<br>
_head.store(current_head, std::memory_order_release); <br>
is amortized.<br>
Thanks<br><br><div class="modified">modified  3-Apr-13 10:59am.</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4464557&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4464557&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4273343" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4464557/Re-Will-it-be-thread-safe-if-used-as-a-buffer.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4464557&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4464557&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4464557" data-ref="3_4464557" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="7967289" msgid="4464557"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4466466_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="74px"><a name="xx4466466xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4466466" parent="4464557" thread="4273343" href="http://www.codeproject.com/Messages/4466466/Re-Will-it-be-thread-safe-if-used-as-a-buffer.aspx">Re: Will it be thread-safe if used as a buffer?</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">7-Jan-13  11:53</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>7-Jan-13  11:53&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4466466_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:74px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4466466" votingtype="GoodOrBad"><a href="#xx4466466xx" onclick="RateMsg(4385931,4466466,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4466466xx" onclick="RateMsg(4385931,4466466,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="74px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4464557);" href="http://www.codeproject.com/Messages/4464557/Re-Will-it-be-thread-safe-if-used-as-a-buffer.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div><b>Great piece of code @a_kavo. </b><br>
I have not yet tested it but it looks correct. The use of <code>memcpy</code> is more "<i>standard</i>" and the norm then my templated, one-by-one, approach. <br>
<br>
<br>
I did beat you to the punch though <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_smile.gif" alt="Smile | :)" align="top">   <b>Thanks to your</b> <small>and other readers</small> input I finally got my act together and on the 27th of November, 2012 I updated this article with a <b>complete rewrite</b> of the text and its code to use C++11 atomics. <br>
<br>
If you care to please check out the article and/or the downloadable 
code. The platform hack is now completely avoided thanks to C++11 memory
 models and atomic operations.    <br>
<br>
In the article above I describe, like your code, <code>std::memory_order_{relaxed/aquire/release}</code> the other example I added uses the C++11 default sequential consistent <code>std::memory_order_seq_cst</code><br>
<br>
The example unit tests runs some tests as well as compare performance between <code>sequential</code> and <code>relaxed/aquire/release</code> lock-free queue.<br>
<br>
Thank you for your update. It provides important information to the me 
and other readers of how to implement the lock-free queue. It was great 
to see that our use of C++11 atomics were similar <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/smiley_wink.gif" alt="Wink | ;)" align="top"> <br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4466466&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4466466&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4273343" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4466466/Re-Will-it-be-thread-safe-if-used-as-a-buffer.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4466466&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4466466&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4466466" data-ref="3_4466466" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4466466"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4185173_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4185173xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4185173" parent="0" thread="4185173" href="http://www.codeproject.com/Messages/4185173/new-question-about-multiple-thread-write-and-singl.aspx">new question about multiple thread write and single read</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Member 2021086</span><span class="date">8-Mar-12  21:32</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=2021086">Member 2021086</a></span></td><td class="date"><span>8-Mar-12  21:32&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4185173_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="2021086" msgid="4185173" votingtype="GoodOrBad"><a href="#xx4185173xx" onclick="RateMsg(2021086,4185173,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4185173xx" onclick="RateMsg(2021086,4185173,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">if there are many threads write FIFO and only one thread read,  but no concurrent write at same time,  such as:<br>
thread 0 read for ever<br>
thread 1 write  to fifo<br>
thread 2 write to fifo<br>
...<br>
<br>
question: in this case, the FIFO is thread safe or not? why?<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4185173&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4185173&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4185173" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4185173/new-question-about-multiple-thread-write-and-singl.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4185173&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4185173&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4185173" data-ref="3_4185173" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="2021086" msgid="4185173"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4185195_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx4185195xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_answer.gif" alt="Answer" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4185195" parent="4185173" thread="4185173" href="http://www.codeproject.com/Messages/4185195/Re-new-question-about-multiple-thread-write-and-si.aspx">Re: new question about multiple thread write and single read</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">8-Mar-12  23:23</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>8-Mar-12  23:23&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4185195_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4185195" votingtype="GoodOrBad"><a href="#xx4185195xx" onclick="RateMsg(4385931,4185195,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4185195xx" onclick="RateMsg(4385931,4185195,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4185173);" href="http://www.codeproject.com/Messages/4185173/new-question-about-multiple-thread-write-and-singl.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>As it is now it is <b>not</b> thread-safe for multiple producers.<br>
<br>
<div class="pre-action-link" id="premain662472" style="width:100%;display:block;"><span id="prehide662472" onclick="processCodeBlocks.togglePre(662472);">Hide</span>  &nbsp; <span id="preShrink662472" onclick="processCodeBlocks.shrinkExpand(662472);">Shrink</span> <img id="preimg662472" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up-16.png" style="height:16px;width:16px" onclick="processCodeBlocks.shrinkExpand(662472);">  &nbsp; <span onclick="return processCodeBlocks.copyCode(662472);">Copy Code</span></div><pre id="pre662472" style="margin-top: 0px;" lang="c++"> <span class="code-keyword">bool</span> CircularFifo&lt;Element, Size&gt;::push(Element&amp; item_)
     {
       <span class="code-keyword">int</span> nextTail = increment(tail);
       <span class="code-keyword">if</span>(nextTail != head)
        {
           <span class="code-keyword">array</span>[tail] = item_;
           tail = nextTail;
[...]
</pre>
<br>
As you see above. If any other thread would come in then it would be à mess.<br>
One example: threadA gets value X for nextTail, threadB gets value X+1 
for nextTail. ThreadB runs the function to completion and sets tail = 
X+1. ThreadA continues and sets tail to X. ThreadC comes in and sets 
tail to X+1.<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4185195&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4185195&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4185173" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4185195/Re-new-question-about-multiple-thread-write-and-si.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4185195&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4185195&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4185195" data-ref="3_4185195" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4185195"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4185205_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="56px"><a name="xx4185205xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4185205" parent="4185195" thread="4185173" href="http://www.codeproject.com/Messages/4185205/Re-new-question-about-multiple-thread-write-and-si.aspx">Re: new question about multiple thread write and single read</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Member 2021086</span><span class="date">8-Mar-12  23:56</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=2021086">Member 2021086</a></span></td><td class="date"><span>8-Mar-12  23:56&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4185205_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:56px;"><div done="true" class="voteform vertical" ownerid="2021086" msgid="4185205" votingtype="GoodOrBad"><a href="#xx4185205xx" onclick="RateMsg(2021086,4185205,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4185205xx" onclick="RateMsg(2021086,4185205,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="56px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4185195);" href="http://www.codeproject.com/Messages/4185195/Re-new-question-about-multiple-thread-write-and-si.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>i'm a bit confused. let's say there's a thread pool to produce message, and there's a lock arround CircularFifo::push:<br>
{<br>
Lock lk;<br>
fifo.push(item);<br>
}<br>
multiple threads no way to do concurrent push on FIFO,  is this NOT thread-safe?<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4185205&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4185205&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4185173" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4185205/Re-new-question-about-multiple-thread-write-and-si.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4185205&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4185205&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4185205" data-ref="3_4185205" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="2021086" msgid="4185205"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4185242_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="74px"><a name="xx4185242xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_answer.gif" alt="Answer" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4185242" parent="4185205" thread="4185173" href="http://www.codeproject.com/Messages/4185242/Re-new-question-about-multiple-thread-write-and-si.aspx">Re: new question about multiple thread write and single read</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">9-Mar-12  1:12</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>9-Mar-12  1:12&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4185242_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:74px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4185242" votingtype="GoodOrBad"><a href="#xx4185242xx" onclick="RateMsg(4385931,4185242,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4185242xx" onclick="RateMsg(4385931,4185242,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="74px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4185205);" href="http://www.codeproject.com/Messages/4185205/Re-new-question-about-multiple-thread-write-and-si.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Sorry, I got confused by your question. <br>
<br>
Since it is a lock-free queue putting a lock on top of it seems 
out-of-place to me. I think it is  better not to mix them lock-free + 
lock together. If you need a locked-shared queue then you should 
strongly consider keeping the lock  <b>inside</b> the queue - this avoids potential queue/thread misuse. <br>
<br>
If you need a shared_queue that many producers, even many consumers can 
use simultaneously then I can suggest a couple of examples. <br>
<br>
<br>
1. A lock protected shared_queue inspired by Anthony Williams book "C++ 
Concurrency in Action". You can see examples of hit here <a href="https://bitbucket.org/KjellKod/g2log/src/d4518b302cc8/g2log/src/shared_queue.h">https://bitbucket.org/KjellKod/g2log/src/d4518b302cc8/g2log/src/shared_queue.h</a><br>
[<a href="https://bitbucket.org/KjellKod/g2log/src/d4518b302cc8/g2log/src/shared_queue.h" target="_blank" title="New Window">^</a>] and here http://www.codeproject.com/script/Articles/ViewDownloads.aspx?aid=288827<br>
<br>
There are lock-free multiple producer queues here at 
CodeProject,http://www.codeproject.com/KB/threads/arraylockfreequeue.aspx?msg=3769640#xx3769640xx
 I have not tried them but if it is lock-free you are after why not 
check out<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4185242&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4185242&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4185173" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4185242/Re-new-question-about-multiple-thread-write-and-si.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4185242&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4185242&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4185242" data-ref="3_4185242" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4185242"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4180351_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4180351xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4180351" parent="0" thread="4180351" href="http://www.codeproject.com/Messages/4180351/My-vote-of.aspx">My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">manoj kumar choubey</span><span class="date">5-Mar-12  0:41</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=5071129">manoj kumar choubey</a></span></td><td class="date"><span>5-Mar-12  0:41&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4180351_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="5071129" msgid="4180351" votingtype="GoodOrBad"><a href="#xx4180351xx" onclick="RateMsg(5071129,4180351,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4180351xx" onclick="RateMsg(5071129,4180351,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">nice<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4180351&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4180351&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4180351" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4180351/My-vote-of.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4180351&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4180351&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4180351" data-ref="3_4180351" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="5071129" msgid="4180351"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4155173_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4155173xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4155173" parent="0" thread="4155173" href="http://www.codeproject.com/Messages/4155173/My-vote-of.aspx">My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">manoj kumar choubey</span><span class="date">13-Feb-12  4:28</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=5071129">manoj kumar choubey</a></span></td><td class="date"><span>13-Feb-12  4:28&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4155173_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="5071129" msgid="4155173" votingtype="GoodOrBad"><a href="#xx4155173xx" onclick="RateMsg(5071129,4155173,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4155173xx" onclick="RateMsg(5071129,4155173,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">Nice<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4155173&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4155173&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4155173" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4155173/My-vote-of.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4155173&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4155173&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4155173" data-ref="3_4155173" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="5071129" msgid="4155173"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4157879_h0" class="header hover-row">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="38px"><a name="xx4157879xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4157879" parent="4155173" thread="4155173" href="http://www.codeproject.com/Messages/4157879/Re-My-vote-of.aspx">Re: My vote of 5</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">KjellKod.cc</span><span class="date">15-Feb-12  8:23</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=4385931">KjellKod.cc</a></span></td><td class="date"><span>15-Feb-12  8:23&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4157879_h1" class="content selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:38px;"><div done="true" class="voteform vertical" ownerid="4385931" msgid="4157879" votingtype="GoodOrBad"><a href="#xx4157879xx" onclick="RateMsg(4385931,4157879,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4157879xx" onclick="RateMsg(4385931,4157879,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="38px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2"><div class="parent"><a rel="nofollow" onclick="return SwitchMessage(null,4155173);" href="http://www.codeproject.com/Messages/4155173/My-vote-of.aspx"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/arrow-up24.png" title="Go to Parent" style="width:16px;height:16px;border:0"></a></div>Thank you Manoj. <br>
<br>
I will try to make an update soon (well in 2012),. or maybe a follow-up 
would be better. To show how this simplistic lock-free queue will 
benefit from C++11<br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4157879&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4157879&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4155173" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4157879/Re-My-vote-of.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4157879&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4157879&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4157879" data-ref="3_4157879" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="4385931" msgid="4157879"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr id="F4034807_h0" class="header hover-row root">
<td class="subject-line normal " width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td class="indent" width="20px"><a name="xx4034807xx"></a><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"></td><td class="subject hover-container"><a class="message-link" name="4034807" parent="0" thread="4034807" href="http://www.codeproject.com/Messages/4034807/how-to-get-the-size-of-the-queue-like-standard-stl.aspx">how to get the size of the queue like standard stl container?</a> <a onclick="return Pin(this);" rel="nofollow" href="#" title="Click to pin message"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/pin.png" alt="Pin" align="top" height="13px" border="0" width="13px"></a><div class="mobile-only">
	<span class="author">Member 2021086</span><span class="date">26-Sep-11  7:01</span>
</div></td><td class="icon"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/icn-member-16.gif" title="member" alt="member" height="16px" border="0"></td><td class="author"><span><a href="http://www.codeproject.com/script/Membership/View.aspx?mid=2021086">Member 2021086</a></span></td><td class="date"><span>26-Sep-11  7:01&nbsp;</span></td>
</tr>
</tbody></table></td>
</tr><tr id="F4034807_h1" class="content root selected" style="display:none;">
<td class="normal" width="100%"><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr valign="top">
<td class="indent align-right" style="width:20px;"><div done="true" class="voteform vertical" ownerid="2021086" msgid="4034807" votingtype="GoodOrBad"><a href="#xx4034807xx" onclick="RateMsg(2021086,4034807,5,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/upvote16.png" alt="upvote" title="upvote" align="absmiddle" height="16px" border="0" width="16px"></a>
<br><a href="#xx4034807xx" onclick="RateMsg(2021086,4034807,1,0);"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/downvote16.png" alt="downvote" title="downvote" align="absmiddle" height="16px" border="0" width="16px"></a>
</div><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="1px" width="20px"></td><td class="text"><table border="0" cellpadding="0" cellspacing="5px" width="100%">
<tbody><tr>
<td><table border="0" cellpadding="0" cellspacing="0" width="100%">
<tbody><tr>
<td colspan="2">in order to choose best size of the queue, we need to know the size used by the queue.<br>
q1: how to get the size used by the queue?<br>
q2: is this thread safe ?<br><br><div class="modified">modified  26-Sep-11 8:13am.</div><br></td>
</tr><tr class="footer" style="vertical-align:top;">
<td><a class="new-message" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4034807&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=r" title="Reply">Reply</a>·<wbr><a class="nav-link" href="http://www.codeproject.com/script/Forums/Edit.aspx?fid=1551445&amp;select=4034807&amp;floc=/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular&amp;action=e" title="Email">Email</a>·<wbr><a href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;sort=Position&amp;spc=Relaxed&amp;tid=4034807" title="View&nbsp;Thread">View&nbsp;Thread</a>·<wbr><a href="http://www.codeproject.com/Messages/4034807/how-to-get-the-size-of-the-queue-like-standard-stl.aspx" title="Get permanent link">Permalink</a>·<wbr><a href="http://www.codeproject.com/script/Bookmarks/Add.aspx?obid=4034807&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small" title="Bookmark this post" onclick="return bookmarkMe(0,0,'/script/Bookmarks/Ajax/Add.aspx?obid=4034807&amp;obtid=3&amp;action=AddBookmark&amp;bio=false&amp;bis=small',false, this, this);">Bookmark</a></td><td style="text-align:right;"><span id="MVF4034807" data-ref="3_4034807" class="rating-label" style="white-space:nowrap;"><span class="reportform" ownerid="2021086" msgid="4034807"></span></span></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table></td>
</tr><tr>
<td><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/t.gif" alt="" height="5px" border="0" width="1px"></td>
</tr><tr>
<td><table cellpadding="2px" cellspacing="0" width="100%">
<tbody><tr class="footer">
<td><span class="last-visit desktop-only tablet-only">Last Visit: 27-Jul-15  23:04 &nbsp; &nbsp; Last Update: 12-Aug-15  20:09</span></td><td><a rel="nofollow" href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;prof=False&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed">Refresh</a></td><td style="text-align:right;white-space:nowrap;"><input id="_mbnUrl" value="/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;prof=False&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;fr=51" type="hidden"><span class="nav-link selected">1</span><a class="nav-link" name="Frm_HoverNL" href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;prof=False&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;fr=51#xx0xx">2</a> <a class="nav-link" name="Frm_HoverNL" href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?fid=1551445&amp;df=10000&amp;mpp=50&amp;prof=False&amp;sort=Position&amp;view=Normal&amp;spc=Relaxed&amp;fr=51#xx0xx">Next »</a></td>
</tr>
</tbody></table></td>
</tr>
</tbody></table>
</div><p class="small-text"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_general.gif" alt="General" align="top" height="16px" width="16px"> General &nbsp;&nbsp; <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_news.gif" alt="News" align="top" height="16px" width="16px"> News &nbsp;&nbsp; <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_idea.gif" alt="Suggestion" align="top" height="16px" width="16px"> Suggestion &nbsp;&nbsp; <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_question.gif" alt="Question" align="top" height="16px" width="16px"> Question &nbsp;&nbsp; <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_bug.gif" alt="Bug" align="top" height="16px" width="16px"> Bug &nbsp;&nbsp; <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_answer.gif" alt="Answer" align="top" height="16px" width="16px"> Answer &nbsp;&nbsp; <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_joke.gif" alt="Joke" align="top" height="16px" width="16px"> Joke &nbsp;&nbsp; <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_rant.gif" alt="Rant" align="top" height="16px" width="16px"> Rant &nbsp;&nbsp; <img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/msg_admin.gif" alt="Admin" align="top" height="16px" width="16px"> Admin &nbsp;&nbsp; </p><p class="small-text">Use Ctrl+Left/Right to switch messages, Ctrl+Up/Down to switch threads, Ctrl+Shift+Left/Right to switch pages.</p>
				

			</div>
			
		</td>
		<td class="article-wing-right" width="170px">
			<div id="ctl00_RightSideBar" class="container-article-info">

                <div style="position: fixed; top: 10px; left: 1140.5px;" id="RHSticky" class="container-article-info-sticky stuck">
        			

<div class="header">Info</div>
<div class="article-summary">

<a id="ctl00_InfoBox_ParentLink"></a>

<table class="article-info" cellpadding="0" cellspacing="0">

    

    
	

	

    

	<tbody><tr><td nowrap="nowrap">First Posted&nbsp;</td><td class="value" nowrap="nowrap"><span itemprop="datePublished" content="2009-11-04">4 Nov 2009</span></td></tr>
    

	<tr><td colspan="2"></td></tr>
	
	
</tbody></table>
</div>

				    

				    <div style="width:160px;margin: 10px auto;">
					    <div class="msg-160x600" data-format="160x600" data-type="ad" data-publisher="lqm.codeproject.site" data-zone="General-Programming/Threads-Processes-IPC/Multi-threading" data-tags="VS2008, C++, Windows, Dev, Linux, Intermediate, Threading, C++11,rating4.5"><noscript><a href="http://ad.doubleclick.net/N6839/jump/lqm.codeproject.site/General-Programming/Threads-Processes-IPC/Multi-threading;sz=160x600;ord=635750249554601783?"><img src="http://ad.doubleclick.net/N6839/ad/lqm.codeproject.site/General-Programming/Threads-Processes-IPC/Multi-threading;sz=160x600;ord=635750249554601783?"  width="160px" height="600px" /></a></noscript></div>
				    </div>

                    

				    

				    

				    

                    <div class="anchorLink gototop" id="gototop">
                        <a id="ctl00_GoToTop" href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular#_articleTop">Go to top</a>
                    </div>

				</div>

			</div>
		</td>
		</tr></tbody></table>

		
		<div class="theme1-background" style="height:2px" id="stickyStop"></div>

		<div class="extended tiny-text">
			<div class="row">
				<div class="float-left">
					<a id="ctl00_PermaLink" itemprop="url" href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular">Permalink</a> | 
					<a id="ctl00_AdvertiseLink" href="http://developermedia.com/">Advertise </a> |
					<a id="ctl00_PrivacyLink" href="http://www.codeproject.com/info/privacy.aspx">Privacy</a> |
                    <a id="ctl00_TermsOfUseLink" href="http://www.codeproject.com/info/TermsOfUse.aspx">Terms of Use</a> |
					<a id="ctl00_Mobile" rel="nofollow" href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?display=Mobile">Mobile</a>
					<br>
								
					
					Web03 |
					2.8.150812.1 |
					Last Updated 31 Dec 2014								
				</div>

                <div id="ctl00_GoogleTranslate" class="translate float-left"><div style="" dir="ltr" class="skiptranslate goog-te-gadget"><div class="goog-te-gadget-simple" style="white-space: nowrap;" id=":0.targetLanguage"><img style="background-image: url(&quot;https://translate.googleapis.com/translate_static/img/te_ctrl3.gif&quot;); background-position: -65px 0px;" class="goog-te-gadget-icon" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/cleardot.gif"><span style="vertical-align: middle;"><a href="javascript:void(0)" class="goog-te-menu-value"><span>选择语言</span><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/cleardot.gif" height="1" width="1"><span style="border-left: 1px solid rgb(187, 187, 187);">​</span><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/cleardot.gif" height="1" width="1"><span style="color: rgb(155, 155, 155);">▼</span></a></span></div></div></div>      

				<div class="float-right align-right">
					Article Copyright 2009 by KjellKod.cc<br>Everything else
					Copyright © <a href="mailto:webmaster@codeproject.com">CodeProject</a>, 1999-2015 <br>
				</div>

				


<div class="page-width">
Layout: <a id="ctl00_PageWidth_FixedT" title="Fixed width layout" rel="nofollow" class=" active" href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?PageFlow=FixedWidth">fixed</a>
|
<a id="ctl00_PageWidth_FluidT" title="Fluid layout" rel="nofollow" href="http://www.codeproject.com/Articles/43510/Lock-Free-Single-Producer-Single-Consumer-Circular?PageFlow=Fluid">fluid</a>
</div>



			</div>
		</div>
		

		<br clear="all">
		
			

	</div> 
	</div>
</div>


<div style="display:none;" id="dm_AdTable">
	
</div>
<img id="ctl00_Audience" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/DFPAudiencePixel.gif" style="border-width:0px;height:1px;width:1px;">



<script type="text/javascript" language="Javascript" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/jquery.js"></script><script type="text/javascript">//<![CDATA[
if (typeof jQuery == 'undefined') {
    document.write(unescape("%3Cscript src='/script/JS/jquery-1.6.2.min.js' type='text/javascript' %3E%3C/script%3E"));
}//]]></script>
<script type="text/javascript" language="Javascript" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/article.js"></script>
<script type="text/javascript" language="Javascript" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/element.js"></script>
<script type="text/javascript" language="Javascript" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/navbar.js"></script>
<script type="text/javascript" language="Javascript" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/Notifications.js"></script>
<script type="text/javascript" language="Javascript">//<![CDATA[
$(document).ready(function () { processCodeBlocks.Initialise('#contentdiv'); });
function googleTranslateElementInit() {  new google.translate.TranslateElement({   pageLanguage: 'en',   layout: google.translate.TranslateElement.InlineLayout.SIMPLE,   autoDisplay: false,   gaTrack: true,   gaId: 'UA-1735123-1'},  'ctl00_GoogleTranslate');}
$(document).ready(function() { anchorAnimate();
$('#RHSticky').sticky($('#stickyStop'));
$('#ctl00_Nav').sticky($('#stickyStop'));
});
var oSrchFlt = false, oSrchBox=false,srchBoxFoc=false;
$(document).ready(function() {
 if(InitWatermark)InitWatermark('sb_tb', 'Search for articles, questions, tips');
 var sbar = $('#sb_tb'); 
 var sfilter = $('#SearchFilter');
 if (sbar && sfilter) {
  sfilter.removeClass('popup'); sfilter.hide(); sfilter.removeClass('open');
  sbar.blur(function() {
 if (!oSrchFlt) {sfilter.hide(); sfilter.removeClass('open');}
 srchBoxFoc=false;
 });
  sbar.focus(function() {
 oSrchFlt=false; srchBoxFoc=true;
 sfilter.show(); sfilter.addClass('open');
 });
  sbar.mouseleave(function() { oSrchBox=false; });
  sbar.mouseover(function() { oSrchBox=true; });
  sfilter.mouseleave(function() { oSrchFlt=false; if (!srchBoxFoc&&!oSrchBox) { sfilter.hide(); sfilter.removeClass('open'); }});
  sfilter.mouseover(function() { oSrchFlt=true; });
 }
});
$('#clear-rate_ctl00_RateArticle_RCD').click(function () {    $('#ctl00_RateArticle_RCD').hide(); return false;});$("#ctl00_RateArticle_RateItemWrapper")   .removeClass("container-rating")   .hover( function() { $('#ctl00_RateArticle_RCD').fadeIn('fast'); },            function() { $('#ctl00_RateArticle_RCD').fadeOut('fast'); } );
function PostBack_ctl00_RateArticle_RateItemWrapper() {
  return rateItem(43510,2,1,true,true,0,'LargeStars');
}

                        function getVotesHistogram(objectId, objectTypeId, containerId, loadingId) {
                            if (!$('#' + containerId).attr('alreadyRequested')){
                                $.ajax({
                                    url: '/script/Ratings/Ajax/Histogram.aspx?obid=' + objectId + '&obtid='+objectTypeId,
                                    success: function (data) {
                                        $('#' + containerId).html(data);
                                        $('#' + loadingId).hide();
                                    }
                                });
                                $('#' + containerId).attr('alreadyRequested', 'true');
                            }
                        }
$(document).ready(function() {   new starRating('#ctl00_RateArticle_VoteFormDiv', PostBack_ctl00_RateArticle_RateItemWrapper,'ctl00_RateArticle');
  $('#ctl00_RateArticle_RB').mouseenter(function() {     getVotesHistogram(43510,2   ,'ctl00_RateArticle_Histogram','ctl00_RateArticle_Loading');  })})
$(document).ready(function() { $('#ctl00_RateArticle_SubmitRateBtn').hide(); });
$(document).ready(function() { $('#ctl00_RateArticle_SubmitRateBtn').hide(); });function ChkRtctl00_RateArticle(val) {}

forumDir = '/script/Forums/';
allowReporting = false;
allowRating = true;
allowRatingDisplay = true;
var smoothScroll = true;
Selected        = -1;
oldTitle        = document.title;
minMessageScore = 1;
minMessageScore = 5;
abuseScore      = -2;
spamScore       = -1;
getRatingUrl    = '/script/Ratings/Ajax/GetRatings.aspx';
getRatingRefKey = 'obrs';


//]]>
</script>



<canvas id="cv1" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><div id="goog-gt-tt" class="skiptranslate" dir="ltr"><div style="padding: 8px;"><div><div class="logo"><img src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/translate-32.png" height="20" width="20"></div></div></div><div class="top" style="padding: 8px; float: left; width: 100%;"><h1 class="title gray">原文</h1></div><div class="middle" style="padding: 8px;"><div class="original-text"></div></div><div class="bottom" style="padding: 8px;"><div class="activity-links"><span class="activity-link">提供更好的翻译建议</span><span class="activity-link"></span></div><div class="started-activity-container"><hr style="color: #CCC; background-color: #CCC; height: 1px; border: none;"><div class="activity-root"></div></div></div><div style="display: none;" class="status-message"></div></div><canvas id="cv2" width="1px" height="1px" style="position:absolute;left:0;top:0;pointer-events:none"></canvas><iframe style="visibility: visible; box-sizing: content-box; width: 823px; height: 307px; display: none;" class="goog-te-menu-frame skiptranslate" frameborder="0"></iframe><script src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/seed.js" charset="utf-8" id="outfox_seed_js"></script><script charset="utf-8" type="text/javascript" src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/all-packed-utf-8.js"></script><iframe src="Lock-Free%20Single-Producer%20-%20Single%20Consumer%20Circular%20Queue%20-%20CodeProject_files/conn.htm" style="display: none;" class="OUTFOX_JTR_CONN" id="OUTFOX_JTR_CDA"></iframe></body></html>